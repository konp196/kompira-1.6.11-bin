
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>3. Kompiraチュートリアル &#8212; Kompira 1.6.11 ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="4. Kompira ジョブフロー言語リファレンス" href="reference.html" />
    <link rel="prev" title="2. 操作ガイド" href="usage.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="reference.html" title="4. Kompira ジョブフロー言語リファレンス"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="usage.html" title="2. 操作ガイド"
             accesskey="P">前へ</a> |</li>
<li class="nav-item nav-item-0"><a href="index.html">Kompira 1.6.11 ドキュメント</a> [<a href="../en/tutorial.html">en</a>|<a href="./kompira.pdf" target="_blank">pdf</a>] &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3. </span>Kompiraチュートリアル</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="kompira">
<h1><span class="section-number">3. </span>Kompiraチュートリアル<a class="headerlink" href="#kompira" title="この見出しへのパーマリンク">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">著者<span class="colon">:</span></dt>
<dd class="field-odd"><p>Kompira 開発チーム</p>
</dd>
</dl>
<section id="id1">
<h2><span class="section-number">3.1. </span>はじめに<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<p>このチュートリアルでは、Kompira ジョブフロー言語の基本的な書き方や仕様について
ざっと紹介します。実際に Kompira 上でジョブフローを作成しながら学ぶことで、
リモートノードの制御方法や Kompira オブジェクトの利用方法が理解できることでしょう。</p>
<p>Kompira 標準オブジェクトの仕様については、 <a class="reference internal" href="library.html"><span class="doc">Kompira 標準ライブラリ</span></a> を参照してください。
また <a class="reference internal" href="reference.html"><span class="doc">Kompira ジョブフロー言語リファレンス</span></a> にはより形式的な言語の定義が書いてあります。</p>
<p>このチュートリアルは Kompira の機能を網羅的に紹介しているわけではありません。
しかしこのチュートリアルを読むことで、Kompira の特筆すべき機能や特徴を学び、
簡単なジョブフローであれば読み書きできるようになるでしょう。</p>
</section>
<section id="id2">
<h2><span class="section-number">3.2. </span>ジョブフローを動かす<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<section id="hello-world">
<h3><span class="section-number">3.2.1. </span>Hello World<a class="headerlink" href="#hello-world" title="この見出しへのパーマリンク">¶</a></h3>
<p>最初のジョブフローは、コンソールに &quot;Hello World&quot; を表示する単純なものです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&quot;Hello World&quot;)
</pre></div>
</div>
<p>このジョブフローを実行するとコンソールに以下のように出力されるはずです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Hello World
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ジョブフローに文法エラーがあると、保存しても実行できない状態になります。
実行ボタンが押せない場合は、ジョブフローのエラーを修正して再度保存してください。</p>
</div>
<p>Kompiraのジョブフロー言語は、1つの処理を表す <strong>ジョブ</strong> が基本的な
実行の単位となります。</p>
<p>上の例では <code class="docutils literal notranslate"><span class="pre">print()</span></code> がジョブフローの <strong>組み込みジョブ</strong> のひとつで、
丸括弧内に引数として与えられた文字列をコンソールに出力します。
詳しくは <a class="reference internal" href="library.html#lib-print"><span class="std std-ref">print</span></a> を参照してください。</p>
</section>
<section id="id3">
<h3><span class="section-number">3.2.2. </span>コメントの書き方<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブフローではハッシュ文字 <code class="docutils literal notranslate"><span class="pre">#</span></code> から行末までがコメントとなります。
コメントは行の先頭にも、ジョブの後にも書くことができます。
ただし、文字列中に現れるハッシュ文字は対象外です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># これはコメントです
print(&quot;# これはコメントではありません&quot;)  # これはコメント
</pre></div>
</div>
</section>
<section id="id4">
<h3><span class="section-number">3.2.3. </span>コマンドを実行する<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<p>実行したいコマンドを文字列として <strong>[</strong> と <strong>]</strong> の中に記述することで、
コマンドとして実行することができる <strong>実行ジョブ</strong> になります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">[]</span></code> の中が文字列であれば実行すべきコマンドとして解釈しますので、
コマンドラインの文字列を代入した変数を <code class="docutils literal notranslate"><span class="pre">[]</span></code> に記述して実行させる
ことも可能です。（変数への代入については後ほど説明します）</p>
</div>
<p>コマンドの実行結果を表示する例を以下に示します。:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;whoami&#39;] -&gt;
print($RESULT)
</pre></div>
</div>
<p>このジョブフローを実行すると <code class="docutils literal notranslate"><span class="pre">whoami</span></code> コマンドを実行し、
その結果（標準出力）が <code class="docutils literal notranslate"><span class="pre">print()</span></code> ジョブでコンソールに出力されます。
通常はコンソールに以下のように表示されるはずです。:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[localhost] local: whoami

kompira
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>特に指定しないとコマンドはジョブマネージャが動作しているホスト
上で <code class="docutils literal notranslate"><span class="pre">kompira</span></code> アカウントで実行されるため、 <code class="docutils literal notranslate"><span class="pre">whoami</span></code> コマンド
の実行結果として <code class="docutils literal notranslate"><span class="pre">kompira</span></code> と表示されています。</p>
<p><code class="docutils literal notranslate"><span class="pre">[localhost]</span> <span class="pre">local:</span></code> で始まる行はどのノードでどんなコマンドを実行したかを
示しています。リモートでコマンドを実行した場合は <code class="docutils literal notranslate"><span class="pre">[&lt;ホスト名&gt;]</span> <span class="pre">run:</span> <span class="pre">&lt;コマンド&gt;</span></code>
または <code class="docutils literal notranslate"><span class="pre">[&lt;IPアドレス&gt;]</span> <span class="pre">run:</span> <span class="pre">&lt;コマンド&gt;</span></code> のように表示されます。</p>
</div>
</section>
<section id="result">
<h3><span class="section-number">3.2.4. </span>$RESULT<a class="headerlink" href="#result" title="この見出しへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">$RESULT</span></code> は直前のジョブの実行結果が格納されている特殊な変数（状態変数）です。
この場合は <code class="docutils literal notranslate"><span class="pre">whoami</span></code> コマンドの実行結果、すなわち &quot;kompira&quot; という文字列が
格納されることになります。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">$RESULT</span></code> に格納される値の形式はジョブの種類によって異なります。
コマンドジョブの場合は、標準出力が文字列として格納されていますが、
ジョブによっては数値や辞書型の場合もあります。</p>
</div>
</section>
<section id="id5">
<h3><span class="section-number">3.2.5. </span>ジョブの連結<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブとジョブの間の矢印 <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> は、前のジョブが成功したら、後続のジョブを
実行する、という意味です。したがって、ジョブを <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> でつないでいくことで、
順番にジョブを実行していくことができます。</p>
<p>ジョブが失敗した場合（コマンドの実行ステータスが0以外を返した場合）でも
次の処理を継続したい場合には、二重矢印 <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code> を使います。
なお、直前のコマンドの実行ステータスは <code class="docutils literal notranslate"><span class="pre">$STATUS</span></code> 状態変数で参照することができます。</p>
<p>こうしたジョブを連結する矢印を <a class="reference internal" href="reference.html#ref-connector"><span class="std std-ref">結合子</span></a> といい、ジョブフローでは4種類あります。</p>
</section>
</section>
<section id="id6">
<h2><span class="section-number">3.3. </span>変数を使う<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id7">
<h3><span class="section-number">3.3.1. </span>変数の定義<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h3>
<p>変数は <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">&lt;変数定義&gt;</span> <span class="pre">|</span> <span class="pre">&lt;ジョブ&gt;</span> <span class="pre">}</span></code> という構文を用いて定義することができます。
<code class="docutils literal notranslate"><span class="pre">&lt;変数定義&gt;</span></code> の部分は <code class="docutils literal notranslate"><span class="pre">変数名</span> <span class="pre">=</span> <span class="pre">値(または式)</span></code> という形式で記述します。
コンマで区切って複数の変数定義を記述することもできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ x = &#39;what do you get if you multiply six by nine?&#39;, y = 6 * 9 |
  print(x) -&gt; print(y) }
</pre></div>
</div>
<p>この場合、変数 <code class="docutils literal notranslate"><span class="pre">x</span></code> が <code class="docutils literal notranslate"><span class="pre">'what</span> <span class="pre">do</span> <span class="pre">you</span> <span class="pre">get</span> <span class="pre">if</span> <span class="pre">you</span> <span class="pre">multiply</span> <span class="pre">six</span> <span class="pre">by</span> <span class="pre">nine?'</span></code>
という文字列で初期化され、変数 <code class="docutils literal notranslate"><span class="pre">y</span></code> が <code class="docutils literal notranslate"><span class="pre">6</span> <span class="pre">*</span> <span class="pre">9</span></code> と式の計算結果で初期化されます。
変数定義の後に縦棒 <code class="docutils literal notranslate"><span class="pre">|</span></code> で区切って、その変数を参照するジョブを記述することができます。</p>
<p>上のジョブフローを実行すると、コンソールには以下のように表示されます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>what do you get if you multiply six by nine?
54
</pre></div>
</div>
</section>
<section id="id8">
<h3><span class="section-number">3.3.2. </span>識別子<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h3>
<p>変数名などに用いる識別子には、Unicode で単語文字として分類される文字が使用できます。
これには日本語の漢字や平仮名、英数字やアンダースコアが含まれています（アンダースコア
以外の記号は含まれません）。ただし、識別子の先頭に数字 <code class="docutils literal notranslate"><span class="pre">[0-9]</span></code> は使用できません。</p>
<p>したがって、以下のような文字列は識別子として使用可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x, foo123, 結果, __reserved_variable__
</pre></div>
</div>
<p>次のような文字列は識別子として使用できません。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1st, foo-bar, @id, #hash
</pre></div>
</div>
<p>なお、以下は予約語またはキーワードとして扱われるため、変数名などに用いることはできません。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>and             break           case            choice
continue        elif            else            false
for             fork            if              in
not             null            or              pfor
then            true            while
</pre></div>
</div>
</section>
<section id="id9">
<h3><span class="section-number">3.3.3. </span>スコープ<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h3>
<p>変数の有効範囲（スコープ）は <code class="docutils literal notranslate"><span class="pre">{</span></code> と <code class="docutils literal notranslate"><span class="pre">}</span></code> で囲まれた範囲です。
スコープ内で定義されていない変数は参照できないため、
以下のようなジョブフローは実行時にエラーとなります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ x = &#39;hello&#39; |      # 変数 x のスコープは
    print(x) }       # ここまで
-&gt; print(x)          # ここはスコープ外
</pre></div>
</div>
<p>なお、以下のようにスコープを入れ子にすることは可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ x = &#39;outer&#39;, y = 999 |
    print(x) -&gt; print(y)
    -&gt; { x = &#39;inner&#39; |
        print(x) -&gt; print(y) }
    -&gt; print(x) -&gt; print(y)
}
</pre></div>
</div>
<p>このジョブフローを実行すると以下のようになり、 <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">'inner'</span></code> のスコープが
3～4行目であり、5行目では外側のスコープを参照していることが分かります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>outer
999
inner
999
outer
999
</pre></div>
</div>
<p>すなわち、ジョブフローでの変数のスコープ規則は、C や Java などと同様です。</p>
</section>
<section id="id10">
<h3><span class="section-number">3.3.4. </span>変数の代入<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h3>
<p>定義された変数の値を変更するには、 <code class="docutils literal notranslate"><span class="pre">[変数</span> <span class="pre">=</span> <span class="pre">値(または式)]</span></code>
という形式の <strong>代入ジョブ</strong> を使います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ x = &#39;outer&#39;, y = &#39;foo&#39; |
    print(x) -&gt; print(y) -&gt;
    { x = &#39;1st&#39; |
        print(x)
        -&gt; [x = &#39;2nd&#39;] -&gt; print(x)
        -&gt; [x = &#39;3rd&#39;] -&gt; print(x)
        -&gt; [y = &#39;bar&#39;]
        -&gt; [z = &#39;baz&#39;] }
    -&gt; print(x) -&gt; print(y) }
-&gt; print(z)
</pre></div>
</div>
<p>スコープが入れ子になっている場合、代入はその位置を含む外側のスコープ
のうち対象となる変数定義を含む <strong>もっとも内側のスコープ</strong> に対して行われます。
上の例で言うと、5～6行目で値を代入している変数 <code class="docutils literal notranslate"><span class="pre">x</span></code> は 3行目で定義したもの、
7行目で代入している変数 <code class="docutils literal notranslate"><span class="pre">y</span></code> は1行目で定義したものです。</p>
<p>未定義の変数に対して値を代入すると、 <strong>最も外側のスコープ（ジョブフロースコープ）</strong>
で変数が新たに定義され、その値にセットされます。
上の例で言うと、8行目で値を代入している変数 <code class="docutils literal notranslate"><span class="pre">z</span></code> はその時点では未定義であるため、
最も外側のスコープに新たに定義され、10行目で表示できることになります。</p>
<p>最も外側のスコープというのは明示的に <code class="docutils literal notranslate"><span class="pre">{}</span></code> で囲まれてはいませんが、
ジョブフロー全体を囲んでいるスコープがあると考えてください。</p>
<p>上記のジョブフローの実行結果は以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>outer
foo
1st
2nd
3rd
outer
bar
baz
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">$RESULT</span></code> や <code class="docutils literal notranslate"><span class="pre">$STATUS</span></code> など状態変数は Kompira が内部的に値を設定するもので、
ジョブフローで状態変数への値の代入はできません。</p>
</div>
</section>
<section id="id11">
<h3><span class="section-number">3.3.5. </span>配列と辞書<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id12">
<h4><span class="section-number">3.3.5.1. </span>配列<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h4>
<p>複数の値を一度に保持したい場合は配列や辞書を使います。
配列は <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">式,...</span> <span class="pre">]</span></code> と角括弧の中にコンマで複数の値や式を区切って記述します。
配列要素へのアクセスは 0 始まりのインデックスを角括弧で指定することで可能です。
また配列要素の書き換えは <code class="docutils literal notranslate"><span class="pre">[値</span> <span class="pre">&gt;&gt;</span> <span class="pre">配列要素]</span></code> で可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[arr = [1, true, &#39;foo&#39; ,[&#39;nested&#39;, &#39;array&#39;]]] -&gt;
print(arr[1]) -&gt;              # 配列要素の参照
[false &gt;&gt; arr[1]] -&gt;          # 配列要素の書き換え
[arr = arr + [&#39;added&#39;]] -&gt;    # 配列要素の追加
print(arr[3][1]) -&gt;           # 入れ子になった配列要素の参照
print(arr)                    # print() は配列自体の表示も可能
</pre></div>
</div>
<p>このジョブフローを実行すると、以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>true
array
[1, false, &#39;foo&#39;, [&#39;nested&#39;, &#39;array&#39;], &#39;added&#39;]
</pre></div>
</div>
<p>また負の値をインデックスに指定すると、配列の後ろから要素にアクセスします。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[arr = [1, true, &#39;foo&#39;]] -&gt; print(arr[-1])
</pre></div>
</div>
<p>このジョブフローの実行結果は次のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>foo
</pre></div>
</div>
</section>
<section id="id13">
<h4><span class="section-number">3.3.5.2. </span>辞書<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h4>
<p>辞書は <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">識別子=式,...</span> <span class="pre">}</span></code> と波括弧の中にコンマで複数の <code class="docutils literal notranslate"><span class="pre">識別子=値</span></code> を区切って記述します。
辞書要素へのアクセスはドット記法または識別子を角括弧で指定することで可能です。
また辞書要素の書き換えは <code class="docutils literal notranslate"><span class="pre">[値</span> <span class="pre">&gt;&gt;</span> <span class="pre">辞書要素]</span></code> で可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[dic = {foo=1, bar=true, baz={a=123, b=456}}] -&gt;
print(dic.foo) -&gt;             # 辞書要素の参照（ドット記法）
[false &gt;&gt; dic.bar] -&gt;         # 辞書要素の書き換え
print(dic[&#39;bar&#39;]) -&gt;          # 辞書要素の参照（角括弧記法）
[[1,2,3] &gt;&gt; dic.arr] -&gt;       # 辞書要素の追加
print(dic.baz.a) -&gt;           # 入れ子になった辞書要素の参照
[777 &gt;&gt; dic.baz.a] -&gt;         # 入れ子になった辞書要素の書き換え
[999 &gt;&gt; dic[&#39;baz&#39;][&#39;b&#39;]] -&gt;   # 入れ子になった辞書要素の書き換え
print(dic)                    # print() は辞書自体の表示も可能
</pre></div>
</div>
<p>このジョブフローを実行すると、以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1
false
123
{foo=1, bar=false, baz={a=777, b=999}, arr=[1, 2, 3]}
</pre></div>
</div>
</section>
</section>
<section id="id14">
<h3><span class="section-number">3.3.6. </span>テンプレート文字列<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブフローでは文字列中に変数の値を展開することができます。
以下のように文字列中に <code class="docutils literal notranslate"><span class="pre">$</span></code> と識別子からなるプレースホルダがあると、
その部分が識別子の示す変数値で置き換えられます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[service = &#39;http&#39;, port = 80] -&gt;
print(&#39;Port $port is used by $service&#39;)
</pre></div>
</div>
<p>このジョブフローを実行すると以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Port 80 is used by http
</pre></div>
</div>
<p>プレースホルダは <code class="docutils literal notranslate"><span class="pre">$識別子</span></code> のほかに <code class="docutils literal notranslate"><span class="pre">${識別子}</span></code> という記法も可能ですので、
文字列中で識別子の区切りがつかない場合に使用してください。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[w=640, h=480] -&gt;
print(&quot;width=${w}px, height=${h}px&quot;)
</pre></div>
</div>
<p>また、文字列のあとに <code class="docutils literal notranslate"><span class="pre">%</span></code> を書くと続く辞書に含まれる値を展開することもできます。
その場合は文字列中に <code class="docutils literal notranslate"><span class="pre">%</span></code> と識別子からなるプレースホルダを記述します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&#39;Port %port is used by %service&#39; % {service = &#39;http&#39;, port = 80})
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">%</span></code> に続ける辞書はもちろん変数でもよいので以下のようにも書けます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[ctx = {service = &#39;http&#39;, port = 80}] -&gt;
print(&#39;Port %port is used by %service&#39; % ctx)
</pre></div>
</div>
<p>いずれの記法でもプレースホルダが指定する変数や辞書要素が未定義である場合は、
<code class="docutils literal notranslate"><span class="pre">$</span></code> や <code class="docutils literal notranslate"><span class="pre">%</span></code> も含めてそのまま文字列中に残ります。</p>
</section>
<section id="id15">
<h3><span class="section-number">3.3.7. </span>パラメータ<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブフローはその実行時にパラメータを受け取ることができます。</p>
<p>ジョブフローの先頭で変数名を縦棒で囲む <code class="docutils literal notranslate"><span class="pre">|変数名|</span></code> という記法で、
その変数をパラメータとして定義することができます。
また、 <code class="docutils literal notranslate"><span class="pre">|変数名</span> <span class="pre">=</span> <span class="pre">値(または式)|</span></code> と記述することで、
パラメータのデフォルト値を定義することができます。
デフォルト値が定義されていないパラメータは、ジョブフローの実行時に
値を指定する必要がある（省略できない）ことに注意してください。</p>
<p>以下のジョブフローでは、 <code class="docutils literal notranslate"><span class="pre">command</span></code> と <code class="docutils literal notranslate"><span class="pre">wait</span></code> という2つのパラメータを
定義していて、 <code class="docutils literal notranslate"><span class="pre">wait</span></code> にはデフォルト値として 10 が設定されています。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>| command |
| wait = 10 |

print(&#39;Execute the command &quot;$command&quot; after $wait seconds.&#39;) -&gt;
[&quot;sleep $wait&quot;] -&gt;
[command] -&gt;
print($RESULT)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>パラメータはジョブフローの実行開始時に上から順番に評価されます。
そのため先に登場したパラメータの値を参照する式を使うこともできます。</p>
</div>
</section>
</section>
<section id="id16">
<h2><span class="section-number">3.4. </span>リモートでコマンド実行する<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">¶</a></h2>
<p>次は、ジョブマネージャが動作しているホストとは別のホスト上で
コマンドを実行させてみましょう。</p>
<section id="id17">
<h3><span class="section-number">3.4.1. </span>制御変数による指定<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">¶</a></h3>
<p>まずは制御変数によるコマンドを実行するホストやアカウントの指定方法です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[__host__ = &#39;&lt;ホスト名 もしくは IPアドレス&gt;&#39;,
 __user__ = &#39;&lt;ユーザー名&gt;&#39;,
 __password__ = &#39;&lt;パスワード&gt;&#39;]
-&gt; [&#39;hostname&#39;] -&gt; print($RESULT)
-&gt; [&#39;whoami&#39;] -&gt; print($RESULT)
-&gt; [&#39;echo Hello World&#39;] -&gt; print($RESULT)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">&lt;ホスト名&gt;</span></code> や <code class="docutils literal notranslate"><span class="pre">&lt;ユーザー名&gt;</span></code> 、 <code class="docutils literal notranslate"><span class="pre">&lt;パスワード&gt;</span></code> は、
自分の環境に合わせて書き変えてください。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">__host__</span></code> ,  <code class="docutils literal notranslate"><span class="pre">__user__</span></code> ,  <code class="docutils literal notranslate"><span class="pre">__password__</span></code> は、Kompira で予約済みの
<strong>制御変数</strong> で、これらの変数にそれぞれ、ホスト名(またはIPアドレス)，
ユーザー名，パスワードを設定しておくことで、以降のリモートを処理対象とする
ジョブを設定したホストとユーザー名で実行します。</p>
<p>成功すれば、実行結果は以下のように表示されるはずです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ホスト名&gt;
&lt;ユーザー名&gt;
Hello World
</pre></div>
</div>
<p>もし、ホスト名が間違っていたり、ユーザー名やパスワードが間違っていると、
ジョブフローが失敗し、処理が中止（abort）されます。</p>
</section>
<section id="id18">
<h3><span class="section-number">3.4.2. </span>ノード情報とアカウント情報の指定<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">¶</a></h3>
<p>ノード情報オブジェクトとアカウント情報オブジェクトを Kompira ファイルシス
テム上に作成しておくと、それらをコマンド実行の対象サーバとしてジョブフ
ローから指定することができます。</p>
<p>今、ノード情報オブジェクト <code class="docutils literal notranslate"><span class="pre">test_node</span></code> とアカウント情報オブジェクト
<code class="docutils literal notranslate"><span class="pre">test_account</span></code> を作成し、ホスト名やユーザ名、パスワード情報が適切に
設定されているとします。
すると、同じディレクトリにあるジョブフローからのコマンド実行は、
ノード情報オブジェクトの指定には制御変数 <code class="docutils literal notranslate"><span class="pre">__node__</span></code> を、
アカウント情報オブジェクトの指定には <code class="docutils literal notranslate"><span class="pre">__account__</span></code> を使用することで、
以下のように簡潔に記述することができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[__node__ = ./test_node, __account__ = ./test_account]
-&gt; [&#39;hostname&#39;] -&gt; print($RESULT)
-&gt; [&#39;whoami&#39;] -&gt; print($RESULT)
-&gt; [&#39;echo Hello World&#39;] -&gt; print($RESULT)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ジョブフローから Kompira オブジェクトの参照は、相対パスまたは絶対パスで
記述することで行えます。上の例では <code class="docutils literal notranslate"><span class="pre">./</span></code> で始まる同じディレクトリ
にあるオブジェクトを指定していますが、 <code class="docutils literal notranslate"><span class="pre">../</span></code> や <code class="docutils literal notranslate"><span class="pre">/</span></code> で始まるパス
で親ディレクトリやルートディレクトリを基準とした指定も可能です。</p>
</div>
<p>なおノード情報オブジェクト <code class="docutils literal notranslate"><span class="pre">test_node</span></code> にデフォルトアカウントを
設定している場合は、 <code class="docutils literal notranslate"><span class="pre">__account__</span></code> の指定を省略することも可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[__node__ = ./test_node]
-&gt; [&#39;hostname&#39;] -&gt; print($RESULT)
-&gt; [&#39;whoami&#39;] -&gt; print($RESULT)
</pre></div>
</div>
<p>また、制御変数をジョブフローのパラメータとして指定することもできるので、
実行時に制御対象ノードを指定するジョブフローを作ることもできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|__node__ = ./test_node|
-&gt; [&#39;hostname&#39;] -&gt; print($RESULT)
</pre></div>
</div>
</section>
<section id="sudo">
<h3><span class="section-number">3.4.3. </span>sudoによる実行<a class="headerlink" href="#sudo" title="この見出しへのパーマリンク">¶</a></h3>
<p>コマンドの実行にroot権限が必要な場合、 <code class="docutils literal notranslate"><span class="pre">__sudo__</span></code> 制御変数に <code class="docutils literal notranslate"><span class="pre">true</span></code>
をセットして sudo モードに移行します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|__node__ = ./test_node|
-&gt; [&#39;whoami&#39;] -&gt; print($RESULT)
-&gt; [__sudo__ = true]
-&gt; [&#39;whoami&#39;] -&gt; print($RESULT)
</pre></div>
</div>
<p>このジョブフローを実行するとコンソールには以下のように表示されます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ユーザー名&gt;
root
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>sudo モードでコマンドを正しく実行するためには、そのユーザーが sudoers
ファイルに登録されている必要があります。そうでない場合には、sudo モード
でのリモートコマンド実行時に処理が失敗(abort)します。
詳しくはマニュアル sudoers(5) を参照してください。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ホストを指定しないコマンド実行ジョブを sudo モードで実行する場合、
ジョブマネージャを実行しているサーバ（通常は Kompira をインストール
したサーバ）の <code class="docutils literal notranslate"><span class="pre">kompira</span></code> ユーザーを sudoers ファイルに登録する必要が
あります。
さらに、以下のように requiretty フラグを無効にする設定を
sudoers ファイルに追加しておく必要もあります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Defaults:kompira    !requiretty
</pre></div>
</div>
</div>
</section>
</section>
<section id="id19">
<h2><span class="section-number">3.5. </span>制御構造でジョブを操る<a class="headerlink" href="#id19" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id20">
<h3><span class="section-number">3.5.1. </span>条件分岐<a class="headerlink" href="#id20" title="この見出しへのパーマリンク">¶</a></h3>
<p>直前のジョブの実行結果や変数の内容によって処理を分岐させるには、
<code class="docutils literal notranslate"><span class="pre">if</span></code> ブロックもしくは <code class="docutils literal notranslate"><span class="pre">case</span></code> ブロックを利用します。</p>
<section id="if">
<h4><span class="section-number">3.5.1.1. </span>if ブロック<a class="headerlink" href="#if" title="この見出しへのパーマリンク">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code> ブロックを使うと条件式の結果によって、処理を分岐させることができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;echo $$RANDOM&#39;] -&gt;
[x = int($RESULT)] -&gt;
{ if x % 2 == 0 |
    then: print(&#39;$x は偶数です&#39;)
    else: print(&#39;$x は奇数です&#39;)
}
</pre></div>
</div>
<p>上記では、変数 <code class="docutils literal notranslate"><span class="pre">x</span></code> の値を2で割った余りが0に等しければ <code class="docutils literal notranslate"><span class="pre">then</span></code> 節が実行され、
それ以外の場合は <code class="docutils literal notranslate"><span class="pre">else</span></code> 節が実行されます。なお、 <code class="docutils literal notranslate"><span class="pre">['echo</span> <span class="pre">$$RANDOM']</span></code> は乱数
を返す環境変数である <code class="docutils literal notranslate"><span class="pre">RANDOM</span></code> を表示しており、 <code class="docutils literal notranslate"><span class="pre">[x</span> <span class="pre">=</span> <span class="pre">int($RESULT)]</span></code> はその
結果の文字列を整数化して変数 <code class="docutils literal notranslate"><span class="pre">x</span></code> に代入しています。</p>
<p>真・偽だけでなく、さらに処理を分岐させたい場合は <code class="docutils literal notranslate"><span class="pre">elif</span></code> 節を使います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ if x % 3 == 0 and x % 5 == 0 |
    then: print(&#39;FizzBuzz&#39;)           # x が 3 でも 5 でも割り切れれば &#39;FizzBuzz&#39; と表示
    elif x % 3 == 0: print(&#39;Fizz&#39;)    # x が 3 で割り切れれば &#39;Fizz&#39; と表示
    elif x % 5 == 0: print(&#39;Buzz&#39;)    # x が 5 で割り切れれば &#39;Buzz&#39; と表示
    else: print(x)                    # それ以外の場合は x を表示
}
</pre></div>
</div>
<p>逆に <code class="docutils literal notranslate"><span class="pre">else</span></code> 節を省略することも可能です。
さらにその場合は <code class="docutils literal notranslate"><span class="pre">then</span></code> キーワードを省略することもできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[command] =&gt;
{ if $STATUS != 0 | print(&#39;エラーが発生しました: &#39; + $ERROR) }
</pre></div>
</div>
<p>上記の例では変数 <code class="docutils literal notranslate"><span class="pre">command</span></code> の内容が示すコマンドを実行し、その結果ステータス <code class="docutils literal notranslate"><span class="pre">$STATUS</span></code>
の値が0でないとき、 <code class="docutils literal notranslate"><span class="pre">print</span></code> ジョブで標準エラー出力(<code class="docutils literal notranslate"><span class="pre">$ERROR</span></code>)を表示します。</p>
</section>
<section id="case">
<h4><span class="section-number">3.5.1.2. </span>case ブロック<a class="headerlink" href="#case" title="この見出しへのパーマリンク">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">case</span></code> ブロックによる条件分岐は以下のように書けます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;cat /etc/redhat-release&#39;] -&gt;
{ case $RESULT |
    &#39;CentOS*release 7.*&#39;: print(&quot;CentOS です&quot;)
    &#39;Red Hat*release 7.*&#39;: print(&quot;Red Hat です&quot;)
    else: print(&quot;CentOS/Red Hat 7.x が必要です&quot;)
}
</pre></div>
</div>
<p>この例では、ファイル <code class="docutils literal notranslate"><span class="pre">/etc/redhat-release</span></code> の内容で OS の種別を判定
するために条件分岐を行っています。
パターン文字列には <code class="docutils literal notranslate"><span class="pre">*</span></code> や <code class="docutils literal notranslate"><span class="pre">?</span></code> などUnixのワイルドカードが使用できます。</p>
<p><code class="docutils literal notranslate"><span class="pre">case</span></code> ブロックでの文字列のマッチングは先頭のパターンから順次行われ、
最初にマッチしたパターンに続くジョブフロー系列のみが実行されます。</p>
<p>どのパターンにもマッチしなかった場合は以下のようになります。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">else</span></code> 節が含まれる場合はそのジョブフロー系列が実行されます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">else</span></code> 節が含まれない場合は <code class="docutils literal notranslate"><span class="pre">case</span></code> ブロック全体が失敗します
（<code class="docutils literal notranslate"><span class="pre">$STATUS</span></code> に1がセットされます）。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">if</span></code> ブロックとは異なり、 <code class="docutils literal notranslate"><span class="pre">case</span></code> ブロックでは <code class="docutils literal notranslate"><span class="pre">else</span></code> 節を省略していて
どの条件にもマッチしなかった場合はブロック全体が失敗することに注意が必要です。
<code class="docutils literal notranslate"><span class="pre">case</span></code> ブロックでマッチしなかった場合に何もせずエラーにもしない場合は、
<code class="docutils literal notranslate"><span class="pre">else:</span> <span class="pre">[]</span></code> とスキップジョブを <code class="docutils literal notranslate"><span class="pre">else</span></code> 節に書くようにしてください。</p>
</div>
</section>
</section>
<section id="id21">
<h3><span class="section-number">3.5.2. </span>繰り返し<a class="headerlink" href="#id21" title="この見出しへのパーマリンク">¶</a></h3>
<p>繰り返しは <code class="docutils literal notranslate"><span class="pre">for</span></code> ブロックや <code class="docutils literal notranslate"><span class="pre">while</span></code> ブロックを用います。</p>
<section id="for">
<h4><span class="section-number">3.5.2.1. </span>for ブロック<a class="headerlink" href="#for" title="この見出しへのパーマリンク">¶</a></h4>
<p>Kompira が扱えるオブジェクトには、配列や辞書といった複合データまたはディレクトリ
など子要素を含むものがあります。あるオブジェクトに含まれる子要素（値やオブジェクト）
に対して同じ処理を行ないたい場合 <code class="docutils literal notranslate"><span class="pre">for</span></code> ブロックを用います。
<code class="docutils literal notranslate"><span class="pre">for</span></code> ブロックの構文は以下のようなものです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ for &lt;ループ変数&gt; in &lt;子要素を含むオブジェクト&gt; | ジョブ... }
</pre></div>
</div>
<p>たとえば <code class="docutils literal notranslate"><span class="pre">in</span></code> 節に &lt;ディレクトリパス&gt; を記述することで、
そのディレクトリの中にあるオブジェクトのリストを参照することができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ for t in /system/types | print(t) }
</pre></div>
</div>
<p>この例では /system/types ディレクトリの中にあるすべてのオブジェクトを、１つずつ
ループ変数 <code class="docutils literal notranslate"><span class="pre">t</span></code> で参照して <code class="docutils literal notranslate"><span class="pre">print()</span></code> ジョブでコンソールに出力しています。
なお Kompira オブジェクトを <code class="docutils literal notranslate"><span class="pre">print()</span></code> ジョブに渡すと、
その絶対パスがコンソールに出力されるため、結果は以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/system/types/TypeObject
/system/types/Directory
/system/types/License
/system/types/Virtual
/system/types/Jobflow
/system/types/Channel
    :
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">in</span></code> 節には以下のように直接配列を記述することも可能です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ sum = 0 |
    { for i in [1,2,3,4,5,6,7,8,9,10] |
        [sum = sum + i]
    } -&gt;
    print(&#39;The total of 1 to 10 is ${sum}.&#39;)
}
</pre></div>
</div>
<p>このジョブフローは、1から10までの合計値を計算して出力します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The total of 1 to 10 is 55.
</pre></div>
</div>
<p>また辞書を <code class="docutils literal notranslate"><span class="pre">in</span></code> 節に続けて記述した場合は、その辞書に含まれる識別子の
リストを順次参照することができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[dic = {a=10, b=20, c=30}] -&gt;
{ for k in dic |
    print(&quot;$k = %{$k}&quot; % dic)
}
</pre></div>
</div>
<p>このジョブフローを実行するとコンソールには以下のように表示されます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>a = 10
b = 20
c = 30
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">%{$k}</span></code> となっている部分は <code class="docutils literal notranslate"><span class="pre">%</span></code> によるテンプレート展開の前に <code class="docutils literal notranslate"><span class="pre">$k</span></code>
の部分が辞書の識別子によって置き換えられます。そのため、繰り返しの
たびにまず <code class="docutils literal notranslate"><span class="pre">%a</span></code>, <code class="docutils literal notranslate"><span class="pre">%b</span></code>, <code class="docutils literal notranslate"><span class="pre">%c</span></code> と展開され、それが辞書 <code class="docutils literal notranslate"><span class="pre">dic</span></code> の
各要素の値でテンプレート展開されて <code class="docutils literal notranslate"><span class="pre">10</span></code>, <code class="docutils literal notranslate"><span class="pre">20</span></code>, <code class="docutils literal notranslate"><span class="pre">30</span></code> と表示さ
れます。</p>
</div>
</section>
<section id="while">
<h4><span class="section-number">3.5.2.2. </span>while ブロック<a class="headerlink" href="#while" title="この見出しへのパーマリンク">¶</a></h4>
<p>繰り返す対象が決まっているのではなく、ある条件を満たすあいだはジョブを
繰り返し処理したいという場合は <code class="docutils literal notranslate"><span class="pre">while</span></code> ブロックを用います。 <code class="docutils literal notranslate"><span class="pre">while</span></code>
ブロックの構文は以下のようなものです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ while &lt;式&gt; | ジョブ... }
</pre></div>
</div>
<p>例えば、与えられた2つの数の最大公約数を求める「ユークリッドの互除法」は
剰余が0になるまで繰り返すアルゴリズムですが、これを <code class="docutils literal notranslate"><span class="pre">while</span></code> ブロックを
用いて記述すると以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|x = 165|
|y = 105|
[m = x, n = y] -&gt;
{ while n != 0 |
    [r = m % n] -&gt;
    print(&quot;$m と $n の剰余は $r です&quot;) -&gt;
    [m = n, n = r]
} -&gt;
print(&quot;$x と $y の最大公約数は $m です&quot;)
</pre></div>
</div>
<p>この <code class="docutils literal notranslate"><span class="pre">while</span></code> ブロックの部分では、 <code class="docutils literal notranslate"><span class="pre">n</span></code> が 0 ではない間、 <code class="docutils literal notranslate"><span class="pre">m</span></code> には
<code class="docutils literal notranslate"><span class="pre">n</span></code> を、 <code class="docutils literal notranslate"><span class="pre">n</span></code> には <code class="docutils literal notranslate"><span class="pre">m</span></code> と <code class="docutils literal notranslate"><span class="pre">n</span></code> の剰余を代入する（および表示する）、
というジョブを繰り返しています。実行すると以下のように表示されます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>165 と 105 の剰余は 60 です
105 と 60 の剰余は 45 です
60 と 45 の剰余は 15 です
45 と 15 の剰余は 0 です
165 と 105 の最大公約数は 15 です
</pre></div>
</div>
</section>
</section>
<section id="id22">
<h3><span class="section-number">3.5.3. </span>ジョブの呼び出し<a class="headerlink" href="#id22" title="この見出しへのパーマリンク">¶</a></h3>
<section id="id23">
<h4><span class="section-number">3.5.3.1. </span>ジョブフローの呼び出し<a class="headerlink" href="#id23" title="この見出しへのパーマリンク">¶</a></h4>
<p>あるジョブフローから別のジョブフローを呼び出すには以下の様な構文を用います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;ジョブフローオブジェクト&gt;]
</pre></div>
</div>
<p>ここでは「サブジョブ」というジョブを作成して、それを呼び出す例を示します。
まず、サブジョブを適当なディレクトリの下で、以下のように定義します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&quot;サブジョブです&quot;) -&gt;
return(&quot;成功しました&quot;)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">return</span></code> ジョブは、サブジョブを終了し、結果を呼び出し側のジョブに返します。</p>
<p>次に、このサブジョブを呼び出すメインジョブを同じディレクトリの下に作成しま
す。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&quot;サブジョブを呼び出します&quot;)
-&gt; [./サブジョブ]              # サブジョブを呼び出す
-&gt; print($RESULT)              # サブジョブの実行結果を出力する
</pre></div>
</div>
<p>「サブジョブ」の呼び出しを指定するところで、文字列の先頭に「./」を追加
していることに注意してください。これは、現在のジョブフローが定義されて
いるディレクトリと同じディレクトリ内に「サブジョブ」が定義されているこ
とを示しています。</p>
<p>サブジョブの実行結果は <code class="docutils literal notranslate"><span class="pre">$RESULT</span></code> で受け取ることができます。
上記のメインジョブを実行すると、以下のように表示されます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>サブジョブを呼び出します
サブジョブです
成功しました
</pre></div>
</div>
</section>
<section id="id24">
<h4><span class="section-number">3.5.3.2. </span>ジョブフローへのパラメータ渡し<a class="headerlink" href="#id24" title="この見出しへのパーマリンク">¶</a></h4>
<p>ジョブフローを呼び出すときに、次のような構文を用いてパラメータを渡すこともできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&lt;ジョブフローオブジェクト&gt; : &lt;パラメータ列&gt; ... ]
</pre></div>
</div>
<p>まず、サブジョブを拡張して、以下のようにパラメータを追加してみましょう。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|パラメータ1 = &#39;Hello&#39;|
|パラメータ2 = &#39;World&#39;|

print(&quot;サブジョブです&quot;)
-&gt; print(パラメータ1)
-&gt; print(パラメータ2)
-&gt; return(&quot;成功しました&quot;)
</pre></div>
</div>
<p>この状態でさきほどのメインジョブをそのまま実行すると、以下のように表示されます。
呼び出し時にパラメータを指定していないため、サブジョブ側で定義した
デフォルトパラメータが使われていることがわかります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>サブジョブを呼び出します
サブジョブです
Hello
World
成功しました
</pre></div>
</div>
<p>このサブジョブにパラメータを渡して呼び出すには、メインジョブを以下のように
拡張します。サブジョブ呼び出し時に、 <code class="docutils literal notranslate"><span class="pre">:</span></code> に続けて値を記述することで、
それらをパラメータ値としてサブジョブに渡すことができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&quot;パラメータ付きでサブジョブを呼び出します&quot;)
-&gt; [./サブジョブ: &#39;こんにちは&#39;, &#39;世界&#39;]
-&gt; print($RESULT)
</pre></div>
</div>
<p>これを実行すると、以下のような結果となります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>パラメータ付きでサブジョブを呼び出します
サブジョブです
こんにちは
世界
成功しました
</pre></div>
</div>
<p>呼び出されるジョブフロー側で定義したパラメータ名を指定して、パラメータ値を
渡すこともできます。一部のパラメータだけ指定したい場合などに便利です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[./サブジョブ: パラメータ2=&#39;世界&#39;]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>呼び出される側で定義されていないパラメータ名を指定したり、定義されたより
多くのパラメータ値を渡そうとしたりするとエラーになるので注意してください。</p>
</div>
</section>
<section id="id25">
<h4><span class="section-number">3.5.3.3. </span>スクリプトジョブの実行<a class="headerlink" href="#id25" title="この見出しへのパーマリンク">¶</a></h4>
<p>より複雑なジョブを作成したい場合、Kompiraジョブフロー言語よりも、bash,
perl, ruby, python などの既存のスクリプト言語を組み合わせて使った方が良
いでしょう。Kompira ファイルシステム上で、スクリプトジョブを作成すること
で、これらのスクリプト言語のプログラムをジョブフローから呼び出すことが
可能になります。</p>
<p>ここでは、シェルスクリプトを用いてスクリプトジョブを記述し、それをジョ
ブフローから呼び出す例をみてみます。まず、以下に示すような簡単なシェル
スクリプトをスクリプトジョブとして保存します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#! /bin/sh
echo Hello world from shell script
</pre></div>
</div>
<p>Unix 環境で実行させるスクリプトの場合は、1行目の <code class="docutils literal notranslate"><span class="pre">#!</span></code> で始まる shebang
行を適切に記述してください。Windows 環境で実行するスクリプトの場合は
拡張子(bat/vbs/ps1など)を適切に指定する必要があります。</p>
<p>このスクリプトジョブを「サンプルスクリプト」として保存したとすると、
これを実行するためのジョブフローは、以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&#39;スクリプトジョブを実行します&#39;) -&gt;
[./サンプルスクリプト] -&gt;
print($RESULT)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">__node__</span></code> や <code class="docutils literal notranslate"><span class="pre">__host__</span></code> を指定しない場合、このスクリプトは
ジョブマネージャが動作しているマシン上に転送された上で実行されます。
実行結果の出力は、リモートコマンドの実行結果と同じように <code class="docutils literal notranslate"><span class="pre">$RESULT</span></code> に格納されます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>スクリプトは実行時に指定したホストに一時ファイルとして転送され、
実行後に削除されます。</p>
</div>
<p>スクリプトジョブにもパラメータを渡すことができます。
スクリプトジョブ側では、コマンドライン引数としてパラメータを受け取ります。</p>
<p>スクリプトの呼び出し側では、以下のようにキーワード無しの引数としてパラ
メータを渡します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[./サンプルスクリプト: &#39;パラメータ1&#39;, &#39;パラメータ2&#39;]
</pre></div>
</div>
</section>
</section>
</section>
<section id="id26">
<h2><span class="section-number">3.6. </span>オブジェクトを操作する<a class="headerlink" href="#id26" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id27">
<h3><span class="section-number">3.6.1. </span>オブジェクトの参照<a class="headerlink" href="#id27" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブフローや環境変数定義など、Kompira で扱う情報は <strong>Kompira オブジェクト</strong>
として、Kompira ファイルシステム上で一元的に管理されています。
そしてこれらのオブジェクトは Unix のファイルシステムのようなパス指定によっ
てジョブフローからアクセスすることができます。</p>
<p>これまでの例では、Kompira オブジェクトの参照は相対パスによって指定していました。
この場合、オブジェクトのパスは、実行中のジョブフローが定義されている
ディレクトリを基準にして特定されます。</p>
<p>たとえば、実行中のジョブが <code class="docutils literal notranslate"><span class="pre">/some/path/jobflow</span></code> であるときに、
<code class="docutils literal notranslate"><span class="pre">./subdir/object</span></code> という相対パスによってオブジェクトを参照すると、
<code class="docutils literal notranslate"><span class="pre">/some/path/subdir/object</span></code> がアクセスされることになります。</p>
<p>また、 <code class="docutils literal notranslate"><span class="pre">../object</span></code> という相対パスによって参照すると、 <code class="docutils literal notranslate"><span class="pre">/some/object</span></code>
がアクセスされることになります。 <code class="docutils literal notranslate"><span class="pre">../</span></code> で始まる相対パスは親ディレクトリ
にあるオブジェクトを参照することを意味します。</p>
<p>もちろん絶対パスで <code class="docutils literal notranslate"><span class="pre">/some/path/object</span></code> のように直接オブジェクトを参照することもできます。</p>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>Kompira オブジェクトの参照では先頭に、 <code class="docutils literal notranslate"><span class="pre">./</span></code> や <code class="docutils literal notranslate"><span class="pre">../</span></code> 、 <code class="docutils literal notranslate"><span class="pre">/</span></code> を付けるのを忘れないでください。
Kompiraは <code class="docutils literal notranslate"><span class="pre">./</span></code> や <code class="docutils literal notranslate"><span class="pre">../</span></code> 、 <code class="docutils literal notranslate"><span class="pre">/</span></code> から始まる文字列を <strong>パス識別</strong> と認識し、
それ以外は変数の識別子と認識します。</p>
</div>
<p>パスを連結させてオブジェクトを参照したい場合は、 <code class="docutils literal notranslate"><span class="pre">path()</span></code> 組み込み関数を利用します。
たとえばノードの種類毎に「リソース情報取得」を行なうジョブフローを用意しておき、
ノードとノード種別を指定してそのジョブフローを実行したい場合、
パスを動的に組み立ててジョブフローを参照することができます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|node|
|node_type = &#39;Linux&#39;|
|job_name = &#39;リソース情報取得&#39;|
[job = path(./ノード別定義, node_type, job_name)] -&gt;
[job: node]
</pre></div>
</div>
<p>ここでデフォルト引数がそのまま <code class="docutils literal notranslate"><span class="pre">path()</span></code> 関数に渡された場合、 <code class="docutils literal notranslate"><span class="pre">./ノード別定義/Linux/リソース情報取得</span></code>
というジョブフローを変数 <code class="docutils literal notranslate"><span class="pre">job</span></code> で参照し、 <code class="docutils literal notranslate"><span class="pre">node</span></code> をパラメータとして渡して実行することになります。</p>
</section>
<section id="id28">
<h3><span class="section-number">3.6.2. </span>プロパティの参照と更新<a class="headerlink" href="#id28" title="この見出しへのパーマリンク">¶</a></h3>
<p>各 Kompira オブジェクトはシステムで定義された「プロパティ」を持っています。
例えばオブジェクトの名称やパス、作成日時などがプロパティです。
Kompira オブジェクトが持つプロパティの詳細については <a class="reference internal" href="library.html#lib-property"><span class="std std-ref">プロパティ</span></a> を参照してください。</p>
<p>Kompira オブジェクトのプロパティを参照するにはドット記法 <code class="docutils literal notranslate"><span class="pre">オブジェクト.プロパティ名</span></code>
を用います。
以下のジョブフローではパラメータ <code class="docutils literal notranslate"><span class="pre">dir</span></code> で指定したディレクトリにある Kompira オブジェクト
を列挙し、そのプロパティである「所有者(owner)」，「更新日時(update)」，「型名(type_name)」，
「表示名(display_name) 」をドット記法で参照して表示しています。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>| dir = / |
{ for obj in dir |
    [attr = {
        owner = obj.owner,
        updated = obj.updated,
        type = obj.type_name,
        name = obj.display_name
    }] -&gt;
    print(&quot;%owner %updated &lt;%type&gt; %name&quot; % attr)
}
</pre></div>
</div>
<p>Kompira オブジェクトのプロパティ値を更新するには、
出力ジョブ <code class="docutils literal notranslate"><span class="pre">[値</span> <span class="pre">&gt;&gt;</span> <span class="pre">オブジェクト.プロパティ]</span></code> を用います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&quot;オブジェクトの説明文&quot; &gt;&gt; obj.description]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>ただし、プロパティの中にはジョブフローからは更新できない書き込み不可なものも
ありますので注意してください。詳細は <a class="reference internal" href="library.html#lib-property"><span class="std std-ref">プロパティ</span></a> を参照してください。</p>
</div>
</section>
<section id="id29">
<h3><span class="section-number">3.6.3. </span>フィールドの参照と更新<a class="headerlink" href="#id29" title="この見出しへのパーマリンク">¶</a></h3>
<p>各 Kompira オブジェクトは型ごとに定義された「フィールド」を持っています。
システムで定義された各型にどのようなフィールドが定義されているかは、
<code class="docutils literal notranslate"><span class="pre">/system/types/</span></code> 下にある各型の定義情報を見るとわかります。</p>
<p>Kompiraオブジェクトが持つフィールドは <code class="docutils literal notranslate"><span class="pre">オブジェクト[フィールド名]</span></code>
または <code class="docutils literal notranslate"><span class="pre">オブジェクト.フィールド名</span></code> という記法で参照できます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>オブジェクトのプロパティにもドット記法でアクセスできることに注意してください。
プロパティと同名のフィールドをユーザが定義することもできますが、
ドット記法はプロパティ値を優先して参照します。</p>
</div>
<p>たとえば、ノード情報オブジェクトには「ホスト名(hostname)」や「IPアドレス(ipaddr)」
といったフィールドが定義されています。ジョブフローでこれらの値を参照するには
以下のように記述します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|node = ./node|
print(node[&#39;hostname&#39;], node.ipaddr)
</pre></div>
</div>
<p>フィールドの値は辞書のように参照できるため、 <code class="docutils literal notranslate"><span class="pre">%</span></code> によるテンプレート展開も
できます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|node = ./node|
print(&#39;%hostname: %ipaddr&#39; % node)
</pre></div>
</div>
<p>また、Kompira オブジェクトのフィールド値を更新するには、出力ジョブで
<code class="docutils literal notranslate"><span class="pre">[値</span> <span class="pre">&gt;&gt;</span> <span class="pre">オブジェクト[フィールド名]]</span></code> または
<code class="docutils literal notranslate"><span class="pre">[値</span> <span class="pre">&gt;&gt;</span> <span class="pre">オブジェクト.フィールド名]</span></code> という記法を用います。
例えば Wiki ページ型の「Wiki テキスト」フィールド('wikitext') を更新するには、
以下のように記述します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[&#39;= Sample Wiki\n&#39; &gt;&gt; ./wiki[&#39;wikitext&#39;]]
</pre></div>
</div>
<p>式の結果を出力ジョブで書き込むこともできるので、以下のように参照したフィールド値
を加工して再度書き込む、ということもできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|wiki = ./wiki|
|types = /system/types|
[&quot;= Type list\n&quot; &gt;&gt; wiki.wikitext] -&gt;
{ for type in types |
    [wiki.wikitext + &quot;* $type: (&quot; + type.description + &quot;)\n&quot; &gt;&gt; wiki.wikitext]
}
</pre></div>
</div>
<p>上の例では <code class="docutils literal notranslate"><span class="pre">/system/types</span></code> にあるシステム標準の型オブジェクトについて、
そのパスと説明の一覧を記載した Wiki ページを作成しています。</p>
</section>
<section id="id30">
<h3><span class="section-number">3.6.4. </span>メソッドの呼び出し<a class="headerlink" href="#id30" title="この見出しへのパーマリンク">¶</a></h3>
<p>Kompira オブジェクトの中にはメソッドを備えているものがあります。
オブジェクトのメソッドを呼び出すには、以下のような構文を用います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[ &lt;オブジェクト&gt; . &lt;メソッド名&gt; : &lt;パラメータ列&gt; ... ]
</pre></div>
</div>
<p>例えば、オブジェクトの追加を行なうためにディレクトリ型のオブジェクトには
<code class="docutils literal notranslate"><span class="pre">add</span></code> というメソッドがあります。 <code class="docutils literal notranslate"><span class="pre">add</span></code> メソッドは <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">type_obj</span></code>,
<code class="docutils literal notranslate"><span class="pre">data</span></code> という3つのパラメータを指定して呼び出します。
以下の例ではジョブフローと同じディレクトリに 'ENV' という名前で
環境変数型(/system/types/Environment)オブジェクトを作成し、
'environment' という名前の（辞書型）フィールドに <code class="docutils literal notranslate"><span class="pre">{k1='value1',</span> <span class="pre">k2='value2'}</span></code>
という初期データを与えています。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[./.add: &#39;ENV&#39;, /system/types/Environment, {
    environment={k1=&#39;value1&#39;, k2=&#39;value2&#39;}
}]
</pre></div>
</div>
<p>ここでは <code class="docutils literal notranslate"><span class="pre">./</span></code> という相対パス識別が、このジョブフローがあるディレクトリを示す
Kompira オブジェクトを参照しています。オブジェクトの参照を変数で受け渡すことも
できますので、以下のように書くこともできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[dir = ./, type=/system/types/Environment] -&gt;
[dir.add: &#39;ENV&#39;, type, {environment={k1=&#39;value1&#39;, k2=&#39;value2&#39;}}]
</pre></div>
</div>
<p>またパラメータ列ではパラメータ名を指定して値を渡すこともできます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[dir = ./, type=/system/types/Environment] -&gt;
[dir.add: &#39;ENV&#39;, type_obj=type, data={environment={k1=&#39;value1&#39;, k2=&#39;value2&#39;}}]
</pre></div>
</div>
</section>
</section>
<section id="id31">
<h2><span class="section-number">3.7. </span>イベントを待ち合わせる<a class="headerlink" href="#id31" title="この見出しへのパーマリンク">¶</a></h2>
<p>チャネルを用いて、ジョブの同期やイベントの待ち合わせ処理を
ジョブフローで記述することができます。</p>
<section id="id32">
<h3><span class="section-number">3.7.1. </span>メッセージの送受信<a class="headerlink" href="#id32" title="この見出しへのパーマリンク">¶</a></h3>
<p>作成したチャネルに対して、メッセージを送信するには <code class="docutils literal notranslate"><span class="pre">send</span></code> メソッドを用います。
「/home/guest/テストチャネル」に新しいチャネルを作成して試してみましょう。</p>
<p>チャネルに対してメッセージを送信するジョブフローは、以下のようになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[/home/guest/テストチャネル.send: &#39;こんにちは&#39;]
-&gt; print(&#39;メッセージを送信しました&#39;)
</pre></div>
</div>
<p>次に、チャネルからメッセージを受信するジョブフローを以下のように定義します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;/home/guest/テストチャネル&gt;
-&gt; [mesg = $RESULT]
-&gt; print(&#39;メッセージ「$mesg」を受信しました。&#39;)
</pre></div>
</div>
<p>上記の各ジョブフローを実行してみてください。受信側のジョブフロー実行の
プロセスコンソールに以下のようにメッセージが出力されれば成功です。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>メッセージ「こんにちは」を受信しました。
</pre></div>
</div>
<p>送信側ジョブフローを複数回実行すると、チャネルにその分だけメッセージが
溜まります。受信側のジョブフローを1回実行するたびに、そのチャネルから1
つ分のメッセージを取り出して出力します。もし、チャネルのメッセージが空
の場合、受信側のジョブフローは新しいメッセージが到着するまで待ちます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><code class="docutils literal notranslate"><span class="pre">kompira_sendevt</span></code> コマンドを用いることで、外部のシステムから
任意の情報をチャネルに送信することができます。
たとえば監視システムからアラート情報をチャネルに送信することで、
障害発生時の手順をジョブフローで処理させることなども可能でしょう。
<code class="docutils literal notranslate"><span class="pre">kompira_sendevt</span></code> コマンドの利用方法については <a class="reference internal" href="coordination.html"><span class="doc">他システムとの連携</span></a>
を参照してください。</p>
</div>
</section>
<section id="id33">
<h3><span class="section-number">3.7.2. </span>イベントジョブについて<a class="headerlink" href="#id33" title="この見出しへのパーマリンク">¶</a></h3>
<p>&lt;と&gt;で囲まれたジョブをイベントジョブと呼びます。イベントジョブは、他の
ジョブと同じようにジョブフローの中で組み合わせて使用することができます。</p>
<p>イベントジョブの形式は以下のとおりです。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt; &lt;オブジェクト名&gt; : &lt;パラメータ列&gt; ... &gt;
</pre></div>
</div>
<p>オブジェクト名にはチャネル型（およびそれに類する型：メールチャネル型など）
のオブジェクトを指定します。それ以外のイベント待ち合わせ不可能なオブジェクト
を指定すると実行時エラーとなります。</p>
</section>
<section id="id34">
<h3><span class="section-number">3.7.3. </span>メッセージ受信のタイムアウト指定<a class="headerlink" href="#id34" title="この見出しへのパーマリンク">¶</a></h3>
<p>チャネルからのメッセージの到着を待ち、一定時間内に来なかったらタイムアウトして
処理を先に進めるにはイベントジョブにパラメータ <code class="docutils literal notranslate"><span class="pre">timeout</span></code> を指定します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&#39;チャネルからメッセージを待ちます&#39;)
-&gt; &lt;./テスト用チャネル: timeout=10&gt;
=&gt; { if $STATUS==0 |
    then: [mesg=$RESULT]
          -&gt; print(&#39;メッセージ「$mesg」を受信しました&#39;)
    else: print(&#39;タイムアウトしました&#39;) }
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">timeout</span></code> で指定した秒数の間にメッセージが到着しなかった場合、イベントジョブは
失敗しますので <code class="docutils literal notranslate"><span class="pre">=&gt;</span></code> で次のジョブと結合していることに注意してください。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>メッセージからの到着を待っている時に、チャネルが削除されると、イベントジョブは失敗して $STATUS に -1 をセットします。
また、メールチャネルでは、イベントジョブに detect_error=true パラメータが渡されると、
メールのフェッチに失敗したり、無効化フラグが設定されている場合にも、$STATUS に -1 をセットします。</p>
</div>
</section>
<section id="id35">
<h3><span class="section-number">3.7.4. </span>複数チャネルからの選択的受信<a class="headerlink" href="#id35" title="この見出しへのパーマリンク">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">choice</span></code> ブロックを使うことで、複数のチャネルからのメッセージの到着を待つ
ことも可能です。この場合、先にメッセージ到着したチャネルについての処理
が続行されます。</p>
<p>choiceブロックの使用例</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>print(&#39;チャネル1とチャネル2からメッセージの受信を待ちます&#39;)
-&gt; { choice |
    &lt;./チャネル1&gt; -&gt; [mesg=$RESULT]
        -&gt; print(&#39;チャネル1からメッセージ「$mesg」を受信しました&#39;)
    &lt;./チャネル2&gt; -&gt; [mesg=$RESULT]
        -&gt; print(&#39;チャネル2からメッセージ「$mesg」を受信しました&#39;)
}
-&gt; print(&#39;OK&#39;)
</pre></div>
</div>
</section>
</section>
<section id="id36">
<h2><span class="section-number">3.8. </span>外部にアクセスする<a class="headerlink" href="#id36" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id37">
<h3><span class="section-number">3.8.1. </span>メールを送信する<a class="headerlink" href="#id37" title="この見出しへのパーマリンク">¶</a></h3>
<p>メールの送信には、組み込み <code class="docutils literal notranslate"><span class="pre">mailto</span></code> ジョブを用います。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[subject = &#39;テストメール&#39;,
 body = &#39;テストメールを送信します。\n受け取ったら破棄してください&#39;]
-&gt; mailto(to=&#39;taro@example.com&#39;, from=&#39;hanako@example.com&#39;,
          subject=subject, body=body)
-&gt; print(&#39;メールを送信しました&#39;)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mailto</span></code> ジョブの引数には、 <code class="docutils literal notranslate"><span class="pre">to</span></code> (あて先メールアドレス)、 <code class="docutils literal notranslate"><span class="pre">from</span></code>
(送信元メールアドレス)、 <code class="docutils literal notranslate"><span class="pre">subject</span></code> (メール表題)、 <code class="docutils literal notranslate"><span class="pre">body</span></code> (メール本文)を指定します。</p>
<p>複数のアドレスにメールを送信する場合、以下のように <code class="docutils literal notranslate"><span class="pre">to</span></code> 引数にメールアドレ
ス文字列のリストを渡して下さい。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mailto(to=[&#39;taro@example.com&#39;, &#39;jiro@example.com&#39;], from=&#39;hanako@example.com&#39;,
       subject=subject, body=body)
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>Kompira はメール送信のときに、指定されたSMTPサーバに接続してメールを送信します。
メールがうまく送信できない場合、指定したSMTPサーバ型オブジェクトの設定が正しいかどうか、および、SMTPサーバ側での設定やログを確認してください。</p>
</div>
</section>
<section id="http">
<h3><span class="section-number">3.8.2. </span>HTTP アクセスする<a class="headerlink" href="#http" title="この見出しへのパーマリンク">¶</a></h3>
<p>Web サーバなどに HTTP アクセスするには、組み込み <code class="docutils literal notranslate"><span class="pre">urlopen</span></code> ジョブを用います。
単純に <code class="docutils literal notranslate"><span class="pre">urlopen()</span></code> に URL だけを渡した場合は GET アクセスになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|url = &#39;http://www.kompira.jp&#39;|
urlopen(url)
=&gt; [status = $STATUS, result = $RESULT]
-&gt; { if status != 0 |
then:
    print(&#39;HTTP access failed.&#39;)
elif result.code != 200:
    print(&#39;HTTP status code is %code.&#39; % result)
else:
    print(result.body)
}
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">urlopen()</span></code> でアクセスに成功した場合の結果は辞書で返されます。
<code class="docutils literal notranslate"><span class="pre">code</span></code> には HTTP のステータスコードが、<code class="docutils literal notranslate"><span class="pre">body</span></code> にはレスポンスの内容が格納されています。</p>
<p>なお、バージョン 1.5.0 時点での Kompira は HTML を解析する機能は持っていないので、
以下のような簡単なスクリプトジョブを <code class="docutils literal notranslate"><span class="pre">html_parse</span></code> という名前で作成しておきます。
このスクリプトは標準入力に渡した HTML から、パラメータで指定した箇所をテキストで抜き出します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#! /usr/bin/python
import sys;
from lxml import html;
if __name__ == &#39;__main__&#39;:
    doc = html.fromstring(sys.stdin.read().decode(&quot;utf-8&quot;))
    for e in doc.xpath(sys.argv[1]):
        print html.tostring(e, method=&quot;text&quot;, encoding=&quot;utf-8&quot;)
</pre></div>
</div>
<p>さて、<code class="docutils literal notranslate"><span class="pre">urlopen()</span></code> はパラメータ <code class="docutils literal notranslate"><span class="pre">data</span></code> に辞書データを渡すことで POST アクセスさせることもできます。
例として、ネットワークインターフェースに付与された MAC アドレスの前半部分(OUI)から製品ベンダーを調べる、
というジョブフローを考えます。OUI は IEEE という組織が管理しており、
<a class="reference external" href="http://standards.ieee.org/develop/regauth/oui/public.html">http://standards.ieee.org/develop/regauth/oui/public.html</a> から検索することができます。
このページにはフォームがあり、<code class="docutils literal notranslate"><span class="pre">x</span></code> という名前の入力欄に OUI を入力するようになっています。
また、検索すると <code class="docutils literal notranslate"><span class="pre">/cgi-bin/ouisearch</span></code> という CGI が実行されるようになっているので、
OUI を <code class="docutils literal notranslate"><span class="pre">x</span></code> という名前でデータとしてその CGI に渡す POST アクセスをすればよいことになります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|oui = &#39;00-00-00&#39;|
urlopen(&#39;http://standards.ieee.org/cgi-bin/ouisearch&#39;, data={x=oui})
-&gt; [./html_parse &lt;&lt; $RESULT.body: &#39;//pre&#39;]
-&gt; print($RESULT)
</pre></div>
</div>
<p>検索結果のページでは <code class="docutils literal notranslate"><span class="pre">&lt;pre&gt;</span></code> タグに結果がありますので、
そこを抜き出すために <code class="docutils literal notranslate"><span class="pre">//pre</span></code> というパラメータを <code class="docutils literal notranslate"><span class="pre">html_parse</span></code> スクリプトに渡しています。
このパラメータは XPath という XML 文書の部分指定をするための構文で指定します。</p>
<p>このジョブフローを実行すると、以下のようにベンダー情報を外部の Web ページから取得できていることが分かります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[localhost] local: (/tmp/tmpxaL7DG //pre) &lt; /tmp/tmpktOTMU

  OUI/MA-L                      Organization
  company_id                    Organization
                                    Address


  00-00-00   (hex)              XEROX CORPORATION
  000000     (base 16)          XEROX CORPORATION
                                M/S 105-50C
                                800 PHILLIPS ROAD
                                WEBSTER NY 14580
                                UNITED STATES
</pre></div>
</div>
</section>
</section>
<section id="id38">
<h2><span class="section-number">3.9. </span>プロセスを制御する<a class="headerlink" href="#id38" title="この見出しへのパーマリンク">¶</a></h2>
<p>ジョブフローを実行すると、その終了の時まで Kompira 上ではプロセスという
実行単位で管理され、プロセスはジョブフローに記述されたジョブを連続的に
順次実行することになります。
ここではプロセスを制御する方法について説明します。</p>
<section id="id39">
<h3><span class="section-number">3.9.1. </span>プロセスの終了<a class="headerlink" href="#id39" title="この見出しへのパーマリンク">¶</a></h3>
<p>ジョブフローの終端に到達するなどして継続すべきジョブが無くなった場合や、
実行したコマンドが失敗した状態で <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> を使ってジョブを結合した場合などは、
プロセスは自動的に終了します。</p>
<p>そうした場合以外で、実行中のプロセスを明示的に終了させたいには <code class="docutils literal notranslate"><span class="pre">exit</span></code> ジョブ
あるいは <code class="docutils literal notranslate"><span class="pre">abort</span></code> ジョブを用います。</p>
<section id="exit">
<h4><span class="section-number">3.9.1.1. </span>exit<a class="headerlink" href="#exit" title="この見出しへのパーマリンク">¶</a></h4>
<p>実行中のプロセスを終了させるには、組み込み <code class="docutils literal notranslate"><span class="pre">exit</span></code> ジョブを用います。
引数を指定せず <code class="docutils literal notranslate"><span class="pre">exit()</span></code> と呼出すと、プロセスをただちに正常終了します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>exit()
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">exit</span></code> ジョブの引数で終了ステータスコードを指定することもできます。
以下の例では、パラメータ <code class="docutils literal notranslate"><span class="pre">command</span></code> で指定されたコマンドを実行したのち、
結果（成功・失敗）にかかわらず標準エラー出力と標準出力を表示してから、
コマンド実行結果をステータスコードとしてプロセスを終了します。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|command|
[command]
=&gt; [status=$STATUS, stderr=$ERROR, stdout=$RESULT]
-&gt; { if stderr | print(stderr) }
-&gt; { if stdout | print(stdout) }
-&gt; exit(status)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">exit</span></code> と <code class="docutils literal notranslate"><span class="pre">return</span></code> の違いに注意してください。
例えば、メインジョブから呼び出されたサブジョブで <code class="docutils literal notranslate"><span class="pre">exit</span></code> ジョブを呼び出すと
実行中のプロセスを終了させます（メインジョブに制御が戻らず即座に終了します）。
一方、サブジョブで <code class="docutils literal notranslate"><span class="pre">return</span></code> ジョブを呼び出すと、プロセスを終了させるのでは
なく、メインジョブに制御が戻り、サブジョブを呼び出した実行ジョブの直後から
処理が継続されます。</p>
<p>ただし、呼び出し元が存在しない場合、たとえば直接「実行ボタン」を押して実行
したジョブフローから <code class="docutils literal notranslate"><span class="pre">return</span></code> ジョブを呼び出した場合は、その時点で継続する
ジョブが無くなりますのでプロセスが終了します。</p>
</section>
<section id="abort">
<h4><span class="section-number">3.9.1.2. </span>abort<a class="headerlink" href="#abort" title="この見出しへのパーマリンク">¶</a></h4>
<p>ジョブを継続できない状態になった場合などに、組み込み <code class="docutils literal notranslate"><span class="pre">abort</span></code> ジョブを呼出すことで、
実行中のプロセスを異常終了させることができます。
以下の例ではパラメータで指定した URL に <code class="docutils literal notranslate"><span class="pre">urlopen</span></code> でアクセスした時に、
HTTP アクセスに失敗したか、HTTP ステータスコードが 200 以外の場合にプロセスを異常終了させます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|url|
urlopen(url)
=&gt; [result = $RESULT, status = $STATUS]
-&gt; { if status != 0 | abort(&#39;HTTP access failed.&#39;) }
-&gt; { if result.code != 200 | abort(&#39;HTTP status code is %code.&#39; % result) }
-&gt; return(result.body)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">abort()</span></code> ジョブは自動的に終了ステータスコードを 1 にセットしてプロセスを終了
させるため、 <code class="docutils literal notranslate"><span class="pre">exit(status=1)</span></code> とほぼ同じです。</p>
</section>
</section>
<section id="id40">
<h3><span class="section-number">3.9.2. </span>子プロセスの起動<a class="headerlink" href="#id40" title="この見出しへのパーマリンク">¶</a></h3>
<p>Kompira が持つ複数プロセスの並行動作という特徴は、
ジョブフローでは「子プロセス」を起動するという方法で利用することができます。</p>
<p>子プロセスは起動した時点では親プロセス（子プロセスを起動したプロセスのこと）のコピーであり、
ローカル変数や特殊変数は同じ値を持っていますが、プロセス間での共有や参照はできないので、
子プロセスから親プロセスの変数を書き換えたりすることは出来ないことに注意してください（逆方向も同じ）。</p>
<section id="fork">
<h4><span class="section-number">3.9.2.1. </span>fork<a class="headerlink" href="#fork" title="この見出しへのパーマリンク">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">fork</span></code> ブロックを用いて、複数の子プロセスを一度に起動することが可能です。
以下では「処理Ａ」というサブジョブの実行結果を、「処理Ｂ」と「処理Ｃ」という
サブジョブでそれぞれ並行して処理させるジョブフローの例になります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[./処理Ａ] -&gt; [result = $RESULT] -&gt;
{ fork |
    [./処理Ｂ: result] -&gt; print(&#39;処理Ｂ終了&#39;)
    [./処理Ｃ: result] -&gt; print(&#39;処理Ｃ終了&#39;)
} -&gt; print(&#39;すべての子プロセスが終了しました&#39;)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fork</span></code> ブロックの中でジョブ間を結合子で接続していない箇所がありますが、
これが「ジョブフロー式」の区切りであり、上の例では <code class="docutils literal notranslate"><span class="pre">fork</span></code> ブロックに2つのジョブフロー式があることになります。
この2つのジョブフロー式の部分がそれぞれ子プロセスとして並行に動作し、それらの実行が全て完了すると、
親プロセスのジョブが継続して「すべての子プロセスが終了しました」とコンソールに出力されます。</p>
<p>なおジョブフローで子プロセスを起動したとき、そのプロセスのプロセス詳細画面の
「子プロセス一覧」タブには起動した子プロセスが表示されます。
逆に、子プロセスは「プロセス一覧」画面には表示されないことに注意してください。</p>
</section>
<section id="pfor">
<h4><span class="section-number">3.9.2.2. </span>pfor<a class="headerlink" href="#pfor" title="この見出しへのパーマリンク">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">for</span></code> ブロックの代わりに <code class="docutils literal notranslate"><span class="pre">pfor</span></code> ブロックを使うことで、
繰り返し処理が並列プロセスとして一度に実行することができます。</p>
<p>例えば管理対象のノードを「ノード一覧」で管理しており、
管理対象すべてのノードに対して同じジョブ「構成情報収集」を実行したい場合、
<code class="docutils literal notranslate"><span class="pre">for</span></code> ブロックを用いて以下のように書けます（構成情報収集はパラメータで
処理対象のノードを指定するものとします）。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|job = ./構成情報収集|
{ for node in ./ノード一覧 |
    [job: node]
} -&gt; print(&quot;すべてのノードに対する処理が終了しました&quot;)
</pre></div>
</div>
<p>もしこの「構成情報収集」ジョブがリモートノードに対して処理時間のかかるコマンドを
投入しているような場合、このプロセスは「待ち状態」になっている割合が多くなります。
結果的に、負荷は低いがすべてのノードに対する処理が終了するまでに長い時間がかかる、
ということになります。</p>
<p>こうしたときに <code class="docutils literal notranslate"><span class="pre">for</span></code> の代わりに <code class="docutils literal notranslate"><span class="pre">pfor</span></code> を使うと、各ノードごとに子プロセス
を起動してその子プロセスで「構成情報収集」ジョブを実行することになります。
そうすると、あるノードに対する処理で「待ち状態」になっていても、別のノードの処理
を並列に実行できるため、全体でのジョブの実行効率を上げて処理時間を短縮できるよう
になります。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|job = ./構成情報収集|
{ pfor node in ./ノード一覧 |
    [job: node]
} -&gt; print(&quot;すべてのノードに対する処理が終了しました&quot;)
</pre></div>
</div>
</section>
</section>
<section id="id41">
<h3><span class="section-number">3.9.3. </span>親プロセスからの切り離し<a class="headerlink" href="#id41" title="この見出しへのパーマリンク">¶</a></h3>
<p>子プロセスを <code class="docutils literal notranslate"><span class="pre">fork</span></code> や <code class="docutils literal notranslate"><span class="pre">pfor</span></code> を使って起動した親プロセスはすべての子プロセスの終了を待つため、
その間親プロセスは新たなジョブを動作させることはできません。
しかし、子プロセスの終了を待たずに親プロセス側の処理を継続させたい、という場合もあります。
そういう場合には <code class="docutils literal notranslate"><span class="pre">detach()</span></code> を用いて親プロセスから切り離すことで対応できます。</p>
<section id="detach">
<h4><span class="section-number">3.9.3.1. </span>detach<a class="headerlink" href="#detach" title="この見出しへのパーマリンク">¶</a></h4>
<p>例えばチャネルからメッセージを受信するたびに同じジョブフローを実行したい、
ということがしばしばあります。以下ではメッセージを受信するたびに「メッセージ処理」
というジョブフローに、メッセージをパラメータとして渡して呼び出しています。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|chan = /system/channels/Alert|
|proc = ./メッセージ処理|
{ while true |
    &lt;chan&gt;
    -&gt; [msg = $RESULT]
    -&gt; [proc: msg]
}
</pre></div>
</div>
<p>チャネルから受信する複数のメッセージ間に関連性が無いときは、
メッセージ処理を同時に実行させるようにすることで、
メッセージが連続して到着したときに全体での処理効率の向上につながることがあります。
そのためには、メッセージを受信するジョブフローと「メッセージ処理」を
別のプロセスとして動作させる必要があります。
そこで <code class="docutils literal notranslate"><span class="pre">fork</span></code> を用いて「メッセージ処理」を子プロセスで動作させるようにしてみます。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|chan = /system/channels/Alert|
|proc = ./メッセージ処理|
{ while true |
    &lt;chan&gt;
    -&gt; [msg = $RESULT]
    -&gt; { fork | [proc: msg] }
}
</pre></div>
</div>
<p>しかし、これでは「メッセージ処理」のジョブが完了するまで親プロセスは待ってしまうため、
メッセージ処理の最中に新しいメッセージが到着しても、同時に処理することはできません。
そこで子プロセス側で <code class="docutils literal notranslate"><span class="pre">detach()</span></code> 組み込みジョブを用いて、
子プロセスを親プロセスから切り離すようにします。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>|chan = /system/channels/Alert|
|proc = ./メッセージ処理|
{ while true |
    &lt;chan&gt;
    -&gt; [msg = $RESULT]
    -&gt; { fork | detach() -&gt; [proc: msg] }
}
</pre></div>
</div>
<p>親プロセス側は子プロセスの <code class="docutils literal notranslate"><span class="pre">detach()</span></code> により、処理完了を待つべき子プロセスがなくなるため、
その時点で次のジョブを継続できることになります。
すなわちチャネルから次のメッセージを受信を行ない、先に起動した「メッセージ処理」
がまだ完了していなくても新しい「メッセージ処理」を起動できることになります。</p>
<p>子プロセス側は <code class="docutils literal notranslate"><span class="pre">detach()</span></code> により子プロセスではなく通常のプロセスとなり、
親プロセスの「子プロセス一覧」ではなく「プロセス一覧」画面に表示されるようになります。</p>
<p>このように <code class="docutils literal notranslate"><span class="pre">fork</span></code> や <code class="docutils literal notranslate"><span class="pre">pfor</span></code> と <code class="docutils literal notranslate"><span class="pre">detach()</span></code> を組合せることで、
多少複雑な並行処理でも簡単に記述することができます。</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">3. Kompiraチュートリアル</a><ul>
<li><a class="reference internal" href="#id1">3.1. はじめに</a></li>
<li><a class="reference internal" href="#id2">3.2. ジョブフローを動かす</a><ul>
<li><a class="reference internal" href="#hello-world">3.2.1. Hello World</a></li>
<li><a class="reference internal" href="#id3">3.2.2. コメントの書き方</a></li>
<li><a class="reference internal" href="#id4">3.2.3. コマンドを実行する</a></li>
<li><a class="reference internal" href="#result">3.2.4. $RESULT</a></li>
<li><a class="reference internal" href="#id5">3.2.5. ジョブの連結</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">3.3. 変数を使う</a><ul>
<li><a class="reference internal" href="#id7">3.3.1. 変数の定義</a></li>
<li><a class="reference internal" href="#id8">3.3.2. 識別子</a></li>
<li><a class="reference internal" href="#id9">3.3.3. スコープ</a></li>
<li><a class="reference internal" href="#id10">3.3.4. 変数の代入</a></li>
<li><a class="reference internal" href="#id11">3.3.5. 配列と辞書</a><ul>
<li><a class="reference internal" href="#id12">3.3.5.1. 配列</a></li>
<li><a class="reference internal" href="#id13">3.3.5.2. 辞書</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14">3.3.6. テンプレート文字列</a></li>
<li><a class="reference internal" href="#id15">3.3.7. パラメータ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id16">3.4. リモートでコマンド実行する</a><ul>
<li><a class="reference internal" href="#id17">3.4.1. 制御変数による指定</a></li>
<li><a class="reference internal" href="#id18">3.4.2. ノード情報とアカウント情報の指定</a></li>
<li><a class="reference internal" href="#sudo">3.4.3. sudoによる実行</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id19">3.5. 制御構造でジョブを操る</a><ul>
<li><a class="reference internal" href="#id20">3.5.1. 条件分岐</a><ul>
<li><a class="reference internal" href="#if">3.5.1.1. if ブロック</a></li>
<li><a class="reference internal" href="#case">3.5.1.2. case ブロック</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id21">3.5.2. 繰り返し</a><ul>
<li><a class="reference internal" href="#for">3.5.2.1. for ブロック</a></li>
<li><a class="reference internal" href="#while">3.5.2.2. while ブロック</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22">3.5.3. ジョブの呼び出し</a><ul>
<li><a class="reference internal" href="#id23">3.5.3.1. ジョブフローの呼び出し</a></li>
<li><a class="reference internal" href="#id24">3.5.3.2. ジョブフローへのパラメータ渡し</a></li>
<li><a class="reference internal" href="#id25">3.5.3.3. スクリプトジョブの実行</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id26">3.6. オブジェクトを操作する</a><ul>
<li><a class="reference internal" href="#id27">3.6.1. オブジェクトの参照</a></li>
<li><a class="reference internal" href="#id28">3.6.2. プロパティの参照と更新</a></li>
<li><a class="reference internal" href="#id29">3.6.3. フィールドの参照と更新</a></li>
<li><a class="reference internal" href="#id30">3.6.4. メソッドの呼び出し</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id31">3.7. イベントを待ち合わせる</a><ul>
<li><a class="reference internal" href="#id32">3.7.1. メッセージの送受信</a></li>
<li><a class="reference internal" href="#id33">3.7.2. イベントジョブについて</a></li>
<li><a class="reference internal" href="#id34">3.7.3. メッセージ受信のタイムアウト指定</a></li>
<li><a class="reference internal" href="#id35">3.7.4. 複数チャネルからの選択的受信</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id36">3.8. 外部にアクセスする</a><ul>
<li><a class="reference internal" href="#id37">3.8.1. メールを送信する</a></li>
<li><a class="reference internal" href="#http">3.8.2. HTTP アクセスする</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id38">3.9. プロセスを制御する</a><ul>
<li><a class="reference internal" href="#id39">3.9.1. プロセスの終了</a><ul>
<li><a class="reference internal" href="#exit">3.9.1.1. exit</a></li>
<li><a class="reference internal" href="#abort">3.9.1.2. abort</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id40">3.9.2. 子プロセスの起動</a><ul>
<li><a class="reference internal" href="#fork">3.9.2.1. fork</a></li>
<li><a class="reference internal" href="#pfor">3.9.2.2. pfor</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id41">3.9.3. 親プロセスからの切り離し</a><ul>
<li><a class="reference internal" href="#detach">3.9.3.1. detach</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="usage.html"
                          title="前の章へ"><span class="section-number">2. </span>操作ガイド</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="reference.html"
                          title="次の章へ"><span class="section-number">4. </span>Kompira ジョブフロー言語リファレンス</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="reference.html" title="4. Kompira ジョブフロー言語リファレンス"
             >次へ</a> |</li>
        <li class="right" >
          <a href="usage.html" title="2. 操作ガイド"
             >前へ</a> |</li>
<li class="nav-item nav-item-0"><a href="index.html">Kompira 1.6.11 ドキュメント</a> [<a href="../en/tutorial.html">en</a>|<a href="./kompira.pdf" target="_blank">pdf</a>] &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">3. </span>Kompiraチュートリアル</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, Kompira development team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>