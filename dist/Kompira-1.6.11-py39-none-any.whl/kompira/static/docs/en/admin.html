
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>1. Administration Guide &#8212; Kompira 1.6.11 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="2. Operation Guide" href="usage.html" />
    <link rel="prev" title="Kompira 1.6.11 documentation" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="usage.html" title="2. Operation Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Kompira 1.6.11 documentation"
             accesskey="P">previous</a> |</li>
<li class="nav-item nav-item-0"><a href="index.html">Kompira 1.6.11 documentation</a> [<a href="../ja/admin.html">ja</a>|<a href="./kompira.pdf" target="_blank">pdf</a>] &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>Administration Guide</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="id1">
<h1><span class="section-number">1. </span>Administration Guide<a class="headerlink" href="#id1" title="Permalink to this heading">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Kompira development team</p>
</dd>
</dl>
<section id="admin-introduction">
<span id="id2"></span><h2><span class="section-number">1.1. </span>Introduction<a class="headerlink" href="#admin-introduction" title="Permalink to this heading">¶</a></h2>
<p>This manual contains useful information to help the user know how best to manage Kompira.</p>
<p>Please refer to this manual to learn about installation, updates, overall Kompira settings and logs etc.</p>
<p>In this manual, we use  <code class="docutils literal notranslate"><span class="pre">$</span></code> for general user and <code class="docutils literal notranslate"><span class="pre">#</span></code> for root user on Linux command prompt.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo &#39;command execution by general user&#39;
# echo &#39;command execution by root privileged user&#39;
</pre></div>
</div>
</section>
<section id="kompira">
<span id="package"></span><h2><span class="section-number">1.2. </span>Kompira package management<a class="headerlink" href="#kompira" title="Permalink to this heading">¶</a></h2>
<p>This manual will explain the installation and updates of Kompira related packages.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>In this section, only the circumstances where the Kompira package is operated on a single server are explained. Please refer to  <a class="reference internal" href="#ha"><span class="std std-ref">High Availability (HA) Management</span></a>  for details on how to run Kompira in a redundant configuration.</p>
</div>
<section id="package-kind">
<span id="id3"></span><h3><span class="section-number">1.2.1. </span>Type of installation package<a class="headerlink" href="#package-kind" title="Permalink to this heading">¶</a></h3>
<p>Kompira has the following types of packages.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Package name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Kompira Package</p></td>
<td><p>Packages containing Kompira itself. Including: Kompira core function group, job manager and event transmission script.</p></td>
</tr>
<tr class="row-odd"><td><p>Job manager package</p></td>
<td><p>Packages that includes a job manager and an event transmission script.</p></td>
</tr>
<tr class="row-even"><td><p>Send-Event package</p></td>
<td><p>Packages including Send-Event scripts</p></td>
</tr>
</tbody>
</table>
<p>If you are using Kompira for the first time, please first install the Kompira package.</p>
<p>Use the job manager package when you want to start the job manager process, in addition to the server on which the Kompira package is installed.</p>
<p>The send-event package is used when you want to send an event to Kompira from another server. For integration between systems using event sending, please refer to <a class="reference internal" href="coordination.html"><span class="doc">Coordination with other systems</span></a> .</p>
</section>
<section id="package-install-sh">
<span id="id4"></span><h3><span class="section-number">1.2.2. </span>Install Script<a class="headerlink" href="#package-install-sh" title="Permalink to this heading">¶</a></h3>
<p>By using install.sh, you can install Kompira’s various packages.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>install.sh [options]
</pre></div>
</div>
<p>The installation process includes installation of middleware to be used by Kompira, construction of databases and automatic startup of processes.</p>
<p>install.sh creates a log file named <em>install.&lt;process number&gt;.log</em> regardless of the success or failure of the command.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Before installing on Red Hat, you need to subscribe in advance.</p>
</div>
<section id="id5">
<h4><span class="section-number">1.2.2.1. </span>Limitation<a class="headerlink" href="#id5" title="Permalink to this heading">¶</a></h4>
<p>install.sh is supported only for RHEL / CentOS installation.</p>
<p>Install.sh downloads various middleware used by Kompira. Please run it when you are able to connect to the Internet.</p>
<p>When connecting to the Internet via a proxy, run install.sh with the <code class="docutils literal notranslate"><span class="pre">--proxy</span></code> option as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ./install.sh --proxy proxy:3128
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please set “proxy” and “3128” as the proxy server’s host name (or IP address) and port number.</p>
</div>
<p>For a proxy server with authentication, run install.sh with “user” as the user name and “password” as the password as shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ./install.sh --proxy user:password@proxy:3128
</pre></div>
</div>
</section>
<section id="id6">
<h4><span class="section-number">1.2.2.2. </span>Command Line Options<a class="headerlink" href="#id6" title="Permalink to this heading">¶</a></h4>
<p>The options that can be specified for install.sh are as follows.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--https</span></code></p></td>
<td><p>Restricts access to only HTTPS to the Kompira server (default from Kompira v1.5.0). When accessed with HTTP, it will automatically be redirected to HTTPS.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--no-https</span></code></p></td>
<td><p>Allows HTTP access to the Kompira server.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--amqps</span></code></p></td>
<td><p>Protect AMQP access to the Kompira server with SSL (default since Kompira v1.6.8).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--amqps-verify</span></code></p></td>
<td><p>Protect AMQP access to the Kompira server with SSL (with SSL certificate verification).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--no-ampqs</span></code></p></td>
<td><p>AMQP access to the Kompira server is not protected by SSL.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--allow-insecure-amqp</span></code></p></td>
<td><p>Allows external non-SSL AMQP access to the Kompira server.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--backup</span></code></p></td>
<td><p>Backup and restore databases.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--no-backup</span></code></p></td>
<td><p>Skips the database backup and restore processes.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--backup-process</span></code></p></td>
<td><p>Include process objects when retrieving database backups.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--no-backup-process</span></code></p></td>
<td><p>Exclude process objects when retrieving database backups.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--rhui</span></code></p></td>
<td><p>Install in RHUI mode.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--rhel-option-repo</span> <span class="pre">&lt;repo&gt;</span></code></p></td>
<td><p>Specify RHEL repository.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--skip-python3-install</span></code></p></td>
<td><p>Skip python3 installation.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--skip-cluster-start</span></code></p></td>
<td><p>Skip pcs cluster start for update installations in redundant configurations.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--skip-rabbitmq-update</span></code></p></td>
<td><p>Skip updating rabbitmq-server.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--skip-postgresql-update</span></code></p></td>
<td><p>Skip updating postgresql.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--rabbitmq-version</span> <span class="pre">&lt;ver&gt;</span></code></p></td>
<td><p>Specifies the rabbitmq-server version to install. (e.g. 3.10.*)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--postgresql-version</span> <span class="pre">&lt;ver&gt;</span></code></p></td>
<td><p>Specifies the postgresql version to install. (16, 16.4, 16.*, etc.)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--initdata</span></code></p></td>
<td><p>Explicitly initialize the database.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--initfile</span></code></p></td>
<td><p>Explicitly initialize the storage destination of the attached file.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--secret-key</span> <span class="pre">&lt;secret-key&gt;</span></code></p></td>
<td><p>The encryption key string for the password field. (The key must be at least 8 characters long.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--force</span></code></p></td>
<td><p>Even if the major version of Kompira is different, it will force the installation. Also, it will delete the database without confirmation when there is an existing database, initialize the database and attempt installation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--proxy</span> <span class="pre">&lt;proxy&gt;</span></code></p></td>
<td><p>Specify the URL of the proxy server and install. The proxy server specified here is set as the environment variable of the Kompira service, and it is also applied when accessing external HTTP from the job flow.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--temp-proxy</span> <span class="pre">&lt;proxy&gt;</span></code></p></td>
<td><p>Specify the URL of the proxy server to be applied only during installation and install.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--noproxy</span> <span class="pre">&lt;hosts&gt;</span></code></p></td>
<td><p>Specify a comma-separated list of hosts to be excluded from the proxy server.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--temp-noproxy</span> <span class="pre">&lt;hosts&gt;</span></code></p></td>
<td><p>Specify the proxy exclusion setting for installation only.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--locale-lang</span> <span class="pre">&lt;LANG&gt;</span></code></p></td>
<td><p>Specify the locale and install.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--locale-timezone</span> <span class="pre">&lt;ZONENAME&gt;</span></code></p></td>
<td><p>Specify the time zone and install.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--jobmngr</span> <span class="pre">&lt;kompira_ip&gt;</span></code></p></td>
<td><p>Install and update the Job Manager package. It is necessary to specify the host name or IP address of the server on which the Kompira package is installed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--sendevt</span> <span class="pre">&lt;kompira_ip&gt;</span></code></p></td>
<td><p>This will install and update the send-event package. It is necessary to specify the host name or IP address of the server on which the Kompira package is installed.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--with-rpm</span> <span class="pre">&lt;rpms&gt;</span></code></p></td>
<td><p>Install with additional rpm packages.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--with-whl</span> <span class="pre">&lt;wheels&gt;</span></code></p></td>
<td><p>Install with additional wheel packages.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--with-gdb</span></code></p></td>
<td><p>Install tools necessary for debugging Kompira.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--offline</span></code></p></td>
<td><p>Install in offline mode using the kompira-extra package.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--extra</span></code></p></td>
<td><p>Create the kompira-extra package for offline install.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--extra-without-ha</span></code></p></td>
<td><p>Create the kompira-extra package without the HA packages.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--install-only</span></code></p></td>
<td><p>Installation only, each daemon is not started.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--dry-run</span></code></p></td>
<td><p>Runs in dry run mode. Only parameter check, no actual setup is performed.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<p>The jobmngr and sendevt options are exclusive.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.2: </span>The –extra and –secret-key options have been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.4: </span>The –extra-without-ha option has been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.6: </span>The –skip-cluster-start option has been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The –install-only option has been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.8: </span>The –amqps, –amqps-verify, –no-ampqs and –allow-insecure-amqp options have been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.8.post2: </span>The –skip-rabbitmq-update and –rabbitmq-version options have been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.10: </span>The –backup, –no-backup-process, –skip-postgresql-update and –postgresql-version options have been added.</p>
</div>
</section>
</section>
<section id="package-kompira">
<span id="id7"></span><h3><span class="section-number">1.2.3. </span>Kompira Package<a class="headerlink" href="#package-kompira" title="Permalink to this heading">¶</a></h3>
<p>How to install and update the Kompira package itself.</p>
<section id="package-kompira-install">
<span id="id8"></span><h4><span class="section-number">1.2.3.1. </span>Installation<a class="headerlink" href="#package-kompira-install" title="Permalink to this heading">¶</a></h4>
<p>Extract the Kompira package and run install.sh. Replace &lt;version&gt; with the version number of Kompira.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh
[2020-09-17 02:00:24] ****: ****************************************************************
[2020-09-17 02:00:24] ****: Kompira-1.6.0:
[2020-09-17 02:00:24] ****: Start: Install the Kompira
[2020-09-17 02:00:24] ****:
[2020-09-17 02:00:24] INFO:     SYSTEM                   = CENT
[2020-09-17 02:00:24] INFO:     SYSTEM_NAME              = cent8
[2020-09-17 02:00:24] INFO:     SYSTEM_RELEASE           = CentOS Linux release 8.2.2004 (Core)
[2020-09-17 02:00:24] INFO:     SYSTEM_RELEASEVER        = 8.2.2004
[2020-09-17 02:00:24] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python
[2020-09-17 02:00:24] INFO:     PYTHON                   = /bin/python3.6

...

[2020-09-17 02:02:46] ****: ----------------------------------------------------------------
[2020-09-17 02:02:46] ****: Test access to kompira.
[2020-09-17 02:02:46] ****:
[2020-09-17 02:02:48] INFO: Access succeeded:   &lt;div class=&quot;brand-version&quot;&gt;1.6.0&lt;/div&gt;
[2020-09-17 02:02:48] ****:
[2020-09-17 02:02:48] ****: Finish: Install the Kompira (status=0)
[2020-09-17 02:02:48] ****: ****************************************************************
</pre></div>
</div>
<p>The installer will automatically install the Kompira package. If “Finish: Install the Kompira (status=0)” is displayed, the installation has been a success.</p>
<p>When installation is completed, please access the Kompira server from a Web browser with the following URL and confirm that the login screen is displayed.</p>
<p>At this time, a warning about the server certificate is displayed. To prevent this warning, please install the SSL certificate on Apache on the Kompira server.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>https://&lt;Hostname or ipaddress of Kompira server&gt;/
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To access by HTTP, you will need to install it with the <code class="docutils literal notranslate"><span class="pre">--no-https</span></code> option.</p>
</div>
<p>For details on how to operate Kompira with a Web browser, see the operation guide manual.</p>
</section>
<section id="package-kompira-update">
<span id="id9"></span><h4><span class="section-number">1.2.3.2. </span>Update<a class="headerlink" href="#package-kompira-update" title="Permalink to this heading">¶</a></h4>
<p>How to update the Kompira package when it is already installed:</p>
<p>Kompira’s version number format is specified as follows.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1.&lt;major-version&gt;.&lt;minor-version&gt;
</pre></div>
</div>
</div></blockquote>
<p>Updates where only minor version numbers are changed are called minor updates, and updates where major version numbers are changed are called major updates.</p>
<p>For example, updating from version 1.5.0 to 1.5.2 is a minor update, updating from version 1.4.10 to 1.5.0 is a major update.</p>
<p>Major updates are updates that may contain changes in architecture configuration and DB schema definition, so a different process may be required.</p>
<p>Please check the current version and the Kompira version that you are updating.</p>
<p><strong>Minor update</strong></p>
<blockquote>
<div><p>For minor updates, run install.sh without options.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh
[2020-09-17 22:56:32] ****: ****************************************************************
[2020-09-17 22:56:32] ****: Kompira-1.6.0:
[2020-09-17 22:56:32] ****: Start: Install the Kompira
[2020-09-17 22:56:32] ****:
[2020-09-17 22:56:32] INFO:     SYSTEM                   = CENT
[2020-09-17 22:56:32] INFO:     SYSTEM_NAME              = cent8
[2020-09-17 22:56:32] INFO:     SYSTEM_RELEASE           = CentOS Linux release 8.2.2004 (Core)
[2020-09-17 22:56:33] INFO:     SYSTEM_RELEASEVER        = 8.2.2004
[2020-09-17 22:56:33] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python
[2020-09-17 22:56:33] INFO:     PYTHON                   = /bin/python3.6

...

[2020-09-17 22:57:00] ****: ----------------------------------------------------------------
[2020-09-17 22:57:00] ****: Check version of Kompira installed.
[2020-09-17 22:57:00] ****:
[2020-09-17 22:57:00] INFO: VERSION=1.6.0b4 [pip=/opt/kompira/bin/pip]
[2020-09-17 22:57:00] INFO: A compatible version is installed.

...

[2020-09-17 22:58:18] ****: ----------------------------------------------------------------
[2020-09-17 22:58:18] ****: Test access to kompira.
[2020-09-17 22:58:18] ****:
[2020-09-17 22:58:19] INFO: Access succeeded:   &lt;div class=&quot;brand-version&quot;&gt;1.6.0&lt;/div&gt;
[2020-09-17 22:58:19] ****:
[2020-09-17 22:58:19] ****: Finish: Install the Kompira (status=0)
[2020-09-17 22:58:19] ****: ****************************************************************
</pre></div>
</div>
<p>The installer will automatically update the Kompira package. If “Finish: Install the Kompira (status=0)” is displayed, it has been successfully installed.</p>
<p>When the update is completed, please log in to Kompira from a web browser and confirm that the version number of Kompira has been updated.</p>
</div></blockquote>
<p>Major update</p>
<blockquote>
<div><p>In the case of major update, update it using the following procedure.</p>
<ul class="simple">
<li><p>Use the export_data command to retrieve data from Kompira</p></li>
<li><p>Install Kompira in database initialization mode with the <code class="docutils literal notranslate"><span class="pre">--initdata</span></code> option with the install.sh command</p></li>
<li><p>Save the first data extracted to Kompira with the import_data command</p></li>
</ul>
<p>Please note that the existing database will be initialized when you run the install.sh command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd kompira-&lt;version&gt;-bin
$ /opt/kompira/bin/manage.py export_data --owner-mode --virtual-mode / &gt; backup.json
# ./install.sh --force --initdata
$ /opt/kompira/bin/manage.py import_data --owner-mode --overwrite-mode backup.json
[2018-04-09 21:44:15,936:30953:MainProcess] INFO: import data: start...
[2018-04-09 21:44:16,010:30953:MainProcess] INFO: import object: imported &quot;system/types/TypeObject&quot; to &quot;/system/types/TypeObject&quot; (updated)
[2018-04-09 21:44:16,022:30953:MainProcess] INFO: import object: imported &quot;system/types/Directory&quot; to &quot;/system/types/Directory&quot; (updated)
[2018-04-09 21:44:16,033:30953:MainProcess] INFO: import object: imported &quot;system&quot; to &quot;/system&quot; (updated)

...

[2018-04-09 21:44:22,126:30953:MainProcess] INFO: import fields: /user/data: []
[2018-04-09 21:44:22,164:30953:MainProcess] INFO: import fields: /user/data/nodes: []
[2018-04-09 21:44:22,202:30953:MainProcess] INFO: import fields: /user/data/accounts: []
[2018-04-09 21:44:22,218:30953:MainProcess] INFO: import data: finished (created=0, updated=59, skipped=0, error=0, warning=0)
</pre></div>
</div>
<p>When running install.sh, specify the <code class="docutils literal notranslate"><span class="pre">--initdata</span></code> and <code class="docutils literal notranslate"><span class="pre">--force</span></code> options to initialize the database.</p>
<p>When the import_data process is completed, please log in to Kompira from a Web browser, confirm that the version number of Kompira has been updated, and that previously created Kompira objects still exists.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are updating from version 1.5 or earlier to version 1.6, you cannot update by following the above procedure. Please delete the previous version of Kompira and then reinstall version 1.6.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When updating from Kompira to Ver. 1.6 from Ver. 1.5 or earlier, full compatibility is not guaranteed and the migrated job flow and library objects may not work as they are. If necessary, check the operation of each Jobflow or Library object after modifying them.</p>
</div>
</div></blockquote>
</section>
<section id="postgresql">
<h4><span class="section-number">1.2.3.3. </span>Upgrade PostgreSQL<a class="headerlink" href="#postgresql" title="Permalink to this heading">¶</a></h4>
<p>From Ver. 1.6.0 to Ver. 1.6.9, PostgreSQL 12 was fixedly installed, but PostgreSQL 12 reached EOL in 2024/11. Therefore, Kompira Ver. 1.6.10 and later support the installation of PostgreSQL 13 or higher.</p>
<ul class="simple">
<li><p>When newly installing Kompira, install the latest PostgreSQL supported by Kompira at that time.</p></li>
<li><p>When updating Kompira, the existing major version of PostgreSQL is retained. However, minor updates to PostgreSQL will be performed.</p></li>
</ul>
<p>In either case, you can specify the version of PostgreSQL to install with the <code class="docutils literal notranslate"><span class="pre">--postgresql-version</span></code> option of install.sh.</p>
<ul class="simple">
<li><p>Specifying <code class="docutils literal notranslate"><span class="pre">--postgresql-version=16</span></code> or <code class="docutils literal notranslate"><span class="pre">--postgresql-version=16.*</span></code> in install.sh will install the latest major version specified.</p></li>
<li><p>Specifying <code class="docutils literal notranslate"><span class="pre">--postgresql-version=16.4</span></code> or similar to install.sh will install a specific version.</p></li>
</ul>
<p>When you install PostgreSQL by specifying a version when updating Kompira, for example from 12.17 to 17.0 and so on, a major version increase is called a PostgreSQL upgrade. When install.sh detects a PostgreSQL upgrade, it displays a message like the following to confirm that you actually want to perform the upgrade.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ./install.sh --postgresql-version=17

    ...

[2024-10-29 12:00:00] ****: ----------------------------------------------------------------
[2024-10-29 12:00:00] ****: Check current PostgreSQL and Kompira database existence.
[2024-10-29 12:00:00] ****:
[2024-10-29 12:00:00] INFO: CUR_PG_BINDIR=/usr/pgsql-12/bin
[2024-10-29 12:00:00] INFO: CUR_PG_DATADIR=/var/lib/pgsql/12/data
[2024-10-29 12:00:00] INFO: CUR_PG_SERVICE=postgresql-12
[2024-10-29 12:00:00] INFO: CUR_PG_VERSION=12.17
[2024-10-29 12:00:00] INFO: CUR_PG_MAJVER=12
[2024-10-29 12:00:00] INFO: Check free space for PostgreSQL migration
[2024-10-29 12:00:00] INFO: Data used:       152,856 KiB (/var/lib/pgsql/12/data)
[2024-10-29 12:00:00] INFO: Free space:    9,344,912 KiB (/var/lib/pgsql)
[2024-10-29 12:00:00] INFO: Free space rate: 6113.54% (OK)
[2024-10-29 12:00:00] WARN: PostgreSQL migration (12-&gt;17) detected, Are you sure?

MIGRATE POSTGRESQL 12 TO 17 AND CONTINUE INSTALLATION? (yes/No)
</pre></div>
</div>
<p>Enter <code class="docutils literal notranslate"><span class="pre">y</span></code> if you want to perform the PostgreSQL upgrade and continue the installation. Enter <code class="docutils literal notranslate"><span class="pre">n</span></code> to abort the installation. Note that if you have the <code class="docutils literal notranslate"><span class="pre">--force</span></code> option to install.sh, the upgrade and installation will continue without this confirmation.</p>
<p>When performing a PostgreSQL upgrade, run PostgreSQL’s pg_upgrade utility inside install.sh to migrate all data to the new version.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that pg_upgrade will copy all data in the server, so you will need as much free space as the amount of data used by the database cluster.</p>
</div>
<p>The message above shows the amount of data in the existing database cluster and the free space where the new version of the database cluster will be created.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2024-10-29 12:00:00] INFO: Data used:       152,856 KiB (/var/lib/pgsql/12/data)
[2024-10-29 12:00:00] INFO: Free space:    9,344,912 KiB (/var/lib/pgsql)
[2024-10-29 12:00:00] INFO: Free space rate: 6113.54% (OK)
</pre></div>
</div>
<p>The example above shows that there is sufficient free space. If you have less free space, consider freeing up space before performing the upgrade.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>install.sh checks for free space when upgrading PostgreSQL. If there is not enough free space, equivalent to 120% of the amount of data in the existing database cluster, the installation will be aborted.</p>
</div>
<p><strong>Upgrading PostgreSQL in a Redundant Configuration</strong></p>
<p>When upgrading PostgreSQL in a redundant configuration, a dedicated procedure based on the both-system stop update procedure is used. See <a class="reference internal" href="#ha-update-with-pg-upgrade"><span class="std std-ref">Procedure for updating with PostgreSQL upgrade with both systems stopped</span></a> for details.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.10: </span>PostgreSQL 13 or higher installations are now supported. PostgreSQL upgrade with update is now supported.</p>
</div>
</section>
</section>
<section id="package-jobmngr">
<span id="id10"></span><h3><span class="section-number">1.2.4. </span>Job manager package<a class="headerlink" href="#package-jobmngr" title="Permalink to this heading">¶</a></h3>
<p>Explanation of how to conduct an installation/package update including for job manager and send-event script.</p>
<section id="package-jobmngr-install">
<span id="id11"></span><h4><span class="section-number">1.2.4.1. </span>Installation<a class="headerlink" href="#package-jobmngr-install" title="Permalink to this heading">¶</a></h4>
<p>Extract the Kompira package and run install.sh. Since the job manager communicates with the Kompira server, you will need to specify the host name or IP address of the server on which the Kompira package is installed as an argument to install.sh.</p>
<p>Replace &lt;version&gt; with the version number of Kompira.</p>
<p>&lt;kompira_ip&gt; is the host name or IP address of the Kompira server.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh --jobmngr &lt;kompira_ip&gt;
[2020-09-18 00:42:54] ****: ****************************************************************
[2020-09-18 00:42:54] ****: Kompira-1.6.0:
[2020-09-18 00:42:54] ****: Start: Install the Kompira
[2020-09-18 00:42:54] ****:
[2020-09-18 00:42:54] INFO:     SYSTEM                   = CENT
[2020-09-18 00:42:54] INFO:     SYSTEM_NAME              = cent8
[2020-09-18 00:42:54] INFO:     SYSTEM_RELEASE           = CentOS Linux release 8.2.2004 (Core)
[2020-09-18 00:42:54] INFO:     SYSTEM_RELEASEVER        = 8.2.2004
[2020-09-18 00:42:54] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python

...

[2020-09-18 00:43:24] ****: ----------------------------------------------------------------
[2020-09-18 00:43:24] ****: Setup kompira-jobmngrd.
[2020-09-18 00:43:24] ****:

...

[2020-09-18 00:43:24] VERBOSE: run: systemctl restart kompira_jobmngrd
[2020-09-18 00:43:24] ****:
[2020-09-18 00:43:24] ****: Finish: Install the Kompira (status=0)
[2020-09-18 00:43:24] ****: ****************************************************************
</pre></div>
</div>
<p>The installer will automatically install a new job manager package. If “Finish: Install the Kompira (status=0)” is displayed, the installation has been a success.</p>
<p>For details on how to check that the job manager process is running correctly , see <a class="reference internal" href="#process-jobmngr"><span class="std std-ref">Starting / stopping the Kompira daemon and Checking the status.</span></a></p>
<p>Also, you can check whether Kompira itself is communicating with the job manager correctly from Kompira’s “Management area setting page”. Please log in to Kompira with Web browser and go “Settings” &gt; “Management area settings” &gt; “default” page. If the host name of the server that the job manager package is installed is displayed in the “Job Manager Status” section, communication should be ok.</p>
<p>Note that if the –amqps-verify option is added to install.sh, you will be prompted for a password as shown below to copy the SSL certificate from the specified Kompira server by scp during installation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: Start copying the SSL/CA certificates from the kompira server with scp.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: PLEASE ENTER THE PASSWORD OF THE REMOTE KOMPIRA SERVER (&lt;kompira_ip&gt;) FOR SCP.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] VERBOSE: run: scp -q -p -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@&lt;kompira_ip&gt;:/opt/kompira/ssl/certs/{kompira-bundle-ca.crt,amqp-client-kompira{.crt,.key}} /opt/kompira/ssl/certs/
root@&lt;kompira_ip&gt;&#39;s password:

...
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>If the –amqps-verify option is added to install.sh, the SSL certificate is now copied from the Kompira server by scp.</p>
</div>
</section>
<section id="package-jobmngr-update">
<span id="id12"></span><h4><span class="section-number">1.2.4.2. </span>Update<a class="headerlink" href="#package-jobmngr-update" title="Permalink to this heading">¶</a></h4>
<p>You can update the job manager package by the same procedure as the installation.</p>
</section>
</section>
<section id="package-sendevt">
<span id="id13"></span><h3><span class="section-number">1.2.5. </span>Send-Event package<a class="headerlink" href="#package-sendevt" title="Permalink to this heading">¶</a></h3>
<p>Installation /package updates including event transmission script will be explained here.</p>
<p>Send-Event packages are compatible with Linux and Windows.</p>
<section id="rhel-centos">
<span id="package-sendevt-install-linux"></span><h4><span class="section-number">1.2.5.1. </span>Extract the Kompira package and run install.sh.<a class="headerlink" href="#rhel-centos" title="Permalink to this heading">¶</a></h4>
<p>Exract Kompira packages and run install.sh</p>
<p>Since the Send-Event script sends data to Kompira itself, you need to specify the host name or IP address of the server on which Kompira packages are installed as an argument to install.sh.</p>
<p>Replace &lt;version&gt; with the version number of Kompira. &lt;kompira_ip&gt; is the host name or IP address of the Kompira server.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh --sendevt &lt;kompira_ip&gt;
[2023-01-16 18:33:50] ****: ****************************************************************
[2023-01-16 18:33:50] ****: Kompira-1.6.8:
[2023-01-16 18:33:50] ****: Start: Install the Kompira
[2023-01-16 18:33:50] ****:
[2023-01-16 18:33:50] INFO:     SYSTEM                   = CENT
[2023-01-16 18:33:50] INFO:     SYSTEM_NAME              = cent7
[2023-01-16 18:33:50] INFO:     SYSTEM_RELEASE           = CentOS Linux release 7.7.1908 (Core)
[2023-01-16 18:33:50] INFO:     SYSTEM_RELEASEVER        = 7.7.1908
[2023-01-16 18:33:50] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python
[2023-01-16 18:33:50] INFO:     PYTHON                   = /usr/bin/python
[2023-01-16 18:33:50] INFO:     SYSTEMD                  = true
[2023-01-16 18:33:50] INFO:     TMPDIR                   = /root/kompira-1.6.8-bin/.tmp.install-20230116-1833.rQ8X
[2023-01-16 18:33:50] INFO:     LOCALE_LANG              = ja_JP.UTF-8
[2023-01-16 18:33:50] INFO:     PATH                     = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
[2023-01-16 18:33:50] INFO:     HTTPS_MODE               = true
[2023-01-16 18:33:50] INFO:     AMQPS_MODE               = true

...

[2023-01-16 18:35:04] VERBOSE: run: chown :kompira /opt/kompira/ssl/certs/kompira-bundle-ca.crt /opt/kompira/ssl/certs/amqp-client-kompira.crt /opt/kompira/ssl/certs/amqp-client-kompira.key
[2023-01-16 18:35:04] ****: ----------------------------------------------------------------
[2023-01-16 18:35:04] ****: Setup kompira common files.
[2023-01-16 18:35:04] ****:
[2023-01-16 18:35:04] INFO: Create log directory: /var/log/kompira
[2023-01-16 18:35:04] VERBOSE: run: install -g kompira -m 775 -d /var/log/kompira
[2023-01-16 18:35:04] VERBOSE: run: find /var/log/kompira -type f -user root ! -name audit-* -exec chown kompira:kompira {} ;
[2023-01-16 18:35:04] INFO: Create kompira.conf
[2023-01-16 18:35:04] VERBOSE: run: install -m 644 /root/kompira-1.6.8-bin/.tmp.install-20230116-1833.rQ8X/kompira.conf /opt/kompira/kompira.conf
[2023-01-16 18:35:04] ****:
[2023-01-16 18:35:04] ****: Finish: Install the Kompira (status=0)
[2023-01-16 18:35:04] ****: ****************************************************************
</pre></div>
</div>
<p>If “Finish: Install the Kompira (status=0)” is displayed, the installation has been a success.</p>
<p>When the installation is completed, the kompira_sendevt will be placed under /opt/kompira/bin</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/kompira_sendevt --version
kompira_sendevt (Kompira version 1.6.8)
</pre></div>
</div>
<p>Note that if the –amqps-verify option is added to install.sh, you will be prompted for a password as shown below to copy the SSL certificate from the specified Kompira server by scp during installation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: Start copying the SSL/CA certificates from the kompira server with scp.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: PLEASE ENTER THE PASSWORD OF THE REMOTE KOMPIRA SERVER (&lt;kompira_ip&gt;) FOR SCP.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] VERBOSE: run: scp -q -p -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@&lt;kompira_ip&gt;:/opt/kompira/ssl/certs/{kompira-bundle-ca.crt,amqp-client-kompira{.crt,.key}} /opt/kompira/ssl/certs/
root@&lt;kompira_ip&gt;&#39;s password:

...
</pre></div>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>If the –amqps-verify option is added to install.sh, the SSL certificate is now copied from the Kompira server by scp.</p>
</div>
</section>
<section id="windows">
<span id="package-sendevt-install-windows"></span><h4><span class="section-number">1.2.5.2. </span>Installation on Windows<a class="headerlink" href="#windows" title="Permalink to this heading">¶</a></h4>
<ol class="arabic">
<li><p><strong>Installing Python</strong></p>
<blockquote>
<div><p>Install Python 3.6 for Windows.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></p></li>
</ul>
<p>Download the latest Python 3.6 installer for Windows from the above mentioned official site and install it on your Windows Operating System.</p>
<p>When the installation is completed, add the environment variable path so that Python can be called from the command line.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Python36</span></code></p></td>
<td><p>Folder that Python commands are stored</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\Python36\Scripts</span></code></p></td>
<td><p>Folder that pip and other command types are stored</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
</li>
<li><p><strong>Creating a Python virtual environment for Kompira</strong></p>
<blockquote>
<div><p>Create an independent Python virtual environment (venv) for Kompira in <code class="docutils literal notranslate"><span class="pre">C:\Kompira</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; python -m venv C:\Kompira
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>Create the directory for the log files</strong></p>
<blockquote>
<div><p>Create the directory <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Log</span></code> as the log file output destination.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; mkdir C:\Kompira\Log
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>Installation of the kompira_sendevt package</strong></p>
<blockquote>
<div><p>After downloading and unpacking the Kompira package on Windows, Install the Kompira_sendevt-&lt;version&gt;-py3-none-any.whl package with plp.exe.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; C:\Kompira\Scripts\pip.exe install Kompira_sendevt-1.6.0-py3-none-any.whl
Processing c:\users\kompira\documents\kompira-package\kompira_sendevt-1.6.0-py3-none-any.whl
Collecting amqp~=2.6.1 (from Kompira-sendevt==1.6.8)

...

Installing collected packages: amqp, decorator, Kompira-sendevt
Successfully installed Kompira-sendevt-1.6.8 amqp-2.6.1 vine-1.3.0
</pre></div>
</div>
<p>The Send-Event package installation is now complete. The kompira_sendevt will be placed under <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Scripts</span></code>. Try running the kompira_sendevt command as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; C:\Kompira\Scripts\kompira_sendevt.exe --version
kompira_sendevt (Kompira version 1.6.8)
</pre></div>
</div>
<p>If it is correctly installed, it will display the version number.</p>
<p>If you add <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Scripts</span></code> to the environment variable PATH, you can omit the path and execute it.</p>
</div></blockquote>
</li>
<li><p><strong>Obtain an SSL certificate file from the Kompira server</strong></p>
<blockquote>
<div><p>To send a message with kompira_sendevt to a Kompira server that has SSL certificate verification enabled, such as by adding the –amqps-verify option during installation, you need an SSL certificate issued by that Kompira server. To connect with kompira_sendevt using an SSL certificate, obtain the following file from the Kompira server and locate it in the <code class="docutils literal notranslate"><span class="pre">C:\Kompira\SSL\Certs</span></code> directory.</p>
<ul class="simple">
<li><p>/opt/kompira/ssl/certs/kompira-bundle-ca.crt</p></li>
<li><p>/opt/kompira/ssl/certs/amqp-client-kompira.crt</p></li>
<li><p>/opt/kompira/ssl/certs/amqp-client-kompira.key</p></li>
</ul>
<p>For example, if you have Windows with scp command available, you can transfer files from the Kompira server. The <code class="docutils literal notranslate"><span class="pre">&lt;kompira_ip&gt;</span></code> part should be the address of the Kompira server.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; mkdir C:\Kompira\SSL\Certs
C:\&gt; scp root@&lt;kompira_ip&gt;:/opt/kompira/ssl/certs/{kompira-bundle-ca.crt,amqp-client-kompira{.crt,.key}} C:\Kompira\SSL\Certs
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><strong>Creating the configuration file kompira.conf</strong></p>
<blockquote>
<div><p>Create a configuration file in <code class="docutils literal notranslate"><span class="pre">C:\Kompira\kompira.conf</span></code> that kompira_sendevt will read. The default configuration under Windows is shown below, where <code class="docutils literal notranslate"><span class="pre">&lt;kompira_ip&gt;</span></code> is Kompira server address.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[kompira]
site_id         = 1

[logging]
logdir          = C:\Kompira\Log

[amqp-connection]
server          = &lt;kompira_ip&gt;
port            = 5671
ssl             = true
ssl_verify      = false
ssl_cacertfile  =
ssl_certfile    =
ssl_keyfile     =

[event]
channel         = /system/channels/Alert

[agent]
name            = default
</pre></div>
</div>
<p>To use an SSL certificate obtained from a Kompira server, replace the following part.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ssl_verify      = true
ssl_cacertfile  = C:\Kompira\SSL\Certs\kompira-bundle-ca.crt
ssl_certfile    = C:\Kompira\SSL\Certs\amqp-client-kompira.crt
ssl_keyfile     = C:\Kompira\SSL\Certs\amqp-client-kompira.key
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="package-sendevt-update">
<span id="id14"></span><h4><span class="section-number">1.2.5.3. </span>Update<a class="headerlink" href="#package-sendevt-update" title="Permalink to this heading">¶</a></h4>
<p>With the same procedure as the installation you can update the Send-Event package.</p>
</section>
</section>
<section id="offline-install">
<span id="id15"></span><h3><span class="section-number">1.2.6. </span>Offline install<a class="headerlink" href="#offline-install" title="Permalink to this heading">¶</a></h3>
<p>To perform an offline installation, you need to take the following steps.</p>
<ul class="simple">
<li><p>Create the kompira-extra package in an Internet-connected environment.</p></li>
<li><p>Offline installation using the kompira-extra package.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>However, we have not been able to confirm that it works in all environments, so please let us know if there are any problems.</p>
</div>
<section id="kompira-extra">
<h4><span class="section-number">1.2.6.1. </span>Create the kompira-extra package in an Internet-connected environment.<a class="headerlink" href="#kompira-extra" title="Permalink to this heading">¶</a></h4>
<p>The creation of the kompira-extra package must be performed on a server that meets the following conditions.</p>
<ul class="simple">
<li><p>A server with the same configuration as the target for offline installation (at least the OS and version should match).</p></li>
<li><p>A server with an Internet connection (if necessary, specify a proxy).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For RHEL, please register a subscription if necessary.</p>
</div>
<p><strong>Creating the kompira-extra package using install.sh</strong></p>
<p>Run the install.sh included in the kompira package with the <code class="docutils literal notranslate"><span class="pre">--extra</span></code> option.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh --extra
[2021-11-04 20:56:38] ****: ****************************************************************
[2021-11-04 20:56:38] ****: Kompira-1.6.3:
[2021-11-04 20:56:38] ****: Start: Install the Kompira
[2021-11-04 20:56:38] ****:
[2021-11-04 20:56:38] INFO:     SYSTEM                   = CENT
[2021-11-04 20:56:38] INFO:     SYSTEM_NAME              = cent8
[2021-11-04 20:56:38] INFO:     SYSTEM_RELEASE           = CentOS Linux release 8.2.2004 (Core)
[2021-11-04 20:56:38] INFO:     SYSTEM_RELEASEVER        = 8.2.2004
[2021-11-04 20:56:38] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python
[2021-11-04 20:56:38] INFO:     PYTHON                   =
[2021-11-04 20:56:38] INFO:     SYSTEMD                  = true
[2021-11-04 20:56:38] INFO:     TMPDIR                   = /root/kompira-1.6.3-bin/.tmp.install-20211104-2056.P3fx
[2021-11-04 20:56:38] INFO:     LOCALE_LANG              = ja_JP.UTF-8
[2021-11-04 20:56:38] INFO:     PATH                     = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
[2021-11-04 20:56:38] INFO:     HTTPS_MODE               = true
[2021-11-04 20:56:38] INFO:     FORCE_MODE               = false
[2021-11-04 20:56:38] INFO:     BACKUP_MODE              = true
[2021-11-04 20:56:38] INFO:     BACKUP_PROCESS           = false
[2021-11-04 20:56:38] INFO:     INITDATA_MODE            = false
[2021-11-04 20:56:38] INFO:     INITFILE_MODE            = false
[2021-11-04 20:56:38] INFO:     OFFLINE_MODE             = false
[2021-11-04 20:56:38] INFO:     JOBMNGR_MODE             = false
[2021-11-04 20:56:38] INFO:     SENDEVT_MODE             = false
[2021-11-04 20:56:38] INFO:     PROXY_URL                =
[2021-11-04 20:56:38] INFO:     NO_PROXY                 = localhost,127.0.0.1
[2021-11-04 20:56:38] INFO:     KOMPIRA_SERVER           = localhost
[2021-11-04 20:56:38] INFO:     DRY_RUN                  = false
[2021-11-04 20:56:38] ****: ----------------------------------------------------------------

...

opt/kompira/extra/1.6.3/cent8/wheelhouse/PyYAML-5.3.1-cp36-cp36m-linux_x86_64.whl
opt/kompira/extra/1.6.3/cent8/wheelhouse/pykerberos-1.2.1-cp36-cp36m-linux_x86_64.whl
opt/kompira/extra/1.6.3/cent8/wheelhouse/future-0.18.2-py3-none-any.whl
opt/kompira/extra/1.6.3/cent8/wheelhouse/PTable-0.9.2-py3-none-any.whl
[2021-11-04 21:08:58] ****:
[2021-11-04 21:08:58] ****: Finish: Install the Kompira (status=0)
[2021-11-04 21:08:58] ****: ****************************************************************
</pre></div>
</div>
<p><strong>Check the kompira-extra package</strong></p>
<p>If there are no problems, a package file starting with <code class="docutils literal notranslate"><span class="pre">kompira-extra-</span></code> will be generated in about 10-20 minutes, so check it.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ls -lh kompira-extra-*.tar.gz
-rw-r--r--. 1 root root 290M Nov  4 21:08 kompira-extra-1.6.3.cent8.tar.gz
</pre></div>
</div>
</section>
<section id="id16">
<h4><span class="section-number">1.2.6.2. </span>Offline installation using the kompira-extra package.<a class="headerlink" href="#id16" title="Permalink to this heading">¶</a></h4>
<p><strong>Prepare the kompira and kompira-extra packages</strong></p>
<p>On the server where you want to perform the offline installation, place the kompira package and the kompira-extra package created above.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># ls -l kompira-*
-rw-r--r--. 1 root root   7555278 Nov  4 21:11 kompira-1.6.3-bin.tar.gz
-rw-r--r--. 1 root root 303772888 Nov  4 21:12 kompira-extra-1.6.3.cent8.tar.gz
</pre></div>
</div>
<p><strong>Extract the kompira-extra package.</strong></p>
<p>With root privileges, extract the kompira-extra package to the root directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># tar zxf kompira-extra-1.6.3.cent8.tar.gz -C /
</pre></div>
</div>
<p>Make sure that the various packages required for offline installation have been extracted under <code class="docutils literal notranslate"><span class="pre">/opt/kompira/extra/1.6.x/${OS}/</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ls -l /opt/kompira/extra/1.6.3/*
total 40
drwxr-xr-x. 3 root root 24576 Nov  4 21:08 packages
drwxr-xr-x. 2 root root     6 Nov  4 20:57 pip
drwxr-xr-x. 2 root root  8192 Nov  4 21:08 wheelhouse
</pre></div>
</div>
<p><strong>Run the kompira offline installation.</strong></p>
<p>Extract the kompira package and run install.sh with the <code class="docutils literal notranslate"><span class="pre">--offline</span></code> option.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh --offline
[2021-11-04 21:14:37] ****: ****************************************************************
[2021-11-04 21:14:37] ****: Kompira-1.6.3:
[2021-11-04 21:14:37] ****: Start: Install the Kompira (offline-mode)
[2021-11-04 21:14:37] ****:
[2021-11-04 21:14:37] INFO:     SYSTEM                   = CENT
[2021-11-04 21:14:37] INFO:     SYSTEM_NAME              = cent8
[2021-11-04 21:14:37] INFO:     SYSTEM_RELEASE           = CentOS Linux release 8.2.2004 (Core)
[2021-11-04 21:14:37] INFO:     SYSTEM_RELEASEVER        = 8.2.2004
[2021-11-04 21:14:37] INFO:     PLATFORM_PYTHON          = /usr/libexec/platform-python
[2021-11-04 21:14:37] INFO:     PYTHON                   =
[2021-11-04 21:14:37] INFO:     SYSTEMD                  = true
[2021-11-04 21:14:37] INFO:     TMPDIR                   = /root/kompira-1.6.3-bin/.tmp.install-20211104-2114.7XV8
[2021-11-04 21:14:37] INFO:     LOCALE_LANG              = ja_JP.UTF-8
[2021-11-04 21:14:37] INFO:     PATH                     = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin
[2021-11-04 21:14:37] INFO:     HTTPS_MODE               = true
[2021-11-04 21:14:37] INFO:     FORCE_MODE               = false
[2021-11-04 21:14:37] INFO:     BACKUP_MODE              = true
[2021-11-04 21:14:37] INFO:     BACKUP_PROCESS           = false
[2021-11-04 21:14:37] INFO:     INITDATA_MODE            = false
[2021-11-04 21:14:37] INFO:     INITFILE_MODE            = false
[2021-11-04 21:14:37] INFO:     OFFLINE_MODE             = true
[2021-11-04 21:14:37] INFO:     JOBMNGR_MODE             = false
[2021-11-04 21:14:37] INFO:     SENDEVT_MODE             = false
[2021-11-04 21:14:37] INFO:     PROXY_URL                =
[2021-11-04 21:14:37] INFO:     NO_PROXY                 = localhost,127.0.0.1
[2021-11-04 21:14:37] INFO:     KOMPIRA_SERVER           = localhost
[2021-11-04 21:14:37] INFO:     DRY_RUN                  = false
[2021-11-04 21:14:37] ****: ----------------------------------------------------------------

...

[2021-11-04 21:15:25] ****: ----------------------------------------------------------------
[2021-11-04 21:15:25] ****: Test access to kompira.
[2021-11-04 21:15:25] ****:
[2021-11-04 21:15:26] INFO: Access succeeded:   &lt;div class=&quot;brand-version&quot;&gt;1.6.3&lt;/div&gt;
[2021-11-04 21:15:26] ****:
[2021-11-04 21:15:26] ****: Finish: Install the Kompira (offline-mode) (status=0)
[2021-11-04 21:15:26] ****: ****************************************************************
</pre></div>
</div>
</section>
</section>
</section>
<section id="process">
<span id="id17"></span><h2><span class="section-number">1.3. </span>Kompira process management<a class="headerlink" href="#process" title="Permalink to this heading">¶</a></h2>
<p>The Kompira system has multiple processes working together. Kompira’s process structure will be explained below.</p>
<section id="process-architecture">
<span id="id18"></span><h3><span class="section-number">1.3.1. </span>Structure of Kompira processes<a class="headerlink" href="#process-architecture" title="Permalink to this heading">¶</a></h3>
<p>The Kompira system structure processes are as follows:</p>
<dl>
<dt><strong>Kompira daemon (kompirad)</strong></dt><dd><p>Kompira Daemon process for executing and managing job flow.</p>
<p>Kompira Job Manager is requested to execute remote command and receives the result.</p>
</dd>
<dt><strong>Kompira Job Manager (kompira_jobmngrd)</strong></dt><dd><p>This is a daemon process for executing the remote command requested from the Kompira daemon.</p>
<p>Kompira Job Manager will connect to the remote host with the protocol specified by the connection type and execute the command when receiving the remote command from the Kompira daemon. The command execution result will be sent to the Kompira daemon.</p>
</dd>
</dl>
<p>Other processes required for the Kompira system are Apache (httpd), PostgreSQL (postgresql), RabbitMQ (rabbitmq-server).</p>
<p>Each of these processes is set up by install.sh to start automatically at machine startup.</p>
</section>
<section id="process-daemon">
<span id="id19"></span><h3><span class="section-number">1.3.2. </span>Starting / stopping the Kompira daemon and Checking the state<a class="headerlink" href="#process-daemon" title="Permalink to this heading">¶</a></h3>
<p>Please start and stop the Kompira daemon as root. The user running daemon will change to Kompira automatically after startup.</p>
<section id="rhel-centos-7-8">
<h4><span class="section-number">1.3.2.1. </span>For RHEL / CentOS 7x / 8x<a class="headerlink" href="#rhel-centos-7-8" title="Permalink to this heading">¶</a></h4>
<p>Start the Kompira daemon on RHEL / CentOS 7x / 8x by the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl start kompirad
</pre></div>
</div>
<p>To abort, execute the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl stop kompirad
</pre></div>
</div>
<p>With the systemctl status command you can check the status of the Kompira daemon.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ systemctl status kompirad.service
* kompirad.service - Kompira-daemon
   Loaded: loaded (/usr/lib/systemd/system/kompirad.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2018-07-05 16:33:02 JST; 2h 20min ago
  Process: 5277 ExecStartPre=/opt/kompira/bin/prestart_kompirad.sh (code=exited, status=0/SUCCESS)
 Main PID: 5368 (kompirad)
   CGroup: /system.slice/kompirad.service
           `-5368 /opt/kompira/bin/python3.6 /opt/kompira/bin/kompirad

 Jul 05 16:32:32 kompira-install-test3.dev.fixpoint.co.jp systemd[1]: Starting Kompira-daemon...
 Jul 05 16:33:02 kompira-install-test3.dev.fixpoint.co.jp systemd[1]: Started Kompira-daemon.
</pre></div>
</div>
<p>When it is started, the Active: section is as <strong>active (running)</strong>, and when it is aborted it displays as <strong>inactive (dead)</strong>.</p>
</section>
</section>
<section id="process-jobmngr">
<span id="id20"></span><h3><span class="section-number">1.3.3. </span>Starting / stopping the Kompira daemon and Checking the status.<a class="headerlink" href="#process-jobmngr" title="Permalink to this heading">¶</a></h3>
<p>Please start and stop the Kompira daemon as root. User to run daemon will be change to kompira are automatically after startup.</p>
<section id="id21">
<h4><span class="section-number">1.3.3.1. </span>For RHEL / CentOS 7x / 8x<a class="headerlink" href="#id21" title="Permalink to this heading">¶</a></h4>
<p>Start the Kompira job manager on RHEL / CentOS 7x / 8x by the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl start kompira_jobmngrd.service
</pre></div>
</div>
<p>To abort, execute the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># systemctl stop kompira_jobmngrd.service
</pre></div>
</div>
<p>With the status command you can check the status of the Kompira job manager.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ systemctl status kompira_jobmngrd.service
* kompira_jobmngrd.service - Kompira-jobmanager
   Loaded: loaded (/usr/lib/systemd/system/kompira_jobmngrd.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2018-07-05 16:32:22 JST; 2h 25min ago
 Main PID: 5164 (kompira_jobmngr)
   CGroup: /system.slice/kompira_jobmngrd.service
           |-5164 /opt/kompira/bin/python3.6 /opt/kompira/bin/kompira_jobmngrd
           `-5197 /opt/kompira/bin/python3.6 /opt/kompira/bin/kompira_jobmngrd

 Jul 05 16:32:22 kompira-install-test3.dev.fixpoint.co.jp systemd[1]: Started Kompira-jobmanager.
 Jul 05 16:32:22 kompira-install-test3.dev.fixpoint.co.jp systemd[1]: Starting Kompira-jobmanager...
</pre></div>
</div>
<p>When it is started, the Active: section is as <strong>active (running)</strong>, and when it is aborted it displays as <strong>inactive (dead)</strong>.</p>
</section>
</section>
<section id="process-port">
<span id="id22"></span><h3><span class="section-number">1.3.4. </span>Port List used by Kompira<a class="headerlink" href="#process-port" title="Permalink to this heading">¶</a></h3>
<p>On the server on which the Kompira package is installed, the following ports need to be open to access from outside.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port number</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>80/TCP</p></td>
<td><p>HTTP (it is unnecessary when accessing only HTTPS)</p></td>
</tr>
<tr class="row-odd"><td><p>443/TCP</p></td>
<td><p>HTTPS (it is unnecessary when accessing only HTTP)</p></td>
</tr>
<tr class="row-even"><td><p>5671/TCP</p></td>
<td><p>AMQPS (not required if you do not allow AMQPS connections from external kompira_jobmngrd or kompira_sendevt)</p></td>
</tr>
<tr class="row-odd"><td><p>5672/TCP</p></td>
<td><p>AMQP (not required if you do not allow AMQP connections from external kompira_jobmngrd or kompira_sendevt)</p></td>
</tr>
</tbody>
</table>
<p>Otherwise, the port 5593/TCP is used in the loopback IF for the httpd server and the Kompira engine RPC.(No need to make it externally connectable)</p>
<p>When building a redundant configuration, it is necessary to be able to communicate using the following ports between each node (or between internal IFs when using internal IFs for heartbeat).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Port number</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2224/TCP</p></td>
<td><p>pcs (high-availability middleware)</p></td>
</tr>
<tr class="row-odd"><td><p>4369/TCP</p></td>
<td><p>epmd (Erlang port mapper daemon)</p></td>
</tr>
<tr class="row-even"><td><p>5405/UDP</p></td>
<td><p>corosync (for heartbeat)</p></td>
</tr>
<tr class="row-odd"><td><p>5432/TCP</p></td>
<td><p>PostgreSQL (for replication)</p></td>
</tr>
<tr class="row-even"><td><p>25672/TCP</p></td>
<td><p>RabbitMQ Server (for inter-node communication)</p></td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.4: </span>Rsyncd has been removed from the port number list because it is no longer used.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.8: </span>Added 5671/TCP to the port list to support AMQPS.</p>
</div>
</section>
</section>
<section id="node">
<span id="id23"></span><h2><span class="section-number">1.4. </span>Node setting<a class="headerlink" href="#node" title="Permalink to this heading">¶</a></h2>
<p>Kompira allows you to run remote jobs on the following types of nodes.</p>
<ul class="simple">
<li><p>Local node</p></li>
<li><p>SSH node</p></li>
<li><p>Windows node</p></li>
<li><p>Network device node</p></li>
</ul>
<p>The connection type to be specified for each type of node and the settings required on the node side in advance differ.</p>
<p>For details on how to specify the connection type, see <a class="reference internal" href="reference.html#control-variables"><span class="std std-ref">Control variable</span></a>.</p>
<section id="node-local">
<span id="id24"></span><h3><span class="section-number">1.4.1. </span>Local node setting<a class="headerlink" href="#node-local" title="Permalink to this heading">¶</a></h3>
<p>There is one type of connection to Local nodes.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Connection type</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">local</span></code></p></td>
<td><p>Local execution</p></td>
<td><p>Runs jobs directly on the node where kompira_jobmngrd is running.</p></td>
</tr>
</tbody>
</table>
<p>If a remote node is not explicitly specified in Kompira, the job is executed directly on the local node. The local node here is the node where the kompira_jobmngrd service is running.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.6: </span>Description of local node is added.</p>
</div>
</section>
<section id="ssh">
<span id="node-ssh"></span><h3><span class="section-number">1.4.2. </span>SSH node setting<a class="headerlink" href="#ssh" title="Permalink to this heading">¶</a></h3>
<p>There is one type of connection to SSH nodes.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Connection type</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>Only SSH v2 is supported.</p></td>
</tr>
</tbody>
</table>
<p>When executing commands from Kompira to an SSH node, you should log in with ssh version 2. As for recent Linux, ssh login is ready by default so it is not necessary to configure. For details on how to enable ssh login on other nodes, refer to the manual of each operation system.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supported version of SSH is only v2. SSH v1 is not supported.</p>
</div>
</section>
<section id="node-winrs">
<span id="id25"></span><h3><span class="section-number">1.4.3. </span>Windows node setting<a class="headerlink" href="#node-winrs" title="Permalink to this heading">¶</a></h3>
<p>For Windows nodes, there are four connection types to choose from.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Connection type</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">windows/https</span></code></p></td>
<td><p>WS-Man HTTPS</p></td>
<td><p>Requires the installation of an SSL certificate on the server side.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">windows/https-ignore-validation</span></code></p></td>
<td><p>WS-Man HTTPS (ignore server certificate validation errors)</p></td>
<td><p>Self-signed certificates are available.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">windows/http</span></code></p></td>
<td><p>WS-Man HTTP (with message encryption)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">windows/http-unencrypted</span></code></p></td>
<td><p>WS-Man HTTP (without message encryption)</p></td>
<td><p>(Deprecated) Requires server-side allow unencrypted.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For compatibility, the traditional connection type <code class="docutils literal notranslate"><span class="pre">winrs</span></code> can also be used. However, in this case, the protocol used will be switched depending on whether or not a port number is specified. HTTPS will be used if the port number is 5986 or 443, and HTTP will be used if the port number is 5985 or 80. If the port number is omitted, an HTTPS connection will be attempted.</p>
</div>
<p>When executing commands from Kompira to the Windows node, WinRM setting is required on the Windows node. The supported version of WinRM is 1.1, 2.0, 3.0.</p>
<section id="winrm">
<h4><span class="section-number">1.4.3.1. </span>Enabling remote management of WinRM<a class="headerlink" href="#winrm" title="Permalink to this heading">¶</a></h4>
<p>In order to enable WinRM, please run Windows Command Prompt as Administrator and execute  <code class="docutils literal notranslate"><span class="pre">winrm</span> <span class="pre">quickconfig</span></code>  (or <code class="docutils literal notranslate"><span class="pre">winrm</span> <span class="pre">qc</span></code>). When you are prompted to select y/n, i.e. “Do you want to change [y / n]?” Please enter y. Note that this operation is not needed from the second time.</p>
<p>The following is an example of Windows 7, but the details of the contents displayed can be different depending on the version of Windows and the setting.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt;winrm quickconfig
...
Make these changes [y/n]? y
...
</pre></div>
</div>
</section>
<section id="id26">
<h4><span class="section-number">1.4.3.2. </span>Changing WinRM connection settings<a class="headerlink" href="#id26" title="Permalink to this heading">¶</a></h4>
<p>HTTPS connections are the most secure connection method, but require an SSL certificate to be installed on the Windows node. The detailed procedure is not shown here, but you can refer to the Microsoft support page for more information.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.microsoft.com/en-us/search/?terms=winrm%20https">https://docs.microsoft.com/en-us/search/?terms=winrm%20https</a></p></li>
</ul>
<p>Although deprecated, if you want to make HTTP connections without message encryption, you need to allow unencrypted communication in WinRM. You can allow unencrypted communication by executing the following command from a command prompt run as administrator.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; winrm set winrm/config/service @{AllowUnencrypted=&quot;true&quot;}
</pre></div>
</div>
<p>HTTP connections with message encryption may be slower than those without message encryption. If slowdowns are an issue, consider using unencrypted communications with an understanding of the risks.</p>
<p>By default, WinRM allows only privileged users who belong to the Administrators group to connect. If you want to connect as an unprivileged user, you will need to do some additional configuration, try one of the following.</p>
<ul>
<li><p>Add the user to the “Remote Management Users” group.</p></li>
<li><p>Execute the following command from a command prompt run as an administrator to give read and execute privileges to the user or one of the groups to which he or she belongs.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>C:\&gt; winrm configSDDL default
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.4.10: </span>Since Kompira Ver.1.4.10 and later, NTLM authentication is supported by default, so BASIC authentication is no longer needed.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.4: </span>Since message encryption is now supported in WinRM for HTTP connections, allowing unencrypted communication is no longer required. In addition, allowing unencrypted communication is now deprecated.</p>
</div>
</section>
<section id="id27">
<h4><span class="section-number">1.4.3.3. </span>Test job flow<a class="headerlink" href="#id27" title="Permalink to this heading">¶</a></h4>
<p>Please create and run the following job flow in Kompira to see if you can execute commands to the Windows node.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[__host__ = &#39;&lt;IP address of Windows server&gt;&#39;,
 __user__ = &#39;&lt;Username of Windows account&gt;&#39;,
 __password__ = &#39;&lt;Password of Windows account&gt;&#39;,
 __conntype__ = &#39;windows/http&#39;]
-&gt; [&#39;ver&#39;]
-&gt; print($RESULT)
</pre></div>
</div>
<p>It is successful if the Windows version number is displayed on the console of the job flow process.</p>
<p>In WinRM 2.0 and later, TCP port 5985 is used by default, but in WinRM 1.1 such as Windows Server 2008, the port number used is 80. In that case, add the port number setting  <code class="docutils literal notranslate"><span class="pre">__port__</span> <span class="pre">=</span> <span class="pre">80</span></code> .</p>
<p>If you cannot connect properly, make sure that the firewall allows TCP port 5985 (or 80) to pass through, and check whether the login account settings are correct or not.</p>
</section>
</section>
<section id="node-device">
<span id="id28"></span><h3><span class="section-number">1.4.4. </span>Network device node setting<a class="headerlink" href="#node-device" title="Permalink to this heading">¶</a></h3>
<p>If you want to execute commands from Kompira to a network device node, you need to enable SSH or TELNET login beforehand, depending on the network device. For details on how to enable SSH or TELNET login for each device, please refer to the manual of each device.</p>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.4: </span>Remote jobs with network device nodes are now supported.</p>
</div>
<section id="id29">
<h4><span class="section-number">1.4.4.1. </span>List of supported devices<a class="headerlink" href="#id29" title="Permalink to this heading">¶</a></h4>
<p>As of Kompira v1.6.4, remote jobs with the following network devices (connection protocols) are supported.</p>
<ul class="simple">
<li><p>Cisco IOS (SSH, TELNET)</p></li>
<li><p>Cisco ASA (SSH)</p></li>
<li><p>Yamaha (SSH, TELNET)</p></li>
<li><p>Juniper ScreenOS (SSH)</p></li>
<li><p>HP Procurve (SSH)</p></li>
</ul>
<p>The following table shows the connection types that can be specified for each device and the devices whose operation was checked.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Network device</p></th>
<th class="head"><p>Connection type</p></th>
<th class="head"><p>Protocol</p></th>
<th class="head"><p>Devices confirmed to work</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td rowspan="2"><p>Cisco IOS</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cisco_ios/ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>Cisco 892J, Cisco CSR1000V</p></td>
<td><p>Support for PUT/GET</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cisco_ios/telnet</span></code></p></td>
<td><p>TELNET</p></td>
<td><p>Cisco 892J, Cisco CSR1000V</p></td>
<td><p>Support for PUT/GET</p></td>
</tr>
<tr class="row-even"><td><p>Cisco ASA</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">cisco_asa/ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>Cisco ASA5505</p></td>
<td><p>Support for PUT/GET</p></td>
</tr>
<tr class="row-odd"><td rowspan="2"><p>Yamaha</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">yamaha/ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>Yamaha RTX1200</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">yamaha/telnet</span></code></p></td>
<td><p>TELNET</p></td>
<td><p>Yamaha RTX1200</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>Juniper ScreenOS</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">juniper_screenos/ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>Juniper SSG5</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>HP ProCurve</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">hp_procurve/ssh</span></code></p></td>
<td><p>SSH</p></td>
<td><p>ProCurve 2510G</p></td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Other models than the above can be selected as node types, but we have not been able to confirm their operation.</p>
</div>
</section>
<section id="id30">
<h4><span class="section-number">1.4.4.2. </span>Restrictions on network devices<a class="headerlink" href="#id30" title="Permalink to this heading">¶</a></h4>
<p>Not all functions of Remote Job are supported in cooperation with network devices. Please note that there are some limitations as follows.</p>
<ul class="simple">
<li><p>The command job cannot determine the success or failure of a command. If the login is successful, $STATUS will always be 0 regardless of the actual command success or failure. If error judgment is required, it is necessary to check whether the standard output contains error messages or not in the job flow.</p></li>
<li><p>Standard error output is not supported. Internally it is the same as PTY mode (<code class="docutils literal notranslate"><span class="pre">__use_pty__=true</span></code>) and all output is taken as standard output.</p></li>
<li><p>Specifying the shell or execution directory by control variables is not supported.</p></li>
<li><p>Script jobs and reboot jobs are not supported.</p></li>
<li><p>File transfer by PUT/GET is supported on some devices, but only single file transfer is possible. Wildcard specification and recursive file transfer are not supported.</p></li>
</ul>
</section>
<section id="id31">
<h4><span class="section-number">1.4.4.3. </span>Information on the devices tested<a class="headerlink" href="#id31" title="Permalink to this heading">¶</a></h4>
<p>The following table shows the version information for each device that we have tested.</p>
<p>Cisco 892J:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cisco IOS Software, C890 Software (C890-UNIVERSALK9-M), Version 15.0(1)M3, RELEASE SOFTWARE (fc2)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2010 by Cisco Systems, Inc.
Compiled Sun 18-Jul-10 08:34 by prod_rel_team
ROM: System Bootstrap, Version 12.4(22r)YB3, RELEASE SOFTWARE (fc1)
</pre></div>
</div>
<p>Cisco CSR1000V:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cisco IOS XE Software, Version 03.11.00.S - Standard Support Release
Cisco IOS Software, CSR1000V Software (X86_64_LINUX_IOSD-UNIVERSALK9-M), Version 15.4(1)S, RELEASE SOFTWARE (fc2)
Technical Support: http://www.cisco.com/techsupport
Copyright (c) 1986-2013 by Cisco Systems, Inc.
Compiled Tue 19-Nov-13 21:00 by mcpre
</pre></div>
</div>
<p>Cisco ASA5505:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cisco Adaptive Security Appliance Software Version 8.4(4)3
Device Manager Version 6.4(9)
Compiled on Wed 11-Jul-12 10:25 by builders
System image file is &quot;disk0:/asa844-3-k8.bin&quot;
Config file at boot was &quot;startup-config&quot;
</pre></div>
</div>
<p>Yamaha RTX1200:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>RTX1200 BootROM Ver.1.01
RTX1200 Rev.10.01.78 (Wed Nov 13 16:29:42 2019)
</pre></div>
</div>
<p>Juniper SSG5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Product Name: SSG5-Serial
Serial Number: XXXXXXXXXXXXXXXX, Control Number: 00000000
Hardware Version: 0710(0)-(00), FPGA checksum: 00000000, VLAN1 IP (0.0.0.0)
Flash Type: Samsung
Software Version: 6.2.0r8-cu1.0, Type: Firewall+VPN
Feature: AV-K
Compiled by build_master at: Thu Nov 18 01:29:55 PST 2010
</pre></div>
</div>
<p>ProCurve 2510G:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Image stamp:    /sw/code/build/cod(cod11)
                Nov 17 2009 16:55:04
                Y.11.16
                43
Boot Image:     Primary
</pre></div>
</div>
</section>
</section>
</section>
<section id="file">
<span id="id32"></span><h2><span class="section-number">1.5. </span>Kompira settings and log files<a class="headerlink" href="#file" title="Permalink to this heading">¶</a></h2>
<p>The following is an explanation of the directory and configuration files on the server that are standard to Kompira.</p>
<section id="file-hierarchy">
<span id="id33"></span><h3><span class="section-number">1.5.1. </span>Kompira standard directories.<a class="headerlink" href="#file-hierarchy" title="Permalink to this heading">¶</a></h3>
<p>The following is a list of directories and configuration files on the server that Kompira uses as standard.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td colspan="2"><p>Path</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td rowspan="2"><p>/opt/kompira/</p></td>
<td><p>bin/</p></td>
<td><p>Directory for Kompira executable file</p></td>
</tr>
<tr class="row-odd"><td><p>kompira.conf</p></td>
<td><p>Kompira configuration files</p></td>
</tr>
<tr class="row-even"><td><p>/var/log/kompira/</p></td>
<td></td>
<td><p>Directory for engine and job manager log files</p></td>
</tr>
<tr class="row-odd"><td rowspan="4"><p>/var/opt/kompira/</p></td>
<td></td>
<td><p>Directory of Kompira variable files</p></td>
</tr>
<tr class="row-even"><td><p>kompira.lic</p></td>
<td><p>Kompira license</p></td>
</tr>
<tr class="row-odd"><td><p>html/</p></td>
<td><p>Online help’s HTML file group</p></td>
</tr>
<tr class="row-even"><td><p>repository/</p></td>
<td><p>Working directory for repository link</p></td>
</tr>
<tr class="row-odd"><td><p>/etc/httpd/conf.d/</p></td>
<td><p>kompira.conf</p></td>
<td><p>Apache setting files</p></td>
</tr>
</tbody>
</table>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 1.6.4: </span>The /var/opt/kompira/upload directory has been deprecated because attachments are now stored on the database.</p>
</div>
</section>
<section id="file-log">
<span id="id34"></span><h3><span class="section-number">1.5.2. </span>Kompira logs<a class="headerlink" href="#file-log" title="Permalink to this heading">¶</a></h3>
<p>Kompira’s own log files are created by default under the following directory.</p>
<ul class="simple">
<li><p>/var/log/kompira/</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a Windows environment, log files are created under the directory <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Log</span></code> by default.</p>
</div>
<p>For each log file created, the standard log rotation settings and the contents to be recorded are as follows.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Log file</p></th>
<th class="head"><p>Log rotation settings</p></th>
<th class="head"><p>Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>kompira.log</p></td>
<td><p>fixed (daily rotate 7)</p></td>
<td><p>Request related log output (output by httpd)</p></td>
</tr>
<tr class="row-odd"><td><p>kompirad.log</p></td>
<td><p>fixed (daily rotate 7)</p></td>
<td><p>Kompira daemon log output</p></td>
</tr>
<tr class="row-even"><td><p>process.log</p></td>
<td><p>fixed (daily rotate unlimited)</p></td>
<td><p>Log output of Kompira job flow process</p></td>
</tr>
<tr class="row-odd"><td><p>kompira_jobmngrd.log</p></td>
<td><p>kompira.conf (daily rotate 7)</p></td>
<td><p>Kompira Job Manager log output</p></td>
</tr>
<tr class="row-even"><td><p>kompira_sendevt.log</p></td>
<td><p>kompira.conf (1GB rotate 10)</p></td>
<td><p>Log output of Send-Event command</p></td>
</tr>
<tr class="row-odd"><td><p>audit-*.log</p></td>
<td><p>logrotate (daily rotate 365)</p></td>
<td><p>Audit log output for various operations</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>The log files are automatically rotated, and the old log files are saved with the date added to the file name.</p></li>
<li><p>For the above log files, kompira_jobmngrd.log and kompira_sendevt.log the settings of rotation, such as interval and number of generations can be changed in /opt/kompira/kompira.conf.</p></li>
<li><p>The audit-*.log is rotated by the logrotate service, and you can change its settings in /etc/logrotate.d/kompira_audit.</p></li>
</ul>
<p>The various services that make up Kompira output their logs to the following directories. The standard log rotation settings for each service are also shown below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Service</p></th>
<th class="head"><p>Log output directory</p></th>
<th class="head"><p>Log rotation settings</p></th>
<th class="head"><p>Note</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>httpd</p></td>
<td><p>/var/log/httpd/</p></td>
<td><p>logrotate (daily rotate 30)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>postgresql</p></td>
<td><p>/var/log/postgres/</p></td>
<td><p>logrotate (daily rotate 30)</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>rabbitmq-server</p></td>
<td><p>/var/log/rabbitmq/</p></td>
<td><p>logrotate (weekly rotate 20)</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p>pacemaker (1.x)</p></td>
<td><p>/var/log/</p></td>
<td><p>logrotate (weekly rotate 99)</p></td>
<td><p>Only in cluster configuration (RHEL7 series)</p></td>
</tr>
<tr class="row-even"><td><p>pacemaker (2.x)</p></td>
<td><p>/var/log/pacemaker/</p></td>
<td><p>logrotate (weekly rotate 99)</p></td>
<td><p>Only in cluster configuration (RHEL8 series)</p></td>
</tr>
<tr class="row-odd"><td><p>corosync</p></td>
<td><p>/var/log/cluster/</p></td>
<td><p>logrotate (daily rotate 31)</p></td>
<td><p>Only in cluster configuration</p></td>
</tr>
<tr class="row-even"><td><p>pcsd</p></td>
<td><p>/var/log/pcsd/</p></td>
<td><p>logrotate (weekly rotate 5)</p></td>
<td><p>Only in cluster configuration</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.3: </span>An audit log has been added.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>In Windows environments, log files are now created by default in <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Log</span></code>.</p>
</div>
</section>
<section id="file-settings">
<span id="id35"></span><h3><span class="section-number">1.5.3. </span>Kompira configuration files<a class="headerlink" href="#file-settings" title="Permalink to this heading">¶</a></h3>
<p>The setting items in /opt/kompira/kompira.conf are as follows.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Section name</p></th>
<th class="head"><p>Item name</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>kompira</p></td>
<td><p>site_id</p></td>
<td><p>1</p></td>
<td><p>Not used in this version</p></td>
</tr>
<tr class="row-odd"><td><p>logging</p></td>
<td colspan="3"><p>Log output related settings</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>loglevel</p></td>
<td><p>INFO</p></td>
<td><p>Setting the log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>logdir</p></td>
<td><p>/var/log/kompira</p></td>
<td><p>Directory of log files</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>logbackup</p></td>
<td><div class="line-block">
<div class="line">kompirad: 7</div>
<div class="line">kompira_jobmngrd: 7</div>
<div class="line">kompira_sendevt: 10</div>
</div>
</td>
<td><p>Number of generations of log backup</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>logmaxsz</p></td>
<td><div class="line-block">
<div class="line">kompirad: 0</div>
<div class="line">kompira_jobmngrd: 0</div>
<div class="line">kompira_sendevt: 1024*1024*1024</div>
</div>
</td>
<td><div class="line-block">
<div class="line">Maximum log file size (in bytes)</div>
<div class="line">Set to 0 to rotate daily</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>amqp-connection</p></td>
<td colspan="3"><p>RabbitMQ connection information related settings</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>server</p></td>
<td><p>localhost</p></td>
<td><p>Connection host name</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>port</p></td>
<td><p>(5671 or 5672)</p></td>
<td><p>Connection port number</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>user</p></td>
<td><p>(guest or kompira)</p></td>
<td><p>Connection user name</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>password</p></td>
<td><p>(guest or kompira)</p></td>
<td><p>Connection password</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>ssl</p></td>
<td><p>(true or false)</p></td>
<td><p>Enabling to connect with SSL or not</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>ssl_verify</p></td>
<td><p>false</p></td>
<td><p>Whether to validate server certificates with SSL</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>ssl_cacertfile</p></td>
<td></td>
<td><p>CA certificate file for validating server certificates during SSL connection</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>ssl_certfile</p></td>
<td></td>
<td><p>Certificate file for SSL connection</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>ssl_keyfile</p></td>
<td></td>
<td><p>Private key file for SSL connection</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>heartbeat_interval</p></td>
<td><p>10</p></td>
<td><p>Heartbeat interval (in seconds)</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>max_retry</p></td>
<td><p>3</p></td>
<td><p>Maximum number of attempts to reconnect at disconnection</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>retry_interval</p></td>
<td><p>30</p></td>
<td><p>Interval (in seconds) to reconnect at disconnection</p></td>
</tr>
<tr class="row-odd"><td><p>agent</p></td>
<td colspan="3"><p>Settings related to job manager operation</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>name</p></td>
<td><p>default</p></td>
<td><p>Name of job manager</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>pool_size</p></td>
<td><p>8</p></td>
<td><p>Number of concurrent process workers (1..80)</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>disable_cache</p></td>
<td><p>false</p></td>
<td><p>Disable remote connection cache</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>cache_duration</p></td>
<td><p>300</p></td>
<td><p>Remote connection cache expiration date (in seconds)</p></td>
</tr>
<tr class="row-even"><td><p>event</p></td>
<td colspan="3"><p>Settings of Send-Event</p></td>
</tr>
<tr class="row-odd"><td></td>
<td><p>channel</p></td>
<td><p>/system/channels/Alert</p></td>
<td><p>Path on Kompira for event transmission channel</p></td>
</tr>
</tbody>
</table>
<p>Note that in a Windows environment, the default value changes as follows.</p>
<ul class="simple">
<li><p>logdir: <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Log</span></code></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The remote connection cache is a function that speeds up the processing of successive remote command execution on the same node and  under the same account by reusing the remote connection during remote command execution.</p>
<p>However, the remote connection cache will not be used for WinRS connections regardless of the disable_cache setting, because the speedup effect is not available.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>The default value of logdir has been changed to <code class="docutils literal notranslate"><span class="pre">C:\Kompira\Log</span></code> under Windows.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>The default value for user is now guest or kompira. If localhost or 127.0.0.1 is specified as the hostname to connect to, the value is guest; otherwise, the value is kompira.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>When password is not specified, the default value is now the same string as user.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>The default value of ssl has been changed to true or false. When ssl is not specified, it is false if server is localhost, otherwise it is true.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>The default value of port has been changed to 5671 or 5672. If port is not specified, 5671 if ssl is true, 5672 if false.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.8: </span>New configuration items ssl_verify, ssl_cacertfile, ssl_certfile, and ssl_keyfile have been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.9.post4: </span>The pool_size is now limited from 1 to 80.</p>
</div>
</section>
<section id="id36">
<h3><span class="section-number">1.5.4. </span>Kompira image files<a class="headerlink" href="#id36" title="Permalink to this heading">¶</a></h3>
<p>The images displayed in the browser window are located on the Kompira server at the following locations.</p>
<ul class="simple">
<li><p>/var/opt/kompira/html/kompira/img/</p></li>
</ul>
<p>The image files located here are as follows. You can change the appearance of the screen by directly replacing the image files.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>File name</p></th>
<th class="head"><p>Purpose</p></th>
<th class="head"><p>Size</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>favicon.svg</p></td>
<td><p>Favicon (SVG)</p></td>
<td><p>16x16</p></td>
<td><p>This icon is used for browser tabs and favorite icons when registered.</p></td>
</tr>
<tr class="row-odd"><td><p>favicon.ico</p></td>
<td><p>Favicon (ICO)</p></td>
<td><p>16x16</p></td>
<td><p>Same as above (for use with browsers that do not support SVG format)</p></td>
</tr>
<tr class="row-even"><td><p>brand-logo.svg</p></td>
<td><p>Brand logo image</p></td>
<td><p>40x40</p></td>
<td><p>The logo image will be displayed in the upper left corner of the menu bar.</p></td>
</tr>
<tr class="row-odd"><td><p>login-logo.svg</p></td>
<td><p>Log-in logo image</p></td>
<td><p>128x128</p></td>
<td><p>The logo is displayed in the center of the login and logout screens.</p></td>
</tr>
<tr class="row-even"><td><p>console-loading.gif</p></td>
<td><p>Console loading image</p></td>
<td><p>20x20</p></td>
<td><p>Shown in the console while the process is active on the process details screen.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Size is shown as the number of pixels for reference when displayed on a typical resolution display.</p>
</div>
</section>
</section>
<section id="data">
<span id="id37"></span><h2><span class="section-number">1.6. </span>Data backup of Kompira<a class="headerlink" href="#data" title="Permalink to this heading">¶</a></h2>
<p>How to back up and restore data stored on Kompira.</p>
<p>The definitions of job flow and device information created on Kompira will be stored in the database. These data sets can be exported and imported as a file in json format.</p>
<section id="data-export">
<span id="id38"></span><h3><span class="section-number">1.6.1. </span>Export of Kompira objects<a class="headerlink" href="#data-export" title="Permalink to this heading">¶</a></h3>
<p>By executing the export_data command with the following format, specified data of Kompira file system will be dumped in json format.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py export_data [options] &lt;path&gt;...
</pre></div>
</div>
<p>For example, to export all data under /home/guest created by Kompira to a file, execute the following command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py export_data /home/guest &gt; guest.json
</pre></div>
</div>
<p>Alternatively, by executing the export_dir command, you can dump the data below the path of the Kompira file system specified by the argument as a YAML file on a per-object basis.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py export_dir [options] &lt;path&gt;...
</pre></div>
</div>
<p>Note that for objects of the following types, only the data in the fields they represent will be output as a file, and the remaining fields will be output as .&lt;object name&gt; with property information.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Type name</p></th>
<th class="head"><p>Representative field</p></th>
<th class="head"><p>File format</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Jobflow</p></td>
<td><p>source</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-odd"><td><p>ScriptJob</p></td>
<td><p>source</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-even"><td><p>Library</p></td>
<td><p>sourceText</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-odd"><td><p>Template</p></td>
<td><p>template</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-even"><td><p>Text</p></td>
<td><p>text</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-odd"><td><p>Wiki</p></td>
<td><p>wikitext</p></td>
<td><p>text</p></td>
</tr>
<tr class="row-even"><td><p>Environment</p></td>
<td><p>environment</p></td>
<td><p>YAML</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The export_dir command has been changed to output the data in the attachment field as a separate file.</p>
</div>
</section>
<section id="data-import">
<span id="id39"></span><h3><span class="section-number">1.6.2. </span>Import of Kompira objects<a class="headerlink" href="#data-import" title="Permalink to this heading">¶</a></h3>
<p>You can import data with the exported file using the import_data command. The format of the import_data command is as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py import_data [options] &lt;filename&gt;...
</pre></div>
</div>
<p>For example, to import the file guest.json exporting the /home/guest directory, execute the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py import_data guest.json
[2014-07-25 12:34:49,576] INFO: import data: start...
[2014-07-25 12:34:49,676] INFO: home/guest: import is skipped: &quot;/home/guest&quot; already exists.
[2014-07-25 12:34:49,710] INFO: home/guest/a: import is skipped: &quot;/home/guest/a&quot; already exists.
[2014-07-25 12:34:49,743] INFO: home/guest/b: import is skipped: &quot;/home/guest/b&quot; already exists.
[2014-07-25 12:34:49,743] INFO: import data: finished (created=0, updated=0, skipped=3, error=0)
</pre></div>
</div>
<p>If the imported json file contains an object of a path that already exists, the import of that object will be skipped. In the above case, all three files to be imported were skipped.</p>
<p>You can overwrite by using the overwrite-mode option.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py import_data --overwrite-mode guest.json
[2014-07-25 12:39:15,685] INFO: import data: start...
[2014-07-25 12:39:15,821] INFO: import object: imported &quot;home/guest&quot; to &quot;/home/guest&quot; (updated)
[2014-07-25 12:39:15,904] INFO: import object: imported &quot;home/guest/a&quot; to &quot;/home/guest/a&quot; (updated)
[2014-07-25 12:39:15,971] INFO: import object: imported &quot;home/guest/b&quot; to &quot;/home/guest/b&quot; (updated)
[2014-07-25 12:39:15,991] INFO: import fields: /home/guest: []
[2014-07-25 12:39:16,015] INFO: import fields: /home/guest/a: [&#39;wikitext&#39;]
[2014-07-25 12:39:16,046] INFO: import fields: /home/guest/b: [&#39;wikitext&#39;]
[2014-07-25 12:39:16,046] INFO: import data: finished (created=0, updated=3, skipped=0, error=0)
</pre></div>
</div>
<p>Files dumped with the export_dir command can be imported using the import_dir command.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py import_dir [options] &lt;dirname&gt;...
</pre></div>
</div>
</section>
<section id="data-backup">
<span id="id40"></span><h3><span class="section-number">1.6.3. </span>Backup<a class="headerlink" href="#data-backup" title="Permalink to this heading">¶</a></h3>
<p>The Kompira backup procedure.</p>
<p>Kompira will use data from the paths listed in <a class="reference internal" href="#file-hierarchy"><span class="std std-ref">Kompira standard directories.</span></a> on the server, in addition to those in the database. When backing up Kompira data, in addition to backing up the Kompira objects with the export_data command, you should also back up the files on the server if necessary.</p>
<p>This is an example of backing up the Kompira object and license files.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ mkdir -p /tmp/kompira_backup
$ cd /tmp/kompira_backup
$ /opt/kompira/bin/manage.py export_data / --virtual-mode &gt; backup.json
$ cp /var/opt/kompira/kompira.lic ./
$ cd /tmp
$ tar zcf kompira_backup.tar.gz ./kompira_backup
</pre></div>
</div>
</section>
<section id="export-data">
<span id="data-export-data-option"></span><h3><span class="section-number">1.6.4. </span>export_data options<a class="headerlink" href="#export-data" title="Permalink to this heading">¶</a></h3>
<p>The export_data command has the following options:</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--directory=DIRECTORY</span></code></p></td>
<td><p>Specify the directory as the starting point of the exported path. (Default is ‘/’)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--virtual-mode</span></code></p></td>
<td><p>This also outputs data contained in the virtual file system.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--owner-mode</span></code></p></td>
<td><p>This also outputs the exported user object owned by that user and the group object belonging to that user.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--zip-mode</span></code></p></td>
<td><p>Output in ZIP format.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--without-attachments</span></code></p></td>
<td><p>Do not output attachment data.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code></p></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The –zip-mode and –without-attachments options have been added.</p>
</div>
</section>
<section id="export-dir">
<span id="data-export-dir-option"></span><h3><span class="section-number">1.6.5. </span>export_dir options<a class="headerlink" href="#export-dir" title="Permalink to this heading">¶</a></h3>
<p>The export_dir command has the following options:</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--directory=DIRECTORY</span></code></p></td>
<td><p>Specify the directory as the starting point of the exported path. (Default is ‘/’)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--property-mode</span></code></p></td>
<td><p>Attributes such as ‘display_name’ are also output.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--datetime-mode</span></code></p></td>
<td><p>The ‘created’ and ‘updated’ are also output.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--current=CURRENT_DIR</span></code></p></td>
<td><p>Specify the output directory.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--without-attachments</span></code></p></td>
<td><p>Do not output attachment data.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--inline-attachments</span></code></p></td>
<td><p>Include attachment data in the YAML file and output it.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--linesep=LINESEP</span></code></p></td>
<td><p>Change the newline codes when exporting model data. <code class="docutils literal notranslate"><span class="pre">LINESEP</span></code> can be any of <code class="docutils literal notranslate"><span class="pre">os_linesep</span></code>, <code class="docutils literal notranslate"><span class="pre">lf</span></code>, <code class="docutils literal notranslate"><span class="pre">crlf</span></code> or <code class="docutils literal notranslate"><span class="pre">no_change</span></code>. <code class="docutils literal notranslate"><span class="pre">os_linesep</span></code> changes the newline codes based on the OS standard. <code class="docutils literal notranslate"><span class="pre">lf</span></code> changes to <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">crlf</span></code> changes to <code class="docutils literal notranslate"><span class="pre">\r\n</span></code>, and <code class="docutils literal notranslate"><span class="pre">no_change</span></code> preserves originial newline codes. Default is <code class="docutils literal notranslate"><span class="pre">os_linesep</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code></p></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The –without-attachments and –inline-attachments options have been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.9: </span>The –linesep option has been added.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">--linesep</span></code> only affects <a class="reference internal" href="#data-export"><span class="std std-ref">text-format</span></a> files.</p>
</div>
</section>
<section id="import-data">
<span id="data-import-data-option"></span><h3><span class="section-number">1.6.6. </span>import_data options<a class="headerlink" href="#import-data" title="Permalink to this heading">¶</a></h3>
<p>The import_data command has the following options:</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--user=USER</span></code></p></td>
<td><p>Set the owner of the data to be imported to USER (specify user ID).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--directory=ORIGIN-DIR</span></code></p></td>
<td><p>Specify the directory as the starting point of the import destination. (Default is ‘/’)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--overwrite-mode</span></code></p></td>
<td><p>Overwrite existing objects if any.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--owner-mode</span></code></p></td>
<td><p>Set the owner of the data to be imported to the export owner.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--update-config-mode</span></code></p></td>
<td><p>Also overwrites the configuration data of Config type objects. (The –overwrite-mode option must also be specified at the same time.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--now-updated-mode</span></code></p></td>
<td><p>Sets the current time as the ‘updated’ of the object.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code></p></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The –update-config-mode option has been added.</p>
</div>
</section>
<section id="import-dir">
<span id="data-import-dir-option"></span><h3><span class="section-number">1.6.7. </span>import_dir options<a class="headerlink" href="#import-dir" title="Permalink to this heading">¶</a></h3>
<p>The import_dir command has the following options:</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--user=USER</span></code></p></td>
<td><p>Set the owner of the data to be imported to USER (specify user ID).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--directory=ORIGIN-DIR</span></code></p></td>
<td><p>Specify the directory as the starting point of the import destination. (Default is ‘/’)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--overwrite-mode</span></code></p></td>
<td><p>Overwrite existing objects if any.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--owner-mode</span></code></p></td>
<td><p>Set the owner of the data to be imported to the export owner.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--update-config-mode</span></code></p></td>
<td><p>Also overwrites the configuration data of Config type objects. (The –overwrite-mode option must also be specified at the same time.)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--now-updated-mode</span></code></p></td>
<td><p>Sets the current time as the ‘updated’ of the object.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--linesep=LINESEP</span></code></p></td>
<td><p>Change the newline codes when importing model data. <code class="docutils literal notranslate"><span class="pre">LINESEP</span></code> can be any of <code class="docutils literal notranslate"><span class="pre">os_linesep</span></code>, <code class="docutils literal notranslate"><span class="pre">lf</span></code>, <code class="docutils literal notranslate"><span class="pre">crlf</span></code> or <code class="docutils literal notranslate"><span class="pre">no_change</span></code>. <code class="docutils literal notranslate"><span class="pre">os_linesep</span></code> changes the newline codes based on the OS standard. <code class="docutils literal notranslate"><span class="pre">lf</span></code> changes to <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">crlf</span></code> changes to <code class="docutils literal notranslate"><span class="pre">\r\n</span></code>, and <code class="docutils literal notranslate"><span class="pre">no_change</span></code> preserves originial newline codes. Default is <code class="docutils literal notranslate"><span class="pre">crlf</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-h,</span> <span class="pre">--help</span></code></p></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.7: </span>The –update-config-mode option has been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.9: </span>The –linesep option has been added.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">--linesep</span></code> only affects <a class="reference internal" href="#data-export"><span class="std std-ref">text-format</span></a> files.</p>
</div>
</section>
</section>
<section id="license">
<span id="id41"></span><h2><span class="section-number">1.7. </span>Kompira License<a class="headerlink" href="#license" title="Permalink to this heading">¶</a></h2>
<p>You can check the license status of Kompira using the license_info command. The format of the license_info command is as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py license_info
</pre></div>
</div>
<p>The following is an example of when a license is registered.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py license_info
*** Kompira License Information ***
License ID:     KP-REGLM0-0000000001
Edition:        REGL
Hardware ID:    NODE:000C29FB949E
Expire date:    2015-12-31
The number of registered nodes: 0 / 100
The number of registered jobflows:      2 / 100
The number of registered scripts:       0 / 100
Licensee:       fixpoint,inc.
Signature:      dwyWvG9eKbnGxcpWfVr1H0wSybLkGL7UqB2E6d5f0jYapfTx/AABJ66W3sRpK0byk+9Y724
                NuEZ9Rh90ySU8f2GRsIyujuVrgPloajokbdZrPFIqOlyvLkak8MAWcGJxiioPHPNd2Tv2BN
                Osq6bs5ZfJlCReEJhYyyngnXjeLBM=
</pre></div>
</div>
<p>If the license is not registered, the temporary license information will be printed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py license_info
*** Kompira License Information ***
License ID:     KP-TEMP-0000000000
Edition:        temporary
Hardware ID:    NODE:000C29FB949E
Expire date:    2015-01-22
The number of registered nodes: 0 / 100
The number of registered jobflows:      2 / 100
The number of registered scripts:       0 / 100
Licensee:
Signature:      None

Kompira is running with temporary license.
</pre></div>
</div>
<p>The license file path is /var/opt/kompira/kompira.lic.</p>
<p>You can place or update the license file in the above path using the license_update command.</p>
<p>The format of the license_update command is as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/bin/manage.py license_update &lt;LICENSE_FILE&gt;
</pre></div>
</div>
<p>The license_update command has the following options:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--no-backup</span></code></p></td>
<td><p>Does not make a backup of the license file.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--force</span></code></p></td>
<td><p>Force renewal if the license file validation fails.</p></td>
</tr>
</tbody>
</table>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.2: </span>license_update command</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="usage.html#settings-license"><span class="std std-ref">License Management</span></a>: You can also check and register licenses from the browser.</p>
</div>
</section>
<section id="misc">
<span id="id42"></span><h2><span class="section-number">1.8. </span>Private key management<a class="headerlink" href="#misc" title="Permalink to this heading">¶</a></h2>
<section id="misc-keychange">
<span id="id43"></span><h3><span class="section-number">1.8.1. </span>changing the private key<a class="headerlink" href="#misc-keychange" title="Permalink to this heading">¶</a></h3>
<p>To change the private key used to encrypt the password field, run the command change_secretkey with root privileges. By running the command, all password data stored encrypted in the database will be re-encrypted and stored again with the new private key.</p>
<p>The change_secretkey command is of the following format</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/manage.py change_secretkey [options] &lt;new_secretkey&gt;
</pre></div>
</div>
<p>The options are as follows</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--no-backup</span></code></p></td>
<td><p>Does not back up the keys before the change.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--force</span></code></p></td>
<td><p>Continue with re-encryption even if there is password data that failed to be re-encrypted along the way.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The secret key string is stored in /var/opt/kompira/.secret_key.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Restart the httpd and kompirad services after running change_secretkey. In a redundant configuration, execute change_secretkey on the active side before switching to the standby side.</p>
</div>
</section>
</section>
<section id="ha">
<span id="id44"></span><h2><span class="section-number">1.9. </span>High Availability (HA) Management<a class="headerlink" href="#ha" title="Permalink to this heading">¶</a></h2>
<p>Kompira can be operated on two servers with active-standby redundant configuration using Pacemaker / corosync. The following is an explanation of its installation, state check, failover, etc.</p>
<section id="ha-introduction">
<span id="id45"></span><h3><span class="section-number">1.9.1. </span>Introduction<a class="headerlink" href="#ha-introduction" title="Permalink to this heading">¶</a></h3>
<p>Pacemaker monitors the resources (applications) necessary for Kompira and failover when an error is detected for the redundancy.</p>
<p>The list of resources Pacemaker monitors is as follows.</p>
<dl class="simple">
<dt><strong>httpd, kompirad, kompira_jobmngrd</strong></dt><dd><p>This is a necessary process for Kompira and can only run on an active server.</p>
</dd>
<dt><strong>RabbitMQ</strong></dt><dd><p>RabbitMQ is also a necessary process for Kompira. A process on the active server is a ‘Master’, and a process on the standby server is a ‘Slave’.</p>
</dd>
<dt><strong>IPaddr2</strong></dt><dd><p>A resource for managing virtual IP addresses.</p>
</dd>
<dt><strong>PostgreSQL</strong></dt><dd><p>This is a PostgreSQL database process. A process on the active server is Master, and a process on the standby server is Slave. PostgreSQL replication is configured so  the data on the primary server and the data on the secondary server are synchronized.</p>
</dd>
</dl>
</section>
<section id="ha-install">
<span id="id46"></span><h3><span class="section-number">1.9.2. </span>Installation<a class="headerlink" href="#ha-install" title="Permalink to this heading">¶</a></h3>
<p>When building a redundant configuration of Kompira, after installing Kompira on each of the two servers, set up the redundant configuration on the primary server and then the secondary server.</p>
<p>Two servers require two network interfaces. Depending on the OS version, the network interface name may be eth0, eth1, …, or ens192, ens224, ….</p>
<p>From the following, we call the primary server (ha-kompira1), and the secondary server (ha-kompira2), and each server has network interfaces eth0, snd eth1. eth0 is connected to the service provisioning network and eth1 is used for heartbeat so that two servers are connected by an independent network.</p>
<p>When the redundant configuration is established, the primary server is in the active state and the secondary server is in the standby state.</p>
<p>To build a redundant configuration of Kompira, use setup_cluster.sh included in the package. In the following, the procedure for installing redundant Kompira on 2 servers after OS installation is explained.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>setup_cluster.sh downloads various middleware from the outside like install.sh. Please run it while you have an Internet connection available.</p>
</div>
<section id="ha-install-primary">
<span id="id47"></span><h4><span class="section-number">1.9.2.1. </span>Setting of the primary server<a class="headerlink" href="#ha-install-primary" title="Permalink to this heading">¶</a></h4>
<p>After installing the Kompira package, set up the primary server by running setup_cluster.sh with the <code class="docutils literal notranslate"><span class="pre">--primary</span></code> option.</p>
<p>When executing setup_cluster.sh, specify the following information as  an argument.</p>
<ul class="simple">
<li><p>Heartbeat network device name</p></li>
<li><p>The virtual IP address (VIP) assigned to the cluster and its subnet mask prefix size</p></li>
</ul>
<p>For example, to specify eth1 as the heartbeat network device, 192.168.0.100 as the virtual IP address and 24 as the subnet mask prefix size, execute the following commands.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh
# ./setup_cluster.sh --primary --heartbeat-device eth1 192.168.0.100/24
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, each node in the redundant configuration needs to be able to resolve names, so it registers aliases such as ha-kompira1 (primary machine) and ha-kompira2 (secondary machine) in <code class="docutils literal notranslate"><span class="pre">/etc/hosts</span></code>. setup_cluster.sh does not change the hostname of the server.</p>
</div>
</section>
<section id="ha-install-secondary">
<span id="id48"></span><h4><span class="section-number">1.9.2.2. </span>Setting of the secondary server<a class="headerlink" href="#ha-install-secondary" title="Permalink to this heading">¶</a></h4>
<p>After installing the Kompira package, set up the secondary server by executing setup_cluster.sh with the <code class="docutils literal notranslate"><span class="pre">--secondary</span></code> option.</p>
<p>When executing setup_cluster.sh, specify the following information as an argument. It is not necessary to specify a virtual IP address.</p>
<ul class="simple">
<li><p>Heartbeat network device name</p></li>
</ul>
<p>Heartbeat network device name</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh
# ./setup_cluster.sh --secondary --heartbeat-device eth1
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For example, to specify eth1 as the heartbeat network device, execute the following commands.</p>
</div>
</section>
<section id="ha-install-check">
<span id="id49"></span><h4><span class="section-number">1.9.2.3. </span>Status check<a class="headerlink" href="#ha-install-check" title="Permalink to this heading">¶</a></h4>
<p>When the installation of the primary server and the secondary server are completed, please access the following URL from a Web browser and confirm that the login screen is displayed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http://192.168.0.100/
</pre></div>
</div>
<p>The URL is the virtual IP address that was set when installing the primary server. This URL will be maintained even if the primary machine fails and a failover occurs.</p>
<p>Also, to check the status of each resource in the redundant configuration, use the crm_mon command on the primary server or the secondary server.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># crm_mon -A1
Cluster Summary:
  * Stack: corosync
  * Current DC: ha-kompira1 (version 2.1.0-8.el8-7c3f660707) - partition with quorum
  * Last updated: Wed Sep  8 22:21:02 2021
  * Last change:  Wed Sep  8 22:19:56 2021 by hacluster via crmd on ha-kompira1
  * 2 nodes configured
  * 9 resource instances configured

Node List:
  * Online: [ ha-kompira1 ha-kompira2 ]

Active Resources:
  * Resource Group: webserver:
    * res_memcached     (systemd:memcached):     Started ha-kompira1
    * res_kompirad      (systemd:kompirad):      Started ha-kompira1
    * res_kompira_jobmngrd      (systemd:kompira_jobmngrd):      Started ha-kompira1
    * res_httpd (ocf::heartbeat:apache):         Started ha-kompira1
    * res_vip   (ocf::heartbeat:IPaddr2):        Started ha-kompira1
  * Clone Set: res_pgsql-clone [res_pgsql] (promotable):
    * Masters: [ ha-kompira1 ]
    * Slaves: [ ha-kompira2 ]
  * Clone Set: res_rabbitmq-clone [res_rabbitmq]:
    * Started: [ ha-kompira1 ha-kompira2 ]

Node Attributes:
  * Node: ha-kompira1:
    * master-res_pgsql                  : 1001
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira1
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira1
  * Node: ha-kompira2:
    * master-res_pgsql                  : 1000
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira2
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira2
</pre></div>
</div>
<p>Here is the points to check in the output of the crm_mon command.</p>
<ul>
<li><p><strong>Resource Group</strong></p>
<blockquote>
<div><p>Only resources that are running on the active machine are printed. Everything is normal if “Started &lt;host name of active machine&gt;” is printed.</p>
</div></blockquote>
</li>
<li><p><strong>Clone Set</strong></p>
<blockquote>
<div><p>Resources running on both servers are printed. In the case of Promotable resources, it is normal if the host name of the active machine is displayed in Masters and the host name of the standby machine is displayed in Slaves.</p>
</div></blockquote>
</li>
<li><p><strong>Node Attributes</strong></p>
<blockquote>
<div><p>Detailed status of the PostgreSQL process is printed. If replication has been performed correctly, it prints in the res_pgsql-data-status line as 1001 on the active server and 1000 on the standby server.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="ha-license">
<span id="id50"></span><h4><span class="section-number">1.9.2.4. </span>License Registration<a class="headerlink" href="#ha-license" title="Permalink to this heading">¶</a></h4>
<p>In a redundant configuration, you will need to register license files for both active and standby servers.</p>
<p>Please follow the procedure in <a class="reference internal" href="#license"><span class="std std-ref">Kompira License</span></a>  and register the license file for each server.</p>
</section>
</section>
<section id="ha-update">
<span id="id51"></span><h3><span class="section-number">1.9.3. </span>Update<a class="headerlink" href="#ha-update" title="Permalink to this heading">¶</a></h3>
<p>First, here are some points to keep in mind when updating the redundant configuration.</p>
<ul class="simple">
<li><p>Before updating, please make sure that both the active and standby systems are working properly. If only one system is working properly, the update may not be possible.</p></li>
<li><p>Please make sure that there is no abnormality in each step, and that the update has not failed.</p></li>
<li><p>In any of the update procedures, jobs running on the active system will be terminated. Please note that the operation of the terminated jobs will not be resumed by starting or switching the system after the update.</p></li>
<li><p>Please note that there may be version-specific precautions regarding the update procedure. Please check the release notes beforehand.</p></li>
<li><p>The following single-system stop update procedure may not work in environments that used the old erlang / rabbitmq-server.</p></li>
<li><p>rabbitmq-server only updates minor versions +1 at a time for compatibility. You may need to update multiple times to get up to the latest version.</p></li>
<li><p>rabbitmq-server may add new features when the minor version is updated. If some features are not enabled, you may not be able to update next time. After updating, please enable all features with the <code class="docutils literal notranslate"><span class="pre">rabbitmqctl</span> <span class="pre">enable_feature_flag</span> <span class="pre">all</span></code> command.</p></li>
<li><p>Please note that the upgrade of PostgreSQL is a special procedure based on the both-system stop update procedure.</p></li>
</ul>
<p>When updating a redundant configuration, there are two main update procedures. Depending on the procedure, you can choose a method that involves switching Master/Slave or a method that does not involve switching. The following is a brief description of the procedure for your reference.</p>
<section id="id52">
<h4><span class="section-number">1.9.3.1. </span>Update procedure with both systems stopped (without failover)<a class="headerlink" href="#id52" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Stop the standby system. (pcs cluster stop)</p></li>
<li><p>Stop the active system. (pcs cluster stop –force)  (*) The running jobs will be killed here.</p></li>
<li><p>Update the active system. (./install.sh) (*) The auto-startup job will start.</p></li>
<li><p>Update the standby system. (./install.sh)</p></li>
<li><p>Enable rabbitmq-server features (rabbitmqctl enable_feature_flag all) (*) If rabbitmq-server has had a minor update.</p></li>
</ol>
<p>Instead of failover occurring, both systems will be stopped, resulting in a longer period of time when jobs are stopped.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Please note that if the –skip-cluster-start option of install.sh is specified in step 3 for updating both systems stop and in step 2 for updating one system stop, the redundant configuration settings may not be updated correctly.</p>
</div>
</section>
<section id="id53">
<h4><span class="section-number">1.9.3.2. </span>Update procedure with single systems stopped (with failover)<a class="headerlink" href="#id53" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Stop the standby system. (pcs cluster stop)</p></li>
<li><p>Update the standby system. (./install.sh)</p></li>
<li><p>Stop the active system. (pcs cluster stop)  (*) At this point, failover occurs and the updated standby system becomes active. Jobs that were running on the old active system will be terminated and auto-startup jobs will be started on the new active system.</p></li>
<li><p>Update the old active system. (./install.sh)</p></li>
<li><p>Enable rabbitmq-server features (rabbitmqctl enable_feature_flag all) (*) If rabbitmq-server has had a minor update.</p></li>
</ol>
<p>It involves failover, but one system is still running, so the period of time when jobs are stopped is shorter.</p>
<p>However, if there is a compatibility problem, such as when updating from an old erlang / rabbitmq-server, the single-system stop update cannot be performed. In this case, the following warning will be displayed at the end of install.sh, and the automatic cluster restart process will be skipped.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2023-02-03 12:00:00] WARN: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN: FULL STOP UPGRADES ARE REQUIRED! (For version compatibility)
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN:   erlang: R16B -&gt; 23.3.4.11
[2023-02-03 12:00:00] WARN:   rabbitmq-server: 3.3.5 -&gt; 3.10.0
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN:  - Automatic cluster start was skipped.
[2023-02-03 12:00:00] WARN:  - Please stop both systems and upgrade each one.
[2023-02-03 12:00:00] WARN:  - Then start the clusters in order with the following command.
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN:      # pcs cluster start
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN:  - At that time, start the cluster first on the node that was active before the upgrade.
[2023-02-03 12:00:00] WARN:
[2023-02-03 12:00:00] WARN: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre></div>
</div>
<p>In this case, please switch to the both-system stop update procedure. After the update, use the pcs cluster start command to restart the redundant configuration sequentially, starting with the active system</p>
</section>
<section id="ha-update-with-pg-upgrade">
<span id="id54"></span><h4><span class="section-number">1.9.3.3. </span>Procedure for updating with PostgreSQL upgrade with both systems stopped<a class="headerlink" href="#ha-update-with-pg-upgrade" title="Permalink to this heading">¶</a></h4>
<p>When upgrading PostgreSQL in a redundant configuration, this is a dedicated procedure based on a both-system outage update. Specify the version of PostgreSQL you wish to upgrade in steps 3 and 4 as follows.</p>
<ol class="arabic simple">
<li><p>Stop the standby system. (pcs cluster stop)</p></li>
<li><p>Stop the active system. (pcs cluster stop –force)  (*) The running jobs will be killed here.</p></li>
<li><p>Update the active system. (./install.sh –postgresql-version=17)</p></li>
<li><p>Update the standby system. (./install.sh –postgresql-version=17)</p></li>
<li><p>Restart the active system. (pcs cluster stop)</p></li>
<li><p>Restart the standby system with sync_master.sh. (/opt/kompira/bin/sync_master.sh –force)</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Be sure to specify the same major version in steps 3 and 4.</p>
</div>
<p>The following warning appears at the end of install.sh in steps 3 and 4, and the automatic cluster restart process is also skipped.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2024-10-29 12:00:00] WARN: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN: FULL STOP UPGRADES ARE REQUIRED! (For version compatibility)
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN:   postgresql: 12.17 -&gt; 17.0
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN:  - Automatic cluster start was skipped.
[2024-10-29 12:00:00] WARN:  - Please stop both systems and upgrade each one.
[2024-10-29 12:00:00] WARN:  - First, start the cluster with the following command on the node that was active before the upgrade.
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN:      # pcs cluster start
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN:  - Next, start the cluster with the following command on the node that was standby before the upgrade.
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN:      # /opt/kompira/bin/sync_master.sh --force
[2024-10-29 12:00:00] WARN:
[2024-10-29 12:00:00] WARN: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre></div>
</div>
<p>After this, in step 5, restart the active system with pcs cluster start as in the basic procedure. At this time, confirm that all resources in the active system are started normally by using pcs status or crm_mon command, for example.</p>
<p>Finally, restart the standby system with sync_master.sh as step 6. At this time, add the <code class="docutils literal notranslate"><span class="pre">--force</span></code> option to force the active system to synchronize its data.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.6: </span>pcs cluster start is now automatically executed after install.sh is run in redundant configuration. The update procedure for redundant configurations has been changed accordingly.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8: </span>If the single-system stop update cannot be performed, a warning will be displayed and pcs cluster start will be skipped.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.8.post2: </span>In a redundant configuration, rabbitmq-server will now only go up by +1 minor version.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.8.post2: </span>A procedure to enable rabbitmq-server features has been added.</p>
</div>
<div class="versionadded">
<p><span class="versionmodified added">New in version 1.6.10: </span>Add the procedure for updating with PostgreSQL upgrade with both systems stopped.</p>
</div>
</section>
</section>
<section id="ha-stop-start">
<span id="id55"></span><h3><span class="section-number">1.9.4. </span>HA stop and start<a class="headerlink" href="#ha-stop-start" title="Permalink to this heading">¶</a></h3>
<p>How to stop and start Kompira operating in a HA:</p>
<p>First of all, use the crm_mon command to see which of the two servers is acting as active. In the resource part of the crm_mon command result the active server shows, “Started” and “Masters”.</p>
<p>The following explanation assumes that ha-kompira1 is in the active state.</p>
<p>In principle, to stop servers, stop the standby server first and then stop the active server, to start servers, start the active server first and then start the standby server second.</p>
<p>This is because if the active server is stopped first, the standby server judges that an error has occurred in the active server and a failover process will be performed. If it fails over by mistake , refer to <a class="reference internal" href="#ha-recovery"><span class="std std-ref">Failover and fail back behavior</span></a>.</p>
<section id="id56">
<h4><span class="section-number">1.9.4.1. </span>Stop HA configurtion<a class="headerlink" href="#id56" title="Permalink to this heading">¶</a></h4>
<p>First, stop the Pacemaker process on the secondary server (ha-kompira2).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># pcs cluster stop
Stopping Cluster (pacemaker)...
Stopping Cluster (corosync)...
</pre></div>
</div>
<p>After confirming that the service has stopped, do the same thing on the primary server (ha-kompira1). The <code class="docutils literal notranslate"><span class="pre">--force</span></code> option is required to stop the last one of the  HA configuration.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># pcs cluster stop --force
Stopping Cluster (pacemaker)...
Stopping Cluster (corosync)...
</pre></div>
</div>
<p>This stops monitoring resources by Pacemaker/corosync. Please note that the crm_mon command can not be executed when the pacemaker process is stopped.</p>
<p>To not only stop the process but to also shut down the server OS, the above process is not needed. However, please shut down the standby server first and then the active server.</p>
</section>
<section id="id57">
<h4><span class="section-number">1.9.4.2. </span>Start HA configuration<a class="headerlink" href="#id57" title="Permalink to this heading">¶</a></h4>
<p>To start up, follow the procedure opposite to stop. First, start the Pacemaker process on the primary server (ha-kompira1).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># pcs cluster start
Starting Cluster...
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a Pacemaker (1.x) environment such as RHEL7, the following message will be displayed when executing pcs cluster start.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># pcs cluster start
Starting Cluster (corosync)...
Starting Cluster (pacemaker)...
</pre></div>
</div>
</div>
<p>When the pacemaker process started up, the resources registered in pacemaker will start sequentially. Execute the crm_mon command and wait until all resources are started.</p>
<p>When the resources were started, start the Pacemaker process on the secondary server (ha-kompira2).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># pcs cluster start
Starting Cluster...
</pre></div>
</div>
<p>This completes start up of the HA configuration.</p>
<p>When you boot server OS not only starting processes, the above processing is not needed. The Pacemaker service is set to auto start up.</p>
<p>Please start the active server first and after confirming startup is completed, then start the standby server.</p>
</section>
</section>
<section id="ha-recovery">
<span id="id58"></span><h3><span class="section-number">1.9.5. </span>Failover and fail back behavior<a class="headerlink" href="#ha-recovery" title="Permalink to this heading">¶</a></h3>
<p>If any failure occurs on the active server, the failover will be automatically performed and the standby server will be promoted to the active status.</p>
<p>Below is the crm_mon command result on ha-kompira2 after shutting down of ha-kompira1 which was in the active state.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># crm_mon -A1
Cluster Summary:
  * Stack: corosync
  * Current DC: ha-kompira2 (version 2.1.0-8.el8-7c3f660707) - partition with quorum
  * Last updated: Wed Sep  8 22:27:37 2021
  * Last change:  Wed Sep  8 22:27:09 2021 by root via crm_attribute on ha-kompira2
  * 2 nodes configured
  * 9 resource instances configured

Node List:
  * Online: [ ha-kompira2 ]
  * OFFLINE: [ ha-kompira1 ]

Active Resources:
  * Resource Group: webserver:
    * res_memcached     (systemd:memcached):     Started ha-kompira2
    * res_kompirad      (systemd:kompirad):      Started ha-kompira2
    * res_kompira_jobmngrd      (systemd:kompira_jobmngrd):      Started ha-kompira2
    * res_httpd (ocf::heartbeat:apache):         Started ha-kompira2
    * res_vip   (ocf::heartbeat:IPaddr2):        Started ha-kompira2
  * Clone Set: res_pgsql-clone [res_pgsql] (promotable):
    * Masters: [ ha-kompira2 ]
  * Clone Set: res_rabbitmq-clone [res_rabbitmq]:
    * Started: [ ha-kompira2 ]

Node Attributes:
  * Node: ha-kompira2:
    * master-res_pgsql                  : 1001
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira2
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira2
</pre></div>
</div>
<p>You can see ha-kompira1 is OFFLINE, and each of the resources are running on ha-kompira2.</p>
<p>In the following, the procedures when ha-kompira1 is recoverable, and unrecoverable separately will be explained.</p>
<section id="id59">
<h4><span class="section-number">1.9.5.1. </span>When the server is recoverable<a class="headerlink" href="#id59" title="Permalink to this heading">¶</a></h4>
<p>Here is the procedure when the ha-kompira1 can be started normally.</p>
<p>When you have started ha-kompira1, the status will be as follows</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># crm_mon -A1
Cluster Summary:
  * Stack: corosync
  * Current DC: ha-kompira2 (version 2.1.0-8.el8-7c3f660707) - partition with quorum
  * Last updated: Wed Sep  8 22:35:16 2021
  * Last change:  Wed Sep  8 22:34:57 2021 by root via crm_attribute on ha-kompira2
  * 2 nodes configured
  * 9 resource instances configured

Node List:
  * Online: [ ha-kompira1 ha-kompira2 ]

Active Resources:
  * Resource Group: webserver:
    * res_memcached     (systemd:memcached):     Started ha-kompira2
    * res_kompirad      (systemd:kompirad):      Started ha-kompira2
    * res_kompira_jobmngrd      (systemd:kompira_jobmngrd):      Started ha-kompira2
    * res_httpd (ocf::heartbeat:apache):         Started ha-kompira2
    * res_vip   (ocf::heartbeat:IPaddr2):        Started ha-kompira2
  * Clone Set: res_pgsql-clone [res_pgsql] (promotable):
    * Masters: [ ha-kompira2 ]
    * Slaves: [ ha-kompira1 ]
  * Clone Set: res_rabbitmq-clone [res_rabbitmq]:
    * Started: [ ha-kompira1 ha-kompira2 ]

Node Attributes:
  * Node: ha-kompira1:
    * master-res_pgsql                  : -1
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira1
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira1
  * Node: ha-kompira2:
    * master-res_pgsql                  : 1001
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira2
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira2
</pre></div>
</div>
<p>In ha-kompira1, the database is not synchronized correctly and it is not in a normal state as a standby server.</p>
<p>In order to complete the setup as a standby server, use sync_master.sh in the kompira package on the standby server. sync_master.sh will copy the database of the active server to the standby server, sets up replication, and starts the database process.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/sync_master.sh
[2023-08-03 18:19:46] ****: ****************************************************************
[2023-08-03 18:19:46] ****: Kompira-1.6.8.post3:
[2023-08-03 18:19:46] ****: Start: Sync with the Master
...
[2023-08-03 18:19:49] INFO: Waiting for the resources to stabilize.
[2023-08-03 18:19:49] INFO: nodes[2]: ha-kompira1 ha-kompira2 (local=ha-kompira1)
[2023-08-03 18:19:49] INFO: webserver resources[5]: res_memcached res_kompirad res_kompira_jobmngrd res_httpd res_vip
---------------------------------+------------------------------------------------------------+------------------------------------------------------
    postgres[0],     postgres[1] |                  rabbitmq[0],                  rabbitmq[1] | memcached,  kompirad,  jobmngrd,     httpd,       vip
---------------------------------+------------------------------------------------------------+------------------------------------------------------
    Slave(1000),    Master(1001) |                           (),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                   Starting(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |                    Started(),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
    Slave(1000),    Master(1001) |  Started(rabbit@ha-kompira1),  Started(rabbit@ha-kompira2) |   Started,   Started,   Started,   Started,   Started
---------------------------------+------------------------------------------------------------+------------------------------------------------------
...
[2023-08-03 18:19:51] INFO: Display state of resources.
  * Resource Group: webserver:
    * res_memcached     (systemd:memcached):     Started ha-kompira2
    * res_kompirad      (systemd:kompirad):      Started ha-kompira2
    * res_kompira_jobmngrd      (systemd:kompira_jobmngrd):      Started ha-kompira2
    * res_httpd (ocf::heartbeat:apache):         Started ha-kompira2
    * res_vip   (ocf::heartbeat:IPaddr2):        Started ha-kompira2
  * Clone Set: res_pgsql-clone [res_pgsql] (promotable):
    * Masters: [ ha-kompira2 ]
    * Slaves: [ ha-kompira1 ]
  * Clone Set: res_rabbitmq-clone [res_rabbitmq]:
    * Started: [ ha-kompira1 ha-kompira2 ]
[2023-08-03 18:19:51] ****:
[2023-08-03 18:19:51] ****: Finish: Sync with the Master (status=0)
[2023-08-03 18:19:51] ****: ****************************************************************
</pre></div>
</div>
<p>After executing sync_master.sh, if you call the crm_mon command, you can confirm that state of res_pgsql-data-status of ha-kompira1 has become 1000.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># crm_mon -A1
Cluster Summary:
  * Stack: corosync
  * Current DC: ha-kompira2 (version 2.1.0-8.el8-7c3f660707) - partition with quorum
  * Last updated: Thu Sep  9 00:35:55 2021
  * Last change:  Thu Sep  9 00:30:55 2021 by root via crm_attribute on ha-kompira2
  * 2 nodes configured
  * 9 resource instances configured

Node List:
  * Online: [ ha-kompira1 ha-kompira2 ]

Active Resources:
  * Resource Group: webserver:
    * res_memcached     (systemd:memcached):     Started ha-kompira2
    * res_kompirad      (systemd:kompirad):      Started ha-kompira2
    * res_kompira_jobmngrd      (systemd:kompira_jobmngrd):      Started ha-kompira2
    * res_httpd (ocf::heartbeat:apache):         Started ha-kompira2
    * res_vip   (ocf::heartbeat:IPaddr2):        Started ha-kompira2
  * Clone Set: res_pgsql-clone [res_pgsql] (promotable):
    * Masters: [ ha-kompira2 ]
    * Slaves: [ ha-kompira1 ]
  * Clone Set: res_rabbitmq-clone [res_rabbitmq]:
    * Started: [ ha-kompira1 ha-kompira2 ]

Node Attributes:
  * Node: ha-kompira1:
    * master-res_pgsql                  : 1000
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira1
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira1
  * Node: ha-kompira2:
    * master-res_pgsql                  : 1001
    * rmq-node-attr-last-known-res_rabbitmq     : rabbit@ha-kompira2
    * rmq-node-attr-res_rabbitmq        : rabbit@ha-kompira2
</pre></div>
</div>
</section>
<section id="id60">
<h4><span class="section-number">1.9.5.2. </span>When the server is unrecoverable<a class="headerlink" href="#id60" title="Permalink to this heading">¶</a></h4>
<p>This is the procedure when you need to shutdown the server and replace failing hardwarelure, prepare the server with OS installed and set it as a standby state.</p>
<p>In a HA configuration, it is necessary to register a license file on each of the active server and the standby server. Execute install.sh, then use the license_info command to check the hardware ID and register the license file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ tar zxf kompira-&lt;version&gt;-bin.tar.gz
$ cd kompira-&lt;version&gt;-bin
# ./install.sh

$ cp kompira_KP-EVALM100-0000000001.lic /var/opt/kompira/kompira.lic
$ cd /var/opt/kompira
$ chown apache:apache kompira.lic
$ /opt/kompira/bin/manage.py license_info

# ./setup_cluster.sh --primary --slave-mode
</pre></div>
</div>
<p>The above command is an example of setting up ha-kompira1 in a standby state.</p>
<p>In a HA configuration, it is necessary to register a license file on each of the active servers and standby servers, so you will need to register the license file before running setup_cluster.sh.</p>
<p>When you run setup_cluster.sh to add ha-kompira2 instead of ha-kompira1, use the <code class="docutils literal notranslate"><span class="pre">--secondary</span></code> option instead of the <code class="docutils literal notranslate"><span class="pre">--primary</span></code> option.</p>
<p>When the process of setup_cluster.sh is completed, please refer to <a class="reference internal" href="#ha-install-check"><span class="std std-ref">Status check</span></a> to know how to check the status.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#license"><span class="std std-ref">Kompira License</span></a></p>
</div>
</section>
</section>
<section id="setup-cluster-sh">
<span id="ha-setup-cluster-option"></span><h3><span class="section-number">1.9.6. </span>setup_cluster.sh Options<a class="headerlink" href="#setup-cluster-sh" title="Permalink to this heading">¶</a></h3>
<p>Below is a list of instructions on how to setup_cluster.sh.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Default value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--primary</span></code></p></td>
<td><p>true (specified)</p></td>
<td><p>Start setup as a primary</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--secondary</span></code></p></td>
<td><p>false (not specified)</p></td>
<td><p>Start setup as secondary</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--heartbeat-device=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">DEVICE</span></code></div>
</div>
</div>
</td>
<td></td>
<td><p>Specify the network device for heartbeat.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--master-mode</span></code></p></td>
<td></td>
<td><p>Setup as an active state.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--slave-mode</span></code></p></td>
<td></td>
<td><p>Set up as a standby state.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--without-vip</span></code></p></td>
<td></td>
<td><p>Setup without VIP configuration. (You will need to setup LB with ACT/SBY monitoring separately.)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--without-jobmanager</span></code></p></td>
<td></td>
<td><p>Setup without job manager configuration.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--hostname-prefix=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">PREFIX_NAME</span></code></div>
</div>
</div>
</td>
<td><p>ha-kompira</p></td>
<td><p>Specify the host name prefix.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--heartbeat-netaddr=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">NETWORK_ADDRESS</span></code></div>
</div>
</div>
</td>
<td><p>192.168.99.0</p></td>
<td><p>Specify the network address to be set for the heartbeat interface.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--manual</span></code></p></td>
<td></td>
<td><p>Setup parameters manually.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--manual-heartbeat</span></code></p></td>
<td></td>
<td><p>Manually configure the network for heartbeat. You will need to specify <code class="docutils literal notranslate"><span class="pre">--heartbeat-primary</span></code> and <code class="docutils literal notranslate"><span class="pre">--heartbeat-secondary</span></code> and ignore <code class="docutils literal notranslate"><span class="pre">--heartbeat-netaddr</span></code>. Heartbeat runs in unicast mode.</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--heartbeat-primary=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">NETWORK_ADDRESS</span></code></div>
</div>
</div>
</td>
<td></td>
<td><p>Specify the primary IP address.</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--heartbeat-secondary=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">NETWORK_ADDRESS</span></code></div>
</div>
</div>
</td>
<td></td>
<td><p>Specify the IP address of the secondary.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--cluster-name=NAME</span></code></p></td>
<td></td>
<td><p>Specify the cluster name (up to 15 characters).</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">--cluster-device=</span></code></div>
<div class="line-block">
<div class="line"><code class="docutils literal notranslate"><span class="pre">DEVICE</span></code></div>
</div>
</div>
</td>
<td></td>
<td><p>Specify the network device to be assigned the VIP.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--token=TOKEN</span></code></p></td>
<td><p>30000</p></td>
<td><p>Specify token timeout (milliseconds).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--consensus=CONSENSUS</span></code></p></td>
<td></td>
<td><p>Specify consensus timeout (milliseconds).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--proxy=PROXY</span></code></p></td>
<td></td>
<td><p>Specify the proxy server in the following format. <code class="docutils literal notranslate"><span class="pre">[user:passwd&#64;]proxy.server:port</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--noproxy=HOSTS</span></code></p></td>
<td></td>
<td><p>Specify the hosts to be excluded from the proxy in a comma-separated list.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--offline</span></code></p></td>
<td></td>
<td><p>Setup in offline mode.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--dry-run</span></code></p></td>
<td></td>
<td><p>Runs in dry run mode. It only checks the parameters and does not perform the actual setup.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--help</span></code></p></td>
<td></td>
<td><p>Print help message.</p></td>
</tr>
</tbody>
</table>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.7: </span>The default value of the –token option has been changed to 30000.</p>
</div>
</section>
<section id="sync-master-sh">
<span id="ha-sync-master-option"></span><h3><span class="section-number">1.9.7. </span>sync_master.sh options<a class="headerlink" href="#sync-master-sh" title="Permalink to this heading">¶</a></h3>
<p>Run sync_master.sh on the node where you want to synchronize data with the active system. Executing sync_master.sh copies the database of the active system to its own node and restarts the cluster as a standby system. Since sync_master.sh is used to recover a standby system that has been down for some reason, it clears the failure history recorded by pacemaker so that the cluster can be restarted.</p>
<p>The sync_master.sh is of the following format</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/sync_master.sh [options]
</pre></div>
</div>
<p>The options are as follows</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Options</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--force</span></code></p></td>
<td><p>Forcibly copy the data of the active system even if data remains.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--no-save-datadir</span></code></p></td>
<td><p>The data directory before data synchronization with the active system is deleted without saving.</p></td>
</tr>
</tbody>
</table>
<p>sync_master.sh attempts to synchronize data with the active system using the appropriate data, if any, remaining on the executed node. If data synchronization with the active system is achieved, the cluster can be restarted as a standby system without the need to copy data. If data synchronization cannot be confirmed, the cluster will automatically start copying data from the active system and then restart the cluster as a standby system.</p>
<p>Running sync_master.sh with the <code class="docutils literal notranslate"><span class="pre">--force</span></code> option will force the cluster to copy data from the active system even if data remains. This may improve behavior in cases where data synchronization decisions are not made properly.</p>
<p>sync_master.sh will save the existing database cluster before starting to copy data from the active system. Specifically, it renames the data directory, for example <code class="docutils literal notranslate"><span class="pre">/var/lib/pgsql/&lt;pgver&gt;/data</span></code> to <code class="docutils literal notranslate"><span class="pre">/var/lib/pgsql/&lt;pgver&gt;/data.old</span></code>. If the data copy succeeds, the saved <code class="docutils literal notranslate"><span class="pre">data.old</span></code> will be deleted automatically. If the data copy fails, the saved <code class="docutils literal notranslate"><span class="pre">/var/lib/pgsql/&lt;pgver&gt;/data.old</span></code> will be reverted to its original name <code class="docutils literal notranslate"><span class="pre">/var/lib/pgsql/&lt;pgver&gt;/data</span></code>.</p>
<p>Note that because of this process, you will need the combined capacity of the saved data and the synchronized data during data copying. If sync_master.sh is run with the <code class="docutils literal notranslate"><span class="pre">--no-save-datadir</span></code> option, data synchronization will be started after deletion without this saving, thus reducing the required free space. Note, however, that you will not be able to undo a failed synchronization.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 1.6.10: </span>The –force and –no-save-datadir options have been added.</p>
</div>
</section>
</section>
<section id="audit">
<span id="id61"></span><h2><span class="section-number">1.10. </span>Audit log management<a class="headerlink" href="#audit" title="Permalink to this heading">¶</a></h2>
<section id="id62">
<h3><span class="section-number">1.10.1. </span>Introduction<a class="headerlink" href="#id62" title="Permalink to this heading">¶</a></h3>
<p>When a user performs various operations on Kompira, it logs information such as the type of operation, whether it was permitted or not, and whether it was succeeded or not.</p>
<section id="id63">
<h4><span class="section-number">1.10.1.1. </span>Operations covered by the audit log<a class="headerlink" href="#id63" title="Permalink to this heading">¶</a></h4>
<p>The audit log records browser operations, operations using APIs, and operations using management commands on the server.</p>
<p>On the other hand, the following will not be recorded in the audit log.</p>
<ul class="simple">
<li><p>Data manipulation and process manipulation by job flow operation.</p></li>
<li><p>Operations outside the Kompira system (such as direct data manipulation using DB management commands).</p></li>
<li><p>Access to static content.</p></li>
</ul>
</section>
<section id="id64">
<h4><span class="section-number">1.10.1.2. </span>Operation level and logging level<a class="headerlink" href="#id64" title="Permalink to this heading">¶</a></h4>
<p>Whether or not an operation to be recorded is actually recorded in the audit log depends on the “operation level value” calculated from the type and result of the operation, and the “logging level value” which is a configuration item. When the calculated operation level value is greater than or equal to the logging level value of the setting item, the entry will be output to the audit log.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Conditions for recording audit logs: Operation level value &gt;= Logging level value
</pre></div>
</div>
<p>The operation level value is calculated from several items in the operation. Each item has its own set of operation level criteria, and the maximum value is the final operation level value. Usually, this value is between 1 and 3. See <a class="reference internal" href="#audit-spec"><span class="std std-ref">Details of audit log items</span></a> for the default value of the operation level threshold for each item.</p>
<p>For example, “Edited an existing JobFlow object in the browser (allowed and successful)” would result in the following per-item operation level criteria values being applied, with a final operation level value of 2.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Operation level (reference value)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">interface</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;web&quot;</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">class</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;update&quot;</span></code></p></td>
<td><p>2</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">permit</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;allowed&quot;</span></code></p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">result</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;succeeded&quot;</span></code></p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
<p>The default logging level value is 2. See <a class="reference internal" href="#audit-config"><span class="std std-ref">Configuration file</span></a> for more information.</p>
</section>
</section>
<section id="audit-logfile">
<span id="id65"></span><h3><span class="section-number">1.10.2. </span>Audit log file<a class="headerlink" href="#audit-logfile" title="Permalink to this heading">¶</a></h3>
<section id="id66">
<h4><span class="section-number">1.10.2.1. </span>Destination of audit log<a class="headerlink" href="#id66" title="Permalink to this heading">¶</a></h4>
<p>The audit log file will be created in the following directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/var/log/kompira/
</pre></div>
</div>
<p>The name of the log file to be created will be as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>audit-${USERNAME}.log
</pre></div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">${USERNAME}</span></code> part is the user name on the operating system that executed the process that processed the operation. For example, if you perform the operation in a browser, the Apache service on the server is doing the actual processing, and the <code class="docutils literal notranslate"><span class="pre">{$USERNAME}</span></code> part will be <code class="docutils literal notranslate"><span class="pre">apache</span></code>. Note that this is not the same as the user name you use to log in to Kompira in your browser.</p>
<p>The audit log file is not rotated by Kompira itself, but is configured at installation time to be rotated by a standard OS service.</p>
<p>The audit log file is created with a umask value of <code class="docutils literal notranslate"><span class="pre">027</span></code>. The owner of the log file will be the same as <code class="docutils literal notranslate"><span class="pre">${USERNAME}</span></code>, groups will have their write permissions masked, and other users will have their full access permissions masked.</p>
</section>
<section id="id67">
<h4><span class="section-number">1.10.2.2. </span>File format of audit log<a class="headerlink" href="#id67" title="Permalink to this heading">¶</a></h4>
<p>The audit log is a UTF-8 encoded text file that outputs one entry as one line in JSON format.</p>
</section>
<section id="id68">
<h4><span class="section-number">1.10.2.3. </span>Items recorded in audit log<a class="headerlink" href="#id68" title="Permalink to this heading">¶</a></h4>
<p>The items that are recorded in one entry of the audit log are shown below.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Operation level</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">level</span></code></p></td>
<td><p>Integer</p></td>
<td><p>Operation level value</p></td>
</tr>
<tr class="row-odd"><td><p>Operation started time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">started</span></code></p></td>
<td><p>Datetime</p></td>
<td><p>The date and time the operation was started.</p></td>
</tr>
<tr class="row-even"><td><p>Operation finished time</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">finished</span></code></p></td>
<td><p>Datetime</p></td>
<td><p>The date and time the operation was finished.</p></td>
</tr>
<tr class="row-odd"><td><p>Execution information</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec</span></code></p></td>
<td><p>Dictionary</p></td>
<td><p>Information on the execution Linux process (dictionary format)</p></td>
</tr>
<tr class="row-even"><td><p>Operation user</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">user</span></code></p></td>
<td><p>String</p></td>
<td><p>The name of the Kompira user who performed the operation.</p></td>
</tr>
<tr class="row-odd"><td><p>Operation interface</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">interface</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates the interface, such as whether it is operated by a browser or by management commands.</p></td>
</tr>
<tr class="row-even"><td><p>Operation class</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">class</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates the classification of session operations, object operations, etc.</p></td>
</tr>
<tr class="row-odd"><td><p>Operation target</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">target_path</span></code></p></td>
<td><p>String</p></td>
<td><p>Object path (during non-session operations)</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p><code class="docutils literal notranslate"><span class="pre">target_type</span></code></p></td>
<td><p>String</p></td>
<td><p>Type object (during object operations)</p></td>
</tr>
<tr class="row-odd"><td><p>Operation type</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">type</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates the type of operation, such as “reference” or “delete”.</p></td>
</tr>
<tr class="row-even"><td><p>Operation permit</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">permit</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates whether the operation has been “allowed” or “denied”.</p></td>
</tr>
<tr class="row-odd"><td><p>Operation result</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">result</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates whether the operation “succeeded” or “failed”.</p></td>
</tr>
<tr class="row-even"><td><p>Reasons for result</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">reason</span></code></p></td>
<td><p>String</p></td>
<td><p>Indicates the cause of the failure (if known).</p></td>
</tr>
<tr class="row-odd"><td><p>Detail information</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">detail</span></code></p></td>
<td><p>Dictionary</p></td>
<td><p>Detailed information about the operation (in a different dictionary format for each operation)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id69">
<h4><span class="section-number">1.10.2.4. </span>Sample of audit log<a class="headerlink" href="#id69" title="Permalink to this heading">¶</a></h4>
<p>The following is a sample audit log file <code class="docutils literal notranslate"><span class="pre">/var/log/kompira/audit-apache.log</span></code> from a browser operation. The log is output as one entry and one line, but here it is formatted for easy understanding.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{
  &quot;level&quot;: 3,
  &quot;started&quot;: &quot;2021-10-05T15:51:31.403016+09:00&quot;,
  &quot;finished&quot;: &quot;2021-10-05T15:51:31.452097+09:00&quot;,
  &quot;exec&quot;: {
    &quot;pid&quot;: 1286192,
    &quot;name&quot;: &quot;/usr/sbin/httpd&quot;,
    &quot;user&quot;: &quot;apache&quot;,
    &quot;remote&quot;: &quot;10.10.0.110&quot;
  },
  &quot;user&quot;: &quot;root&quot;,
  &quot;interface&quot;: &quot;web&quot;,
  &quot;class&quot;: &quot;session&quot;,
  &quot;target_path&quot;: null,
  &quot;target_type&quot;: null,
  &quot;type&quot;: &quot;login&quot;,
  &quot;permit&quot;: &quot;allowed&quot;,
  &quot;result&quot;: &quot;succeeded&quot;,
  &quot;reason&quot;: null,
  &quot;detail&quot;: {
    &quot;next_page&quot;: &quot;/&quot;
  }
}
{
  &quot;level&quot;: 2,
  &quot;started&quot;: &quot;2021-10-05T15:51:43.447941+09:00&quot;,
  &quot;finished&quot;: &quot;2021-10-05T15:51:43.486984+09:00&quot;,
  &quot;exec&quot;: {
    &quot;pid&quot;: 1285426,
    &quot;name&quot;: &quot;/usr/sbin/httpd&quot;,
    &quot;user&quot;: &quot;apache&quot;,
    &quot;remote&quot;: &quot;10.10.0.110&quot;
  },
  &quot;user&quot;: &quot;root&quot;,
  &quot;interface&quot;: &quot;web&quot;,
  &quot;class&quot;: &quot;object&quot;,
  &quot;target_path&quot;: &quot;/config/license&quot;,
  &quot;target_type&quot;: &quot;/system/types/License&quot;,
  &quot;type&quot;: &quot;read&quot;,
  &quot;permit&quot;: &quot;allowed&quot;,
  &quot;result&quot;: &quot;succeeded&quot;,
  &quot;reason&quot;: null,
  &quot;detail&quot;: {
    &quot;http_method&quot;: &quot;GET&quot;,
    &quot;http_status&quot;: 200
  }
}
</pre></div>
</div>
</section>
</section>
<section id="audit-spec">
<span id="id70"></span><h3><span class="section-number">1.10.3. </span>Details of audit log items<a class="headerlink" href="#audit-spec" title="Permalink to this heading">¶</a></h3>
<p>This section provides details about the items that are recorded in the audit log. In the table in the following sections, “operation level” indicates the default operation level reference value.</p>
<section id="level">
<h4><span class="section-number">1.10.3.1. </span>Operation level (level)<a class="headerlink" href="#level" title="Permalink to this heading">¶</a></h4>
<p>The operation level calculated based on the type of operation, result, etc. is shown as a numerical value. When this operation level value is greater than or equal to the logging level value of the setting item, the entry will be output to the audit log.</p>
</section>
<section id="started-finished">
<h4><span class="section-number">1.10.3.2. </span>Operation date and time (started, finished)<a class="headerlink" href="#started-finished" title="Permalink to this heading">¶</a></h4>
<p>The item <code class="docutils literal notranslate"><span class="pre">started</span></code> indicates the start date and time of the operation, and the item <code class="docutils literal notranslate"><span class="pre">finished</span></code> indicates the end date and time of the operation. These are recorded in ISO8601 format in local time, as shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;2021-10-01T11:45:08.977356+09:00&quot;
</pre></div>
</div>
</section>
<section id="exec">
<h4><span class="section-number">1.10.3.3. </span>Execution information (exec)<a class="headerlink" href="#exec" title="Permalink to this heading">¶</a></h4>
<p>The following information is recorded in the dictionary that indicates execution information.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Process id of execution</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec[&quot;pid&quot;]</span></code></p></td>
<td><p>Integer</p></td>
<td><p>Process id on the Kompira server.</p></td>
</tr>
<tr class="row-odd"><td><p>Process name of execution</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec[&quot;name&quot;]</span></code></p></td>
<td><p>String</p></td>
<td><p>Process name on the Kompira server.</p></td>
</tr>
<tr class="row-even"><td><p>User name of execution</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec[&quot;user&quot;]</span></code></p></td>
<td><p>String</p></td>
<td><p>User name of the execution process on the Kompira server.</p></td>
</tr>
<tr class="row-odd"><td><p>Remote address</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">exec[&quot;remote&quot;]</span></code></p></td>
<td><p>String</p></td>
<td><p>IP address of the operation source. (during browser operation)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="user">
<h4><span class="section-number">1.10.3.4. </span>Operation user (user)<a class="headerlink" href="#user" title="Permalink to this heading">¶</a></h4>
<p>Record the name of the Kompira user who performed the operation. If the operation was performed by logging in to Kompira in a browser, this will be the login user name. If the operation was performed using management command on the server console, it will be an empty string because it is not accompanied by Kompira authentication.</p>
</section>
<section id="interface">
<h4><span class="section-number">1.10.3.5. </span>Operation interface (interface)<a class="headerlink" href="#interface" title="Permalink to this heading">¶</a></h4>
<p>Record the classification of what interface was used to perform the operation.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Operation level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;web&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Operation by web browser.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;api&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Operation by REST-API.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;mng&quot;</span></code></p></td>
<td><p>2</p></td>
<td><p>Operation by management commands (e.g. manage.py).</p></td>
</tr>
</tbody>
</table>
</section>
<section id="class">
<h4><span class="section-number">1.10.3.6. </span>Operation class (class)<a class="headerlink" href="#class" title="Permalink to this heading">¶</a></h4>
<p>Indicates the classification of what kind of operation was performed.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Operation level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;session&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Session operations (login, logout)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;user&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>User information operations (adding and deleting users, changing passwords, etc.)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;group&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Group information operations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;object&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Object operations</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;task&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Task operations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;incident&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Incident operations</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;process&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Process operations</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;schedule&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Schedule operations</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;packages&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>System packages information operations</p></td>
</tr>
</tbody>
</table>
</section>
<section id="target-path-target-type">
<h4><span class="section-number">1.10.3.7. </span>Operation target (target_path, target_type)<a class="headerlink" href="#target-path-target-type" title="Permalink to this heading">¶</a></h4>
<p>Indicates what was manipulated and its specific target.</p>
<p>If the operation class is other than <code class="docutils literal notranslate"><span class="pre">session</span></code>, the operation target can be identified by its path. The path is recorded as an entry <code class="docutils literal notranslate"><span class="pre">target_path</span></code> as follows.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;/system/user/id_1&quot;
</pre></div>
</div>
<p>Additionally, in the case of object operations, the path of the type object is recorded in the entry <code class="docutils literal notranslate"><span class="pre">target_type</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;/system/types/Directory&quot;
</pre></div>
</div>
</section>
<section id="type">
<h4><span class="section-number">1.10.3.8. </span>Operation type (type)<a class="headerlink" href="#type" title="Permalink to this heading">¶</a></h4>
<p>It records the type of the operation that was performed.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Operation level</p></th>
<th class="head"><p>Example of operations</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;login&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>logged in to kompira</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;logout&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Logged out of kompira</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;create&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Create a new object</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;rename&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Rename object</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;copy&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Copy objects</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;move&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Move objects</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;export&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Export data</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;import&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Import data</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;execute&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Execute job flows and script jobs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;suspend&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Suspend the process</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;resume&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Resume the process</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;terminate&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Terminate the process</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;read&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Display the content of an object.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;list&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Display a list of objects.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;search&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Search for objects.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;new&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Edit a new object (before create).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;edit&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Edit an existing object (before update).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;confirm&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Confirm object operation (before delete).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;update&quot;</span></code></p></td>
<td><p>2</p></td>
<td><p>Update object</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;clear&quot;</span></code></p></td>
<td><p>2</p></td>
<td><p>Erase messages from a channel. Clear status of management area.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;recv&quot;</span></code></p></td>
<td><p>2</p></td>
<td><p>Receive a message from a channel.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;send&quot;</span></code></p></td>
<td><p>2</p></td>
<td><p>Send a message to a channel.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;delete&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Delete object</p></td>
</tr>
</tbody>
</table>
<p>Some operation types are only used for specific operation class. For example, login and logout are only used when the operation class is <code class="docutils literal notranslate"><span class="pre">session</span></code>.</p>
<p>Although an operation type may be used in multiple operation classes, it is not possible to set different operation level criteria values for each operation class.</p>
</section>
<section id="permit-result">
<h4><span class="section-number">1.10.3.9. </span>Operation result (permit, result)<a class="headerlink" href="#permit-result" title="Permalink to this heading">¶</a></h4>
<p>As a result of the operation, its allowed or denied and succeeded or failed will be recorded.</p>
<p>The item <code class="docutils literal notranslate"><span class="pre">permit</span></code> indicates whether the operation is allowed or not. For example, in object operations, the operation is allowed or denied depending on the permissions set.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Operation level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;allowed&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Operation allowed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;denied&quot;</span></code></p></td>
<td><p>3</p></td>
<td><p>Operation denied.</p></td>
</tr>
</tbody>
</table>
<p>The item <code class="docutils literal notranslate"><span class="pre">result</span></code> indicates whether the operation was succeeded or not.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Value</p></th>
<th class="head"><p>Operation level</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;succeeded&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Operation succeeded.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">&quot;failed&quot;</span></code></p></td>
<td><p>1</p></td>
<td><p>Operation failed.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="detail">
<h4><span class="section-number">1.10.3.10. </span>Detail information (detail)<a class="headerlink" href="#detail" title="Permalink to this heading">¶</a></h4>
<p>Additional detail information for each type of operation is recorded in a dictionary format.</p>
<p>(*) However, please note that the detail information may be adjusted even after the release of the audit log feature.</p>
<p><strong>Login</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">next_page</span></code></p></td>
<td><p>Pages to which you will be redirected after logging in.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_password</span></code></p></td>
<td><p>Invalid password. (in case of authentication error)</p></td>
</tr>
</tbody>
</table>
<p><strong>REST-API</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">invalid_token</span></code></p></td>
<td><p>Invalid API token. (in case of authentication error)</p></td>
</tr>
</tbody>
</table>
<p><strong>Export</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">export_format</span></code></p></td>
<td><p>Export format. (‘json’ or ‘dir’)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">export_options</span></code></p></td>
<td><p>Options specified during export.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">export_paths</span></code></p></td>
<td><p>The path to export.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">export_counters</span></code></p></td>
<td><p>Counter information for export results.</p></td>
</tr>
</tbody>
</table>
<p><strong>Import</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">import_format</span></code></p></td>
<td><p>Import format. (‘json’ or ‘dir’)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">import_options</span></code></p></td>
<td><p>Options specified during import.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">import_sources</span></code></p></td>
<td><p>Imported file names.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">import_counters</span></code></p></td>
<td><p>Counter information for import results.</p></td>
</tr>
</tbody>
</table>
<p><strong>Search for objects</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">search_params</span></code></p></td>
<td><p>Search parameters</p></td>
</tr>
</tbody>
</table>
<p><strong>Create a new object</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">create_name</span></code></p></td>
<td><p>Name of the new object to be created.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">create_type</span></code></p></td>
<td><p>The path of the type object of the new object to be created.</p></td>
</tr>
</tbody>
</table>
<p><strong>Execute job flows and script jobs</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">execute_pid</span></code></p></td>
<td><p>Process ID that was executed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">execute_params</span></code></p></td>
<td><p>Parameters specified at execute.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">execute_form</span></code></p></td>
<td><p>Path of the form used for execution (if executed from a form object).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">execute_table</span></code></p></td>
<td><p>Path of the table used for execution (if executed from a table object).</p></td>
</tr>
</tbody>
</table>
<p><strong>Rename object</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">rename_to</span></code></p></td>
<td><p>Name to be changed.</p></td>
</tr>
</tbody>
</table>
<p><strong>Copy objects</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">copy_objects</span></code></p></td>
<td><p>List of objects to be copied.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">copy_rename</span></code></p></td>
<td><p>Name of the object specified when copying.</p></td>
</tr>
</tbody>
</table>
<p><strong>Move objects</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">move_objects</span></code></p></td>
<td><p>List of objects to be moved.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">move_rename</span></code></p></td>
<td><p>Name of the object specified when moving.</p></td>
</tr>
</tbody>
</table>
<p><strong>Delete object</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">delete_objects</span></code></p></td>
<td><p>List of deleted paths or object IDs.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">delete_file</span></code></p></td>
<td><p>File name of the deleted attachment.</p></td>
</tr>
</tbody>
</table>
<p><strong>Send a message to a channel</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">send_form</span></code></p></td>
<td><p>Path of the form used for send (if send from a form object).</p></td>
</tr>
</tbody>
</table>
<p><strong>Management command: compile_jobflow / compile_library</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">compile_paths</span></code></p></td>
<td><p>List of paths specified as compile targets.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">compile_result</span></code></p></td>
<td><p>Compilation result (count information)</p></td>
</tr>
</tbody>
</table>
<p><strong>Management command: license_info / license_update</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">license_id</span></code></p></td>
<td><p>License ID</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">license_path</span></code></p></td>
<td><p>The name of the license file you installed (for license_update)</p></td>
</tr>
</tbody>
</table>
<p><strong>Management command: process</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">process_query</span></code></p></td>
<td><p>Search query for process objects.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">process_count</span></code></p></td>
<td><p>Number of processes searched.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">process_listed</span></code></p></td>
<td><p>Number of processes displayed.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">process_deleted</span></code></p></td>
<td><p>Number of processes deleted.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">process_terminated</span></code></p></td>
<td><p>Number of processes terminated.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">process_suspended</span></code></p></td>
<td><p>Number of processes suspended.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">process_resumed</span></code></p></td>
<td><p>Number of processes resumed.</p></td>
</tr>
</tbody>
</table>
<p><strong>Other detailed information</strong></p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http_method</span></code></p></td>
<td><p>Method name of the HTTP request.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http_status</span></code></p></td>
<td><p>Status code of the HTTP response.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target_attr</span></code></p></td>
<td><p>Attribute name of the operation target.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">target_index</span></code></p></td>
<td><p>Index value of the operation target</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bulk_deleted</span></code></p></td>
<td><p>Detail information for bulk deletion.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="audit-config">
<span id="id71"></span><h3><span class="section-number">1.10.4. </span>Configuration file<a class="headerlink" href="#audit-config" title="Permalink to this heading">¶</a></h3>
<p>You can configure settings related to the audit log in the following file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/opt/kompira/kompira_audit.yaml
</pre></div>
</div>
<section id="id72">
<h4><span class="section-number">1.10.4.1. </span>Configuration file format<a class="headerlink" href="#id72" title="Permalink to this heading">¶</a></h4>
<p>The configuration file <code class="docutils literal notranslate"><span class="pre">kompira_audit.yaml</span></code> is written in YAML format. The whole thing is a dictionary structure, and the following configuration items are required.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">logging_level</span></code></p></td>
<td><p>Integer</p></td>
<td><p>Logging level value for audit log.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">operation_levels</span></code></p></td>
<td><p>Dictionary</p></td>
<td><p>Operation level reference value table for each operation.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">target_levels</span></code></p></td>
<td><p>Array</p></td>
<td><p>Operation level reference value table for each operation target in object manipulation, etc.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id73">
<h4><span class="section-number">1.10.4.2. </span>Auto reloading of configuration file<a class="headerlink" href="#id73" title="Permalink to this heading">¶</a></h4>
<p>When the audit log configuration file is updated on the server, it will be automatically reloaded at the timing of the next audit log recording. There is no need to restart the service.</p>
</section>
<section id="id74">
<h4><span class="section-number">1.10.4.3. </span>Default configuration file<a class="headerlink" href="#id74" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#--------------------------------------------------------------------
# kompira_audit.yaml
#
# Configuration file to control audit log output.
#--------------------------------------------------------------------
#
# logging_level: recording level value
#
# If the calculated operation level value is less than the recording
# level value, no audit log will be recorded.
#
logging_level: 2

#
# operation_levels: basic operation level table
#
# Table of operation level reference values for each operation.
# The operation level value for an operation is the maximum of
# several operation level criteria values.
#
operation_levels:
interface:
    web: 1
    api: 1
    mng: 2
class:
    session: 3
    user: 3
    group: 3
    object: 1
    task: 1
    incident: 1
    process: 1
    schedule: 1
    packages: 1
type:
    login: 3
    logout: 3
    create: 3
    rename: 3
    copy: 3
    move: 3
    export: 3
    import: 3
    execute: 3
    suspend: 3
    resume: 3
    terminate: 3
    read: 1
    list: 1
    search: 1
    edit: 1
    confirm: 1
    update: 2
    clear: 2
    recv: 2
    send: 2
    delete: 3
permit:
    allowed: 1
    denied: 3
result:
    succeeded: 1
    failed: 1

#
# target_levels: operation level table for object operation
#
# Operation level reference value to be applied to each target
# during object manipulation.
#
target_levels:
  - {path: &#39;/config/*&#39;, type: null, level: 2}
  - {path: &#39;/system/*&#39;, type: &#39;/system/types/Config&#39;, level: 2}
</pre></div>
</div>
</section>
</section>
</section>
<section id="system-packages">
<span id="id75"></span><h2><span class="section-number">1.11. </span>System packages management<a class="headerlink" href="#system-packages" title="Permalink to this heading">¶</a></h2>
<p>Information about the Python and web packages installed in the Kompira environment can be viewed below. For each package type, you can see information about the installed package version and license.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/system/packages/PIP</span></code></p></td>
<td><p>Information about the Python packages managed by PIP in the Kompira environment.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/system/packages/Web</span></code></p></td>
<td><p>Information about packages for the web that are managed as static content in the Kompira environment.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>System package information is automatically collected and updated when kompirad is started after installing or updating Kompira.</p>
</div>
<section id="id76">
<h3><span class="section-number">1.11.1. </span>Manage command for packages information<a class="headerlink" href="#id76" title="Permalink to this heading">¶</a></h3>
<p>You can use the following commands on the Kompira server to manage packages information.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py packages_info [options...]
</pre></div>
</div>
<section id="id77">
<h4><span class="section-number">1.11.1.1. </span>Show pacakges information<a class="headerlink" href="#id77" title="Permalink to this heading">¶</a></h4>
<p>If the option is omitted or the <code class="docutils literal notranslate"><span class="pre">--show</span></code> option is specified, packages information that has already been collected will be listed in the console.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py packages_info --show
</pre></div>
</div>
<p>An example of the package information listing is shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+------+----------------------+-----------+----------+-----------------+
| Type | Name                 | Installed | Latest   | License         |
+------+----------------------+-----------+----------+-----------------+
| pip  | APScheduler          | 3.6.3     | 3.8.1    | MIT License     |
| pip  | Creoleparser         | 0.7.5     | None     | MIT License     |
| pip  | Django               | 3.0.5     | 3.2.8    | BSD License     |
| pip  | Genshi               | 0.7.5     | None     | BSD License     |
| pip  | GitPython            | 3.1.18    | None     | BSD License     |
   :         :                    :           :            :
</pre></div>
</div>
</section>
<section id="id78">
<h4><span class="section-number">1.11.1.2. </span>Collect packages information<a class="headerlink" href="#id78" title="Permalink to this heading">¶</a></h4>
<p>If the <code class="docutils literal notranslate"><span class="pre">--collect</span></code> option is specified, it will collect information about the installed packages. However, only the <code class="docutils literal notranslate"><span class="pre">root</span></code> or <code class="docutils literal notranslate"><span class="pre">kompira</span></code> user on the Kompira server can do this.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py packages_info --collect
</pre></div>
</div>
<p>At this time, an Internet connection is required to collect the latest version information for each package. If a proxy connection is required, specify it with the <code class="docutils literal notranslate"><span class="pre">--proxy</span></code> option (or the <code class="docutils literal notranslate"><span class="pre">https_proxy</span></code> environment variable).</p>
<p>If you don’t want to collect the latest version information, for example because you don’t have an Internet connection, you can additionally specify the <code class="docutils literal notranslate"><span class="pre">--no-collect-latest</span></code> option. Alternatively, you can specify the <code class="docutils literal notranslate"><span class="pre">--collect-latest</span></code> option to explicitly collect the latest version information.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the collected packages information will be stored in the <code class="docutils literal notranslate"><span class="pre">/var/opt/kompira/packages/</span></code> directory on the server.</p>
</div>
</section>
<section id="id79">
<h4><span class="section-number">1.11.1.3. </span>Update packages information<a class="headerlink" href="#id79" title="Permalink to this heading">¶</a></h4>
<p>If the <code class="docutils literal notranslate"><span class="pre">--update</span></code> option is specified, the system packages information object (of type Wiki) on Kompira will be updated based on the collected packages information. However, only the <code class="docutils literal notranslate"><span class="pre">root</span></code> or <code class="docutils literal notranslate"><span class="pre">kompira</span></code> user on the Kompira server can do this.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ /opt/kompira/bin/manage.py packages_info --update
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">--update</span></code> and <code class="docutils literal notranslate"><span class="pre">--collect</span></code> options are used together, the system package information object will be updated following the collection of package information.</p>
</section>
</section>
</section>
<section id="ssl">
<span id="ssl-certs"></span><h2><span class="section-number">1.12. </span>SSL Certificate Management<a class="headerlink" href="#ssl" title="Permalink to this heading">¶</a></h2>
<p>Kompira uses the following certificates for SSL connections.</p>
<ul class="simple">
<li><p>CA certificate for signing the following SSL certificates</p></li>
<li><p>Server certificate for AMQPS connections (used by rabbitmq-server)</p></li>
<li><p>Client certificate for AMQPS connection (used by kompira_jobmngrd and kompira_sendevt)</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The descriptions in this section are for cases where the Kompira server has been configured to perform SSL certificate verification. For example, if you have added the –amqps-verify option to install.sh during installation. If SSL certificate verification is not enabled, the “SSL certificate verification” described in this section will not be performed.</p>
</div>
<section id="id80">
<h3><span class="section-number">1.12.1. </span>Location of Certificate Files<a class="headerlink" href="#id80" title="Permalink to this heading">¶</a></h3>
<p>The SSL certificate used by Kompira is located in the following directory.</p>
<table class="longtable docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Path</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">/opt/kompira/ssl/ca-source/</span></code></p></td>
<td><p>Directory where CA certificate files for signing SSL certificates are located.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">/opt/kompira/ssl/certs/</span></code></p></td>
<td><p>Directory where SSL certificate files used for SSL connections and CA certificate files used to verify SSL certificates are located.</p></td>
</tr>
</tbody>
</table>
<p>The certificate files to be located in these directories are described below. Note that each certificate file also contains a CSR file and a private key file with .csr and .key extensions in the same location.</p>
</section>
<section id="opt-kompira-ssl-ca-source">
<h3><span class="section-number">1.12.2. </span>/opt/kompira/ssl/ca-source/<a class="headerlink" href="#opt-kompira-ssl-ca-source" title="Permalink to this heading">¶</a></h3>
<p>Locate the CA certificate file for signing SSL certificates in <code class="docutils literal notranslate"><span class="pre">/opt/kompira/ssl/ca-source/</span></code>.</p>
<section id="kompira-local-ca-crt">
<h4><span class="section-number">1.12.2.1. </span>kompira-local-ca.crt<a class="headerlink" href="#kompira-local-ca-crt" title="Permalink to this heading">¶</a></h4>
<p>The CA certificate that signs the SSL certificate created on this Kompira server.</p>
<p>This CA certificate is automatically created when Kompira is installed.</p>
</section>
<section id="kompira-other-ca-crt">
<h4><span class="section-number">1.12.2.2. </span>kompira-other-ca.crt<a class="headerlink" href="#kompira-other-ca-crt" title="Permalink to this heading">¶</a></h4>
<p>This is a copy of kompira-local-ca.crt from the opposing Kompira server in a clustered environment. Copy it by scp from the opposite Kompira server with the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">get-other-ca</span></code> command described below, or by some other means.</p>
<p>Kompira does not use this CA certificate directly, but uses kompira-bundle-ca.crt, a bundle of CA certificates described below, to perform SSL verification.</p>
</section>
</section>
<section id="opt-kompira-ssl-certs">
<h3><span class="section-number">1.12.3. </span>/opt/kompira/ssl/certs/<a class="headerlink" href="#opt-kompira-ssl-certs" title="Permalink to this heading">¶</a></h3>
<p>Locate the SSL certificate file used for the SSL connection and the CA certificate file used for verification in <code class="docutils literal notranslate"><span class="pre">/opt/kompira/ssl/certs/</span></code>.</p>
<section id="kompira-bundle-ca-crt">
<h4><span class="section-number">1.12.3.1. </span>kompira-bundle-ca.crt<a class="headerlink" href="#kompira-bundle-ca-crt" title="Permalink to this heading">¶</a></h4>
<p>This is a single file containing all CA certificates located in /opt/kompira/ssl/ca-source/. It is usually created automatically, but can be updated with the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">update-bundle-ca</span></code> command described below.</p>
<p>The rabbitmq-server on the Kompira server is configured to use this CA certificate to validate client SSL certificates. This means that only clients with SSL certificates signed by one of the included CA certificates will be able to connect. Note that clients with SSL certificates signed by CA certificates generated by other Kompira servers cannot connect to this Kompira server.</p>
<p>kompira_jobmngrd and kompira_sendevt are configured to use this CA certificate for server SSL certificate validation (this can also be specified in kompira.conf). This means that SSL connections can only be made to servers with SSL certificates signed by one of the included CA certificates. Note that on nodes where kompira_jobmngrd or kompira_sendevt is installed independently, this CA certificate must be copied in advance. Please refer to the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">client-setup</span></code> command for instructions.</p>
<p>kompira-bundle-ca.crt contains only kompira-local-ca.crt for that server when Kompira is installed.</p>
<p>When setting up a clustered environment, it is recommended to update kompira-bundle-ca.crt on the two servers by retrieving the mutually opposed kompira-local-ca.crt. That way, a client with an SSL certificate signed by either CA certificate will be able to make SSL connections to either server. For example, when sending an event with kompira_sendevt to a VIP address, it is not known in advance which server will actually be connected to. Note that the client must have a kompira-bundle-ca.crt that contains the two CA certificates. See <a class="reference internal" href="#ssl-certs-admin-ca-in-cluster"><span class="std std-ref">Manage CA certificates in a clustered environment</span></a> for details.</p>
</section>
<section id="amqp-server-crt">
<h4><span class="section-number">1.12.3.2. </span>amqp-server.crt<a class="headerlink" href="#amqp-server-crt" title="Permalink to this heading">¶</a></h4>
<p>SSL certificate to be used by the AMQP server side (rabbitmq-server). It is signed by kompira-local-ca.crt. This certificate is automatically created when Kompira is installed.</p>
</section>
<section id="amqp-client-kompira-crt">
<h4><span class="section-number">1.12.3.3. </span>amqp-client-kompira.crt<a class="headerlink" href="#amqp-client-kompira-crt" title="Permalink to this heading">¶</a></h4>
<p>SSL certificate used by AMQP clients (kompira_jobmngrd, kompira_sendevt). It is signed by kompira-local-ca.crt. This certificate is automatically created when Kompira is installed.</p>
<p>Note that on nodes where kompira_jobmngrd or kompira_sendevt is installed independently, this SSL Note that the certificate must be copied in advance. Please refer to the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">client-setup</span></code> command for instructions.</p>
</section>
</section>
<section id="id81">
<h3><span class="section-number">1.12.4. </span>Script for SSL Certificate Management<a class="headerlink" href="#id81" title="Permalink to this heading">¶</a></h3>
<p>The ssl_utils.sh script can be used to manage SSL certificate creation, etc.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh command [options]
</pre></div>
</div>
<p>The ssl_utils.sh script must be run as root.</p>
<section id="id82">
<h4><span class="section-number">1.12.4.1. </span>Setting up a server side SSL environment<a class="headerlink" href="#id82" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh server-setup
</pre></div>
</div>
<p>Creates CA and SSL certificates for use on the Kompira server. Internally, the following processes are performed.</p>
<ul class="simple">
<li><p>Create local CA certificate</p></li>
<li><p>Update bundled CA certificate</p></li>
<li><p>Create SSL certificate (for AMQP server)</p></li>
<li><p>Create SSL certificate (for AMQP client)</p></li>
</ul>
<p>All certificates are created with an expiration date of 10000 days.</p>
<p>This process is automatically performed when installing Kompira with intall.sh and is not normally used.</p>
</section>
<section id="id83">
<h4><span class="section-number">1.12.4.2. </span>Setting up a client side SSL environment<a class="headerlink" href="#id83" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh client-setup kompira-server
</pre></div>
</div>
<p>For kompira_jobmngrd or kompira_sendevt installed on a different node from the Kompira server to make SSL connections CA and SSL certificates must be obtained from the Kompira server. This command obtains the necessary certificates from the Kompira server specified in the command line argument kompira-server using the scp command. It is automatically executed when the –jobmngr or –sendevt option is added to install.sh, so it is not normally used.</p>
<p>When this command is executed, you will need to enter the password for the root account on the Kompira server in order to transfer files internally using the scp command. Enter the password when prompted as shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: Start copying the SSL/CA certificates from the kompira server with scp.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: PLEASE ENTER THE PASSWORD OF THE REMOTE KOMPIRA SERVER (&lt;kompira-server&gt;) FOR SCP.
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] VERBOSE: run: scp -q -p -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@&lt;kompira-server&gt;:/opt/kompira/ssl/certs/{kompira-bundle-ca.crt,amqp-client-kompira{.crt,.key}} /opt/kompira/ssl/certs/
root@&lt;kompira-server&gt;&#39;s password:
</pre></div>
</div>
<p>If for some reason you cannot transfer files using the scp command, copy the following files on the Kompira server to the same directory by any other feasible means.</p>
<ul class="simple">
<li><p>/opt/kompira/ssl/certs/kompira-bundle-ca.crt</p></li>
<li><p>/opt/kompira/ssl/certs/amqp-client-kompira.crt</p></li>
<li><p>/opt/kompira/ssl/certs/amqp-client-kompira.key</p></li>
</ul>
<p>If you copied them manually, set a group of these files to kompira so that they can be accessed by kompira_jobmngrd.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># chown :kompira /opt/kompira/ssl/certs/*
</pre></div>
</div>
<p>Also note that if kompira_sendevt is used with SSL connections, the user executing it must have access to these files. Adjust the executing user or adjust the permissions on these files as necessary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have installed kompira_sendevt in a Windows environment, locate the certificate files obtained from the Kompira server in the <code class="docutils literal notranslate"><span class="pre">C:\Kompira\SSL\Certs</span></code> directory. See <a class="reference internal" href="#package-sendevt-install-windows"><span class="std std-ref">Installation on Windows</span></a> for details.</p>
</div>
</section>
<section id="ca">
<h4><span class="section-number">1.12.4.3. </span>Manage CA certificates<a class="headerlink" href="#ca" title="Permalink to this heading">¶</a></h4>
<p><strong>Update bundled CA certificate</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh update-bundle-ca
</pre></div>
</div>
<p>Combine the CA certificates located in <code class="docutils literal notranslate"><span class="pre">/opt/kompira/ssl/ca-source/</span></code> into a single CA certificate, kompira-bundle-ca.crt. The <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">server-setup</span></code> or <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">get-other-ca</span></code> commands, it is handled internally and is not normally used.</p>
<p><strong>Create local CA certificate</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh create-local-ca
</pre></div>
</div>
<p>Create a local CA certificate kompira-local-ca.crt The following file will be created in the directory /opt/kompira/ssl/ca-source/.</p>
<ul class="simple">
<li><p>kompira-local-ca.key : Private key file (RSA-key 2048 bit)</p></li>
<li><p>kompira-local-ca.crt : CA certificate file</p></li>
</ul>
<p>The CA certificate is valid for 10000 days.</p>
<p>When you run the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">server-setup</span></code> command, it is handled internally, so you will not normally use it.</p>
</section>
<section id="ssl-certs-admin-ca-in-cluster">
<span id="id84"></span><h4><span class="section-number">1.12.4.4. </span>Manage CA certificates in a clustered environment<a class="headerlink" href="#ssl-certs-admin-ca-in-cluster" title="Permalink to this heading">¶</a></h4>
<p><strong>Obtain CA certificate of another node (scp)</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh get-other-ca [other-server]
</pre></div>
</div>
<p>Obtains the CA certificate kompira-local-ca.crt from the Kompira server specified by the command line argument other-server. Save the obtained CA certificate as kompira-other-ca.crt, and then update the bundle CA certificate.</p>
<p>When this command is executed, you will need to enter the password for the root account on the Kompira server in order to transfer files internally using the scp command. Enter the password when prompted as shown below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: Start copying the SSL/CA certificates from the other kompira server with scp..
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: PLEASE ENTER THE PASSWORD OF THE OTHER KOMPIRA SERVER (&lt;other-server&gt;) FOR SCP..
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] INFO: !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
[2023-01-16 18:34:12] INFO:
[2023-01-16 18:34:12] VERBOSE: run: scp -q -p -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null root@&lt;other-server&gt;:/opt/kompira/ssl/ca-source/kompira-local-ca.crt /opt/kompira/ssl/ca-source/kompira-other-ca.crt
root@&lt;other-server&gt;&#39;s password:
</pre></div>
</div>
<p>If for some reason you are unable to transfer the file using the scp command, copy /opt/kompira/ssl/ca-source/kompira-local-ca.crt on the opposite Kompira server as /opt/kompira/ssl/ca-source/kompira-other-ca.crt on this server by any other feasible means. Then, update the bundle CA certificate with the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">update-bundle-ca</span></code> command.</p>
</section>
<section id="id85">
<h4><span class="section-number">1.12.4.5. </span>Create SSL certificate<a class="headerlink" href="#id85" title="Permalink to this heading">¶</a></h4>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># /opt/kompira/bin/ssl_utils.sh create-cert certname subject
</pre></div>
</div>
<p>Creates a new SSL certificate. The following file is created in the directory /opt/kompira/ssl/certs/ based on the name specified in the option certname.</p>
<ul class="simple">
<li><p>&lt;certname&gt;.key : Private key file (RSA-key 2048 bit)</p></li>
<li><p>&lt;certname&gt;.csr : CSR file</p></li>
<li><p>&lt;certname&gt;.crt : SSL certificate file</p></li>
</ul>
<p>The subject of the certificate is set to the value specified in the option subject, and the validity period is 10000 days. This SSL certificate file is signed by kompira-local-ca.crt.</p>
<p>Certificates for AMQP servers and AMQP clients are automatically created when you run the <code class="docutils literal notranslate"><span class="pre">ssl_utils.sh</span> <span class="pre">server-setup</span></code> command.</p>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">1. Administration Guide</a><ul>
<li><a class="reference internal" href="#admin-introduction">1.1. Introduction</a></li>
<li><a class="reference internal" href="#kompira">1.2. Kompira package management</a><ul>
<li><a class="reference internal" href="#package-kind">1.2.1. Type of installation package</a></li>
<li><a class="reference internal" href="#package-install-sh">1.2.2. Install Script</a><ul>
<li><a class="reference internal" href="#id5">1.2.2.1. Limitation</a></li>
<li><a class="reference internal" href="#id6">1.2.2.2. Command Line Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-kompira">1.2.3. Kompira Package</a><ul>
<li><a class="reference internal" href="#package-kompira-install">1.2.3.1. Installation</a></li>
<li><a class="reference internal" href="#package-kompira-update">1.2.3.2. Update</a></li>
<li><a class="reference internal" href="#postgresql">1.2.3.3. Upgrade PostgreSQL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-jobmngr">1.2.4. Job manager package</a><ul>
<li><a class="reference internal" href="#package-jobmngr-install">1.2.4.1. Installation</a></li>
<li><a class="reference internal" href="#package-jobmngr-update">1.2.4.2. Update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package-sendevt">1.2.5. Send-Event package</a><ul>
<li><a class="reference internal" href="#rhel-centos">1.2.5.1. Extract the Kompira package and run install.sh.</a></li>
<li><a class="reference internal" href="#windows">1.2.5.2. Installation on Windows</a></li>
<li><a class="reference internal" href="#package-sendevt-update">1.2.5.3. Update</a></li>
</ul>
</li>
<li><a class="reference internal" href="#offline-install">1.2.6. Offline install</a><ul>
<li><a class="reference internal" href="#kompira-extra">1.2.6.1. Create the kompira-extra package in an Internet-connected environment.</a></li>
<li><a class="reference internal" href="#id16">1.2.6.2. Offline installation using the kompira-extra package.</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#process">1.3. Kompira process management</a><ul>
<li><a class="reference internal" href="#process-architecture">1.3.1. Structure of Kompira processes</a></li>
<li><a class="reference internal" href="#process-daemon">1.3.2. Starting / stopping the Kompira daemon and Checking the state</a><ul>
<li><a class="reference internal" href="#rhel-centos-7-8">1.3.2.1. For RHEL / CentOS 7x / 8x</a></li>
</ul>
</li>
<li><a class="reference internal" href="#process-jobmngr">1.3.3. Starting / stopping the Kompira daemon and Checking the status.</a><ul>
<li><a class="reference internal" href="#id21">1.3.3.1. For RHEL / CentOS 7x / 8x</a></li>
</ul>
</li>
<li><a class="reference internal" href="#process-port">1.3.4. Port List used by Kompira</a></li>
</ul>
</li>
<li><a class="reference internal" href="#node">1.4. Node setting</a><ul>
<li><a class="reference internal" href="#node-local">1.4.1. Local node setting</a></li>
<li><a class="reference internal" href="#ssh">1.4.2. SSH node setting</a></li>
<li><a class="reference internal" href="#node-winrs">1.4.3. Windows node setting</a><ul>
<li><a class="reference internal" href="#winrm">1.4.3.1. Enabling remote management of WinRM</a></li>
<li><a class="reference internal" href="#id26">1.4.3.2. Changing WinRM connection settings</a></li>
<li><a class="reference internal" href="#id27">1.4.3.3. Test job flow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#node-device">1.4.4. Network device node setting</a><ul>
<li><a class="reference internal" href="#id29">1.4.4.1. List of supported devices</a></li>
<li><a class="reference internal" href="#id30">1.4.4.2. Restrictions on network devices</a></li>
<li><a class="reference internal" href="#id31">1.4.4.3. Information on the devices tested</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#file">1.5. Kompira settings and log files</a><ul>
<li><a class="reference internal" href="#file-hierarchy">1.5.1. Kompira standard directories.</a></li>
<li><a class="reference internal" href="#file-log">1.5.2. Kompira logs</a></li>
<li><a class="reference internal" href="#file-settings">1.5.3. Kompira configuration files</a></li>
<li><a class="reference internal" href="#id36">1.5.4. Kompira image files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#data">1.6. Data backup of Kompira</a><ul>
<li><a class="reference internal" href="#data-export">1.6.1. Export of Kompira objects</a></li>
<li><a class="reference internal" href="#data-import">1.6.2. Import of Kompira objects</a></li>
<li><a class="reference internal" href="#data-backup">1.6.3. Backup</a></li>
<li><a class="reference internal" href="#export-data">1.6.4. export_data options</a></li>
<li><a class="reference internal" href="#export-dir">1.6.5. export_dir options</a></li>
<li><a class="reference internal" href="#import-data">1.6.6. import_data options</a></li>
<li><a class="reference internal" href="#import-dir">1.6.7. import_dir options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#license">1.7. Kompira License</a></li>
<li><a class="reference internal" href="#misc">1.8. Private key management</a><ul>
<li><a class="reference internal" href="#misc-keychange">1.8.1. changing the private key</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ha">1.9. High Availability (HA) Management</a><ul>
<li><a class="reference internal" href="#ha-introduction">1.9.1. Introduction</a></li>
<li><a class="reference internal" href="#ha-install">1.9.2. Installation</a><ul>
<li><a class="reference internal" href="#ha-install-primary">1.9.2.1. Setting of the primary server</a></li>
<li><a class="reference internal" href="#ha-install-secondary">1.9.2.2. Setting of the secondary server</a></li>
<li><a class="reference internal" href="#ha-install-check">1.9.2.3. Status check</a></li>
<li><a class="reference internal" href="#ha-license">1.9.2.4. License Registration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ha-update">1.9.3. Update</a><ul>
<li><a class="reference internal" href="#id52">1.9.3.1. Update procedure with both systems stopped (without failover)</a></li>
<li><a class="reference internal" href="#id53">1.9.3.2. Update procedure with single systems stopped (with failover)</a></li>
<li><a class="reference internal" href="#ha-update-with-pg-upgrade">1.9.3.3. Procedure for updating with PostgreSQL upgrade with both systems stopped</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ha-stop-start">1.9.4. HA stop and start</a><ul>
<li><a class="reference internal" href="#id56">1.9.4.1. Stop HA configurtion</a></li>
<li><a class="reference internal" href="#id57">1.9.4.2. Start HA configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ha-recovery">1.9.5. Failover and fail back behavior</a><ul>
<li><a class="reference internal" href="#id59">1.9.5.1. When the server is recoverable</a></li>
<li><a class="reference internal" href="#id60">1.9.5.2. When the server is unrecoverable</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setup-cluster-sh">1.9.6. setup_cluster.sh Options</a></li>
<li><a class="reference internal" href="#sync-master-sh">1.9.7. sync_master.sh options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#audit">1.10. Audit log management</a><ul>
<li><a class="reference internal" href="#id62">1.10.1. Introduction</a><ul>
<li><a class="reference internal" href="#id63">1.10.1.1. Operations covered by the audit log</a></li>
<li><a class="reference internal" href="#id64">1.10.1.2. Operation level and logging level</a></li>
</ul>
</li>
<li><a class="reference internal" href="#audit-logfile">1.10.2. Audit log file</a><ul>
<li><a class="reference internal" href="#id66">1.10.2.1. Destination of audit log</a></li>
<li><a class="reference internal" href="#id67">1.10.2.2. File format of audit log</a></li>
<li><a class="reference internal" href="#id68">1.10.2.3. Items recorded in audit log</a></li>
<li><a class="reference internal" href="#id69">1.10.2.4. Sample of audit log</a></li>
</ul>
</li>
<li><a class="reference internal" href="#audit-spec">1.10.3. Details of audit log items</a><ul>
<li><a class="reference internal" href="#level">1.10.3.1. Operation level (level)</a></li>
<li><a class="reference internal" href="#started-finished">1.10.3.2. Operation date and time (started, finished)</a></li>
<li><a class="reference internal" href="#exec">1.10.3.3. Execution information (exec)</a></li>
<li><a class="reference internal" href="#user">1.10.3.4. Operation user (user)</a></li>
<li><a class="reference internal" href="#interface">1.10.3.5. Operation interface (interface)</a></li>
<li><a class="reference internal" href="#class">1.10.3.6. Operation class (class)</a></li>
<li><a class="reference internal" href="#target-path-target-type">1.10.3.7. Operation target (target_path, target_type)</a></li>
<li><a class="reference internal" href="#type">1.10.3.8. Operation type (type)</a></li>
<li><a class="reference internal" href="#permit-result">1.10.3.9. Operation result (permit, result)</a></li>
<li><a class="reference internal" href="#detail">1.10.3.10. Detail information (detail)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#audit-config">1.10.4. Configuration file</a><ul>
<li><a class="reference internal" href="#id72">1.10.4.1. Configuration file format</a></li>
<li><a class="reference internal" href="#id73">1.10.4.2. Auto reloading of configuration file</a></li>
<li><a class="reference internal" href="#id74">1.10.4.3. Default configuration file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#system-packages">1.11. System packages management</a><ul>
<li><a class="reference internal" href="#id76">1.11.1. Manage command for packages information</a><ul>
<li><a class="reference internal" href="#id77">1.11.1.1. Show pacakges information</a></li>
<li><a class="reference internal" href="#id78">1.11.1.2. Collect packages information</a></li>
<li><a class="reference internal" href="#id79">1.11.1.3. Update packages information</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#ssl">1.12. SSL Certificate Management</a><ul>
<li><a class="reference internal" href="#id80">1.12.1. Location of Certificate Files</a></li>
<li><a class="reference internal" href="#opt-kompira-ssl-ca-source">1.12.2. /opt/kompira/ssl/ca-source/</a><ul>
<li><a class="reference internal" href="#kompira-local-ca-crt">1.12.2.1. kompira-local-ca.crt</a></li>
<li><a class="reference internal" href="#kompira-other-ca-crt">1.12.2.2. kompira-other-ca.crt</a></li>
</ul>
</li>
<li><a class="reference internal" href="#opt-kompira-ssl-certs">1.12.3. /opt/kompira/ssl/certs/</a><ul>
<li><a class="reference internal" href="#kompira-bundle-ca-crt">1.12.3.1. kompira-bundle-ca.crt</a></li>
<li><a class="reference internal" href="#amqp-server-crt">1.12.3.2. amqp-server.crt</a></li>
<li><a class="reference internal" href="#amqp-client-kompira-crt">1.12.3.3. amqp-client-kompira.crt</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id81">1.12.4. Script for SSL Certificate Management</a><ul>
<li><a class="reference internal" href="#id82">1.12.4.1. Setting up a server side SSL environment</a></li>
<li><a class="reference internal" href="#id83">1.12.4.2. Setting up a client side SSL environment</a></li>
<li><a class="reference internal" href="#ca">1.12.4.3. Manage CA certificates</a></li>
<li><a class="reference internal" href="#ssl-certs-admin-ca-in-cluster">1.12.4.4. Manage CA certificates in a clustered environment</a></li>
<li><a class="reference internal" href="#id85">1.12.4.5. Create SSL certificate</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">Kompira 1.6.11 documentation</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="usage.html"
                          title="next chapter"><span class="section-number">2. </span>Operation Guide</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/admin.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="usage.html" title="2. Operation Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Kompira 1.6.11 documentation"
             >previous</a> |</li>
<li class="nav-item nav-item-0"><a href="index.html">Kompira 1.6.11 documentation</a> [<a href="../ja/admin.html">ja</a>|<a href="./kompira.pdf" target="_blank">pdf</a>] &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>Administration Guide</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012, Kompira development team.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>